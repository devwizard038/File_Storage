{"version":3,"file":"drive-routes-af2d819a.mjs","sources":["../../../resources/client/drive/drive-query-keys.ts","../../../resources/client/drive/shareable-link/shareable-link-page/link-page-store.ts","../../../resources/client/drive/shareable-link/queries/use-shareable-link-page.ts","../../../resources/client/drive/shareable-link/shareable-link-page/queries/check-link-password.ts","../../../resources/client/drive/shareable-link/shareable-link-page/queries/import-into-own-drive.ts","../../../resources/client/drive/shareable-link/shareable-link-page/shareable-link-page-action-buttons.tsx","../../../resources/client/drive/shareable-link/shareable-link-page/shareable-link-navbar.tsx","../../../resources/client/drive/shareable-link/shareable-link-page/password-page.tsx","../../../resources/client/drive/file-view/file-grid/base-file-grid-item.tsx","../../../resources/client/drive/shareable-link/shareable-link-page/folder-preview/folder-preview-file-grid.tsx","../../../resources/client/drive/drive-store.ts","../../../resources/client/drive/shareable-link/queries/create-shareable-link.ts","../../../resources/client/drive/files/queries/use-add-star-to-entries.ts","../../../resources/client/drive/files/queries/use-remove-star-from-entries.ts","../../../resources/client/drive/files/queries/use-duplicate-entries.ts","../../../resources/client/drive/drive-page/add-files.svg","../../../resources/client/drive/drive-page/time-management.svg","../../../resources/client/drive/drive-page/file-searching.svg","../../../resources/client/drive/drive-page/throw-away.svg","../../../resources/client/drive/drive-page/loving-it.svg","../../../resources/client/drive/shareable-link/shareable-link-page/folder-preview/share.svg","../../../resources/client/drive/drive-page/drive-page.tsx","../../../resources/client/drive/files/queries/use-delete-entries.ts","../../../resources/client/drive/share-dialog/queries/use-unshare-entries.ts","../../../resources/client/drive/files/queries/use-restore-entries.ts","../../../resources/client/drive/entry-actions/use-entry-actions.ts","../../../resources/client/drive/layout/sidebar/storage-summary/storage-summary.ts","../../../resources/client/drive/uploading/use-drive-upload-queue.ts","../../../resources/client/drive/entry-actions/use-drive-page-actions.ts","../../../resources/client/drive/entry-actions/entry-action-menu-trigger.tsx","../../../resources/client/drive/file-view/file-table/file-table-columns.tsx","../../../resources/client/drive/shareable-link/shareable-link-page/folder-preview/folder-preview-file-table.tsx","../../../resources/client/drive/shareable-link/shareable-link-page/folder-preview/use-navigate-to-subfolder.tsx","../../../resources/client/drive/shareable-link/shareable-link-page/folder-preview/folder-preview-file-view.tsx","../../../common/resources/client/ui/layout/dashboard-content-header.tsx","../../../resources/client/drive/files/queries/use-folder-path.ts","../../../resources/client/drive/shareable-link/shareable-link-page/folder-preview/folder-preview-breadcrumb.tsx","../../../resources/client/drive/layout/sorting/available-sorts.ts","../../../resources/client/drive/layout/sorting/entries-sort-button.tsx","../../../resources/client/drive/shareable-link/shareable-link-page/folder-preview/folder-preview-header.tsx","../../../resources/client/drive/shareable-link/shareable-link-page/folder-preview/folder-preview.tsx","../../../resources/client/drive/shareable-link/shareable-link-page/shareable-link-page-file-preview.tsx","../../../resources/client/drive/shareable-link/shareable-link-page/shareable-link-page.tsx","../../../common/resources/client/ui/progress/meter.tsx","../../../resources/client/drive/layout/sidebar/storage-summary/storage-meter.tsx","../../../common/resources/client/workspace/requests/create-workspace.ts","../../../common/resources/client/workspace/new-workspace-dialog.tsx","../../../common/resources/client/workspace/requests/workspace-with-members.ts","../../../common/resources/client/workspace/requests/invite-members.ts","../../../common/resources/client/workspace/requests/resend-invite.ts","../../../common/resources/client/utils/string/is-email.ts","../../../common/resources/client/workspace/requests/change-role.ts","../../../common/resources/client/workspace/requests/remove-member.ts","../../../common/resources/client/workspace/leave-workspace-confirmation.tsx","../../../common/resources/client/workspace/workspace-members-dialog.tsx","../../../common/resources/client/workspace/requests/update-workspace.ts","../../../common/resources/client/workspace/rename-workspace-dialog.tsx","../../../common/resources/client/workspace/requests/delete-workspace.ts","../../../common/resources/client/billing/upgrade/policy-fail-message.tsx","../../../common/resources/client/workspace/workspace-selector.tsx","../../../resources/client/drive/menu-positions.ts","../../../resources/client/drive/files/queries/use-folders.ts","../../../resources/client/drive/files/queries/use-move-entries.ts","../../../resources/client/drive/files/utils/can-move-entries-into.ts","../../../resources/client/drive/files/use-folder-drop-action.ts","../../../resources/client/drive/layout/sidebar/folder-tree-drag-id.ts","../../../resources/client/drive/layout/sidebar/use-sidebar-tree-drop-target.ts","../../../common/resources/client/ui/tree/tree-context.tsx","../../../common/resources/client/ui/tree/render-tree.ts","../../../common/resources/client/ui/tree/tree-label.tsx","../../../common/resources/client/ui/tree/tree-item.tsx","../../../common/resources/client/ui/tree/tree.tsx","../../../resources/client/drive/layout/sidebar/folder-tree.tsx","../../../resources/client/drive/layout/sidebar/sidebar-menu.tsx","../../../resources/client/drive/layout/create-new-button.tsx","../../../resources/client/drive/layout/sidebar/sidebar.tsx","../../../resources/client/drive/files/queries/use-paginated-entries.ts","../../../resources/client/drive/search/drive-search-filters.ts","../../../resources/client/drive/search/search-filter-list.tsx","../../../common/resources/client/ui/interactions/utils/restrict-resizable-within-boundary.ts","../../../common/resources/client/ui/interactions/dnd/mouse-selection/use-mouse-selectable.ts","../../../common/resources/client/ui/interactions/utils/rects-intersect.ts","../../../common/resources/client/ui/interactions/dnd/mouse-selection/use-mouse-selection-box.ts","../../../resources/client/drive/files/queries/use-entries.ts","../../../resources/client/drive/files/use-selected-entries.ts","../../../resources/client/drive/entry-actions/entry-action-list.tsx","../../../resources/client/drive/files/drive-context-menu.tsx","../../../common/resources/client/utils/hooks/is-touch-device.ts","../../../resources/client/drive/file-view/use-file-view-dnd.ts","../../../resources/client/drive/file-view/file-table/file-table-row.tsx","../../../resources/client/drive/file-view/use-view-item-action-handler.ts","../../../resources/client/drive/file-view/file-table/file-table.tsx","../../../resources/client/drive/file-view/file-grid/file-grid-item.tsx","../../../resources/client/drive/file-view/file-grid/file-grid.tsx","../../../resources/client/drive/layout/sorting/drive-sort-button.tsx","../../../resources/client/drive/page-breadcrumbs.tsx","../../../common/resources/client/ui/infinite-scroll/infinite-scroll-sentinel.tsx","../../../resources/client/drive/drop-target-mask.tsx","../../../resources/client/drive/file-view/file-view.tsx","../../../resources/client/drive/uploading/upload-queue-item.tsx","../../../resources/client/drive/uploading/upload-queue.tsx","../../../resources/client/drive/details-sidebar/detailed-examination.svg","../../../resources/client/drive/details-sidebar/details-sidebar-header.tsx","../../../resources/client/drive/details-sidebar/details-sidebar-section-header.tsx","../../../resources/client/drive/details-sidebar/requests/use-sync-entry-tags.ts","../../../resources/client/drive/details-sidebar/requests/use-file-entry-tags.ts","../../../resources/client/drive/details-sidebar/details-sidebar-tags.tsx","../../../resources/client/drive/details-sidebar/details-sidebar-properties.tsx","../../../resources/client/drive/details-sidebar/details-sidebar.tsx","../../../resources/client/drive/files/queries/use-rename-entry.ts","../../../resources/client/drive/files/dialogs/rename-entry-dialog.tsx","../../../resources/client/drive/files/queries/create-folder.ts","../../../resources/client/drive/files/dialogs/new-folder-dialog.tsx","../../../resources/client/drive/files/dialogs/entry-preview-dialog.tsx","../../../resources/client/drive/share-dialog/queries/use-share-entry.ts","../../../resources/client/drive/files/drive-entry.ts","../../../resources/client/drive/share-dialog/permission-selector.tsx","../../../resources/client/drive/share-dialog/queries/use-change-permission.ts","../../../common/resources/client/ui/images/user-avatar.tsx","../../../resources/client/drive/share-dialog/member-list.tsx","../../../resources/client/drive/share-dialog/share-panel.tsx","../../../resources/client/drive/shareable-link/queries/use-entry-shareable-link.ts","../../../resources/client/drive/shareable-link/queries/use-delete-shareable-link.ts","../../../common/resources/client/utils/string/random-string.ts","../../../resources/client/drive/share-dialog/link-panel/shareable-link-panel.tsx","../../../resources/client/drive/shareable-link/queries/use-update-shareable-link.ts","../../../resources/client/drive/share-dialog/link-panel/link-settings-dialog.tsx","../../../resources/client/drive/share-dialog/share-dialog.tsx","../../../resources/client/drive/files/dialogs/move-entries-dialog/move-entries-dialog-search.tsx","../../../resources/client/drive/files/dialogs/move-entries-dialog/move-entries-dialog-breadcrumbs.tsx","../../../resources/client/drive/files/dialogs/move-entries-dialog/my-files.svg","../../../resources/client/drive/files/dialogs/move-entries-dialog/move-entries-dialog-folder-list.tsx","../../../resources/client/drive/files/dialogs/move-entries-dialog/move-entries-dialog.tsx","../../../resources/client/drive/files/dialogs/delete-entries-forever-dialog.tsx","../../../resources/client/drive/files/dialogs/block-trash-folder-view-dialog.tsx","../../../resources/client/drive/files/dialogs/drive-dialogs-container.tsx","../../../resources/client/drive/search/navbar-search.tsx","../../../common/resources/client/ui/interactions/dnd/use-drag-monitor.ts","../../../resources/client/drive/file-view/entry-drag-preview.tsx","../../../resources/client/drive/layout/drive-content-header.tsx","../../../resources/client/drive/layout/drive-layout.tsx","../../../resources/client/drive/drive-routes.tsx"],"sourcesContent":["import type {DriveApiIndexParams} from './files/queries/use-paginated-entries';\r\nimport type {UserFoldersApiParams} from './files/queries/use-folders';\r\nimport {queryClient} from '@common/http/query-client';\r\nimport {Key} from 'react';\r\n\r\nexport const DriveQueryKeys = {\r\n  fetchEntries: (params?: DriveApiIndexParams) => {\r\n    const key: ('drive-entries' | DriveApiIndexParams)[] = ['drive-entries'];\r\n    if (params) key.push(params);\r\n    return key;\r\n  },\r\n  fetchUserFolders(params?: UserFoldersApiParams) {\r\n    const key: (string | UserFoldersApiParams)[] = ['user-folders'];\r\n    if (params) {\r\n      key.push(params);\r\n    }\r\n    return key;\r\n  },\r\n  fetchShareableLink: (params?: {hash?: string; sort?: string}) => {\r\n    const key: (string | object)[] = ['shareable-link'];\r\n    if (params) {\r\n      key.push(params);\r\n    }\r\n    return key;\r\n  },\r\n  fetchFolderPath(\r\n    hash?: string,\r\n    params?: Record<string, string | number | null>,\r\n  ) {\r\n    const key: (string | any)[] = ['folder-path'];\r\n    if (hash) {\r\n      key.push(hash);\r\n    }\r\n    if (params) {\r\n      key.push(params);\r\n    }\r\n    return key;\r\n  },\r\n  fetchEntryShareableLink: (entryId: number) => {\r\n    return ['file-entries', entryId, 'shareable-link'];\r\n  },\r\n  fetchFileEntry: (id?: number) => {\r\n    const key: Key[] = ['drive/file-entries/model'];\r\n    if (id) key.push(id);\r\n    return key;\r\n  },\r\n  fetchStorageSummary: ['storage-summary'],\r\n};\r\n\r\nexport function invalidateEntryQueries() {\r\n  return Promise.all([\r\n    queryClient.invalidateQueries({queryKey: DriveQueryKeys.fetchEntries()}),\r\n    queryClient.invalidateQueries({queryKey: DriveQueryKeys.fetchFolderPath()}),\r\n    queryClient.invalidateQueries({\r\n      queryKey: DriveQueryKeys.fetchUserFolders(),\r\n    }),\r\n    // fetching model for single file entry in \"useFileEntry\"\r\n    queryClient.invalidateQueries({queryKey: DriveQueryKeys.fetchFileEntry()}),\r\n  ]);\r\n}\r\n","import {create} from 'zustand';\r\nimport {immer} from 'zustand/middleware/immer';\r\nimport {DriveSortDescriptor} from '../../drive-store';\r\nimport {\r\n  getFromLocalStorage,\r\n  setInLocalStorage,\r\n} from '@common/utils/hooks/local-storage';\r\n\r\ninterface LinkPageState {\r\n  password: string | null;\r\n  setPassword: (value: string) => void;\r\n  isPasswordProtected: boolean;\r\n  setIsPasswordProtected: (value: boolean) => void;\r\n  activeSort: DriveSortDescriptor;\r\n  setActiveSort: (value: DriveSortDescriptor) => void;\r\n  viewMode: 'grid' | 'list';\r\n  setViewMode: (mode: 'grid' | 'list') => void;\r\n}\r\n\r\nexport const useLinkPageStore = create<LinkPageState>()(\r\n  immer(set => ({\r\n    password: null,\r\n    viewMode: getFromLocalStorage<'list' | 'grid'>('drive.viewMode'),\r\n    activeSort: {\r\n      orderBy: 'updated_at',\r\n      orderDir: 'desc',\r\n    },\r\n    setPassword: value => {\r\n      set(state => {\r\n        state.password = value;\r\n      });\r\n    },\r\n    isPasswordProtected: false,\r\n    setIsPasswordProtected: value => {\r\n      set(state => {\r\n        state.isPasswordProtected = value;\r\n      });\r\n    },\r\n\r\n    setViewMode: mode => {\r\n      set(state => {\r\n        state.viewMode = mode;\r\n        setInLocalStorage('drive.viewMode', mode);\r\n      });\r\n    },\r\n    setActiveSort: value => {\r\n      set(state => {\r\n        state.activeSort = value;\r\n      });\r\n    },\r\n  }))\r\n);\r\n\r\nexport function linkPageState() {\r\n  return useLinkPageStore.getState();\r\n}\r\n","import {keepPreviousData, useInfiniteQuery} from '@tanstack/react-query';\r\nimport {useParams} from 'react-router-dom';\r\nimport type {FetchShareableLinkResponse} from './use-entry-shareable-link';\r\nimport type {DriveEntry} from '../../files/drive-entry';\r\nimport {DriveQueryKeys} from '../../drive-query-keys';\r\nimport {\r\n  linkPageState,\r\n  useLinkPageStore,\r\n} from '../shareable-link-page/link-page-store';\r\nimport {LengthAwarePaginationResponse} from '@common/http/backend-response/pagination-response';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {getBootstrapData} from '@common/core/bootstrap-data/use-backend-bootstrap-data';\r\n\r\nexport interface FetchShareableLinkPageResponse\r\n  extends FetchShareableLinkResponse {\r\n  folderChildren: LengthAwarePaginationResponse<DriveEntry>;\r\n  passwordInvalid: boolean;\r\n}\r\n\r\nexport function useShareableLinkPage() {\r\n  const {hash} = useParams();\r\n  const {orderBy, orderDir} = useLinkPageStore(s => s.activeSort);\r\n  const order = `${orderBy}:${orderDir}`;\r\n  const isPasswordProtected = useLinkPageStore(s => s.isPasswordProtected);\r\n  const password = useLinkPageStore(s => s.password);\r\n\r\n  const query = useInfiniteQuery({\r\n    queryKey: DriveQueryKeys.fetchShareableLink({hash, sort: order}),\r\n    queryFn: async ({pageParam = 1}) => {\r\n      const response = await fetchLinkByHash({\r\n        hash: hash!,\r\n        page: pageParam,\r\n        order,\r\n        password,\r\n      });\r\n      if (response.passwordInvalid) {\r\n        linkPageState().setIsPasswordProtected(true);\r\n      }\r\n      return response;\r\n    },\r\n    initialData: () => {\r\n      const data = getBootstrapData().loaders?.shareableLinkPage;\r\n      if (data && data.link?.hash === hash) {\r\n        if (data.passwordInvalid) {\r\n          linkPageState().setIsPasswordProtected(true);\r\n        }\r\n        return {\r\n          pageParams: [undefined, 1],\r\n          pages: [data],\r\n        };\r\n      }\r\n    },\r\n    initialPageParam: 1,\r\n    getNextPageParam: lastResponse => {\r\n      if (!lastResponse.folderChildren) return undefined;\r\n      const currentPage = lastResponse.folderChildren.current_page;\r\n      const lastPage = lastResponse.folderChildren.last_page;\r\n      if (currentPage >= lastPage) {\r\n        return undefined;\r\n      }\r\n      return currentPage + 1;\r\n    },\r\n    // disable query if link is password protected and correct\r\n    // password was not entered yet, to prevent unnecessary requests\r\n    enabled: (!!hash && !isPasswordProtected) || password != null,\r\n    placeholderData: keepPreviousData,\r\n  });\r\n\r\n  return {\r\n    ...query,\r\n    link: query.data?.pages[0].link,\r\n    entries: query.data?.pages.flatMap(p => p.folderChildren?.data),\r\n  };\r\n}\r\n\r\ninterface FetchLinkByHashParams {\r\n  hash: string;\r\n  page?: number;\r\n  order?: string;\r\n  password?: string | null;\r\n}\r\nfunction fetchLinkByHash({\r\n  hash,\r\n  page = 1,\r\n  order,\r\n  password,\r\n}: FetchLinkByHashParams): Promise<FetchShareableLinkPageResponse> {\r\n  return apiClient\r\n    .get(`shareable-links/${hash}`, {\r\n      params: {loader: 'shareableLinkPage', page, order, password},\r\n    })\r\n    .then(response => response.data);\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {linkPageState} from '../link-page-store';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\nimport {message} from '@common/i18n/message';\r\n\r\ninterface Response extends BackendResponse {\r\n  matches: boolean;\r\n}\r\n\r\ninterface Props {\r\n  password: string;\r\n  linkHash: string;\r\n}\r\n\r\nfunction checkLinkPassword({password, linkHash}: Props): Promise<Response> {\r\n  return apiClient\r\n    .post(`shareable-links/${linkHash}/check-password`, {password})\r\n    .then(r => r.data);\r\n}\r\n\r\nexport function useCheckLinkPassword() {\r\n  return useMutation({\r\n    mutationFn: (props: Props) => checkLinkPassword(props),\r\n    onSuccess: (response, props) => {\r\n      if (response.matches) {\r\n        linkPageState().setPassword(props.password);\r\n      }\r\n    },\r\n    onError: err => showHttpErrorToast(err, message('Could not create link')),\r\n  });\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {DriveEntryUser} from '../../../files/drive-entry';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {useLinkPageStore} from '../link-page-store';\r\nimport {apiClient, queryClient} from '@common/http/query-client';\r\nimport {DriveQueryKeys} from '../../../drive-query-keys';\r\nimport {message} from '@common/i18n/message';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\n\r\ninterface Response extends BackendResponse {\r\n  users: DriveEntryUser[];\r\n}\r\n\r\ninterface Props {\r\n  password: string | null;\r\n  linkId: number;\r\n}\r\n\r\nfunction importIntoOwnDrive({linkId, password}: Props): Promise<Response> {\r\n  return apiClient\r\n    .post(`shareable-links/${linkId}/import`, {password})\r\n    .then(r => r.data);\r\n}\r\n\r\nexport function useImportIntoOwnDrive() {\r\n  const password = useLinkPageStore(s => s.password);\r\n  return useMutation({\r\n    mutationFn: (props: Omit<Props, 'password'>) =>\r\n      importIntoOwnDrive({...props, password}),\r\n    onSuccess: async () => {\r\n      await queryClient.invalidateQueries({\r\n        queryKey: DriveQueryKeys.fetchShareableLink(),\r\n      });\r\n      toast(message('Item imported into your drive'));\r\n    },\r\n    onError: err => showHttpErrorToast(err, message('Could not create link')),\r\n  });\r\n}\r\n","import {useShareableLinkPage} from '../queries/use-shareable-link-page';\r\nimport {useAuth} from '@common/auth/use-auth';\r\nimport {useFileEntryUrls} from '@common/uploads/hooks/file-entry-urls';\r\nimport {useImportIntoOwnDrive} from './queries/import-into-own-drive';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {FileDownloadIcon} from '@common/icons/material/FileDownload';\r\nimport {downloadFileFromUrl} from '@common/uploads/utils/download-file-from-url';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {\r\n  Menu,\r\n  MenuItem,\r\n  MenuTrigger,\r\n} from '@common/ui/navigation/menu/menu-trigger';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {KeyboardArrowDownIcon} from '@common/icons/material/KeyboardArrowDown';\r\nimport {ImportExportIcon} from '@common/icons/material/ImportExport';\r\nimport React, {Fragment} from 'react';\r\nimport {Tooltip} from '@common/ui/tooltip/tooltip';\r\n\r\nexport function ShareableLinkPageActionButtons() {\r\n  const {link} = useShareableLinkPage();\r\n  const {user, isLoggedIn} = useAuth();\r\n  const {downloadUrl} = useFileEntryUrls(link?.entry);\r\n  const importIntoOwnDrive = useImportIntoOwnDrive();\r\n  const alreadyImported = link?.entry?.users!.find(u => u.id === user?.id);\r\n\r\n  if (!link?.entry) return null;\r\n\r\n  return (\r\n    <div>\r\n      {link.allow_download && <DownloadButton downloadUrl={downloadUrl} />}\r\n      {!alreadyImported && isLoggedIn && link.allow_edit && (\r\n        <MenuTrigger\r\n          onItemSelected={key => {\r\n            if (key === 'import') {\r\n              importIntoOwnDrive.mutate({linkId: link.id});\r\n            } else if (key === 'download') {\r\n              if (downloadUrl) {\r\n                downloadFileFromUrl(downloadUrl);\r\n              }\r\n            }\r\n          }}\r\n        >\r\n          <IconButton className=\"ml-6\" disabled={importIntoOwnDrive.isPending}>\r\n            <KeyboardArrowDownIcon />\r\n          </IconButton>\r\n          <Menu>\r\n            <MenuItem value=\"download\" startIcon={<FileDownloadIcon />}>\r\n              <Trans message=\"Download\" />\r\n            </MenuItem>\r\n            <MenuItem value=\"import\" startIcon={<ImportExportIcon />}>\r\n              <Trans message=\"Save a copy to your own drive\" />\r\n            </MenuItem>\r\n          </Menu>\r\n        </MenuTrigger>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface DownloadButtonProps {\r\n  downloadUrl: string | undefined;\r\n}\r\nfunction DownloadButton({downloadUrl}: DownloadButtonProps) {\r\n  return (\r\n    <Fragment>\r\n      <Tooltip label={<Trans message=\"Download\" />}>\r\n        <IconButton\r\n          className=\"md:hidden\"\r\n          onClick={() => {\r\n            if (downloadUrl) {\r\n              downloadFileFromUrl(downloadUrl);\r\n            }\r\n          }}\r\n        >\r\n          <FileDownloadIcon />\r\n        </IconButton>\r\n      </Tooltip>\r\n      <Button\r\n        className=\"max-md:hidden\"\r\n        size=\"sm\"\r\n        variant=\"flat\"\r\n        color=\"chip\"\r\n        startIcon={<FileDownloadIcon />}\r\n        onClick={() => {\r\n          if (downloadUrl) {\r\n            downloadFileFromUrl(downloadUrl);\r\n          }\r\n        }}\r\n      >\r\n        <Trans message=\"Download\" />\r\n      </Button>\r\n    </Fragment>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport {FileTypeIcon} from '@common/uploads/file-type-icon/file-type-icon';\r\nimport {Navbar} from '@common/ui/navigation/navbar/navbar';\r\nimport {useShareableLinkPage} from '../queries/use-shareable-link-page';\r\nimport {ShareableLinkPageActionButtons} from './shareable-link-page-action-buttons';\r\nimport {useIsMobileMediaQuery} from '@common/utils/hooks/is-mobile-media-query';\r\n\r\nexport function ShareableLinkNavbar() {\r\n  const {link} = useShareableLinkPage();\r\n  const isMobile = useIsMobileMediaQuery();\r\n  return (\r\n    <Navbar\r\n      size=\"md\"\r\n      color=\"bg\"\r\n      className=\"flex-shrink-0\"\r\n      rightChildren={link?.entry && <ShareableLinkPageActionButtons />}\r\n      menuPosition=\"shareable-link-page\"\r\n      hideLogo={isMobile}\r\n    >\r\n      {link?.entry && link.entry.type !== 'folder' && (\r\n        <div className=\"fex-auto flex min-w-0 items-center gap-10\">\r\n          <FileTypeIcon className=\"flex-shrink-0\" type={link.entry.type} />\r\n          <div className=\"flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap font-medium\">\r\n            {link.entry.name}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </Navbar>\r\n  );\r\n}\r\n","import {useState} from 'react';\r\nimport {SvgImage} from '@common/ui/images/svg-image/svg-image';\r\nimport {TextField} from '@common/ui/forms/input-field/text-field/text-field';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {useCheckLinkPassword} from './queries/check-link-password';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {useTrans} from '@common/i18n/use-trans';\r\nimport {ShareableLinkNavbar} from './shareable-link-navbar';\r\nimport {useParams} from 'react-router-dom';\r\nimport secureFilesSvg from '@common/auth/ui/account-settings/access-token-panel/secure-files.svg';\r\n\r\nexport function PasswordPage() {\r\n  const {trans} = useTrans();\r\n  const {hash} = useParams();\r\n  const fieldLabel = trans({message: 'Password'});\r\n  const [password, setPassword] = useState<string>('');\r\n  const checkPassword = useCheckLinkPassword();\r\n  const linkHash = hash ? hash.split(':')[0] : null;\r\n\r\n  const passwordIsInvalid = checkPassword.data && !checkPassword.data.matches;\r\n\r\n  return (\r\n    <div className=\"flex h-screen flex-col bg-alt\">\r\n      <ShareableLinkNavbar />\r\n      <div className=\"mx-auto my-80 px-10 md:px-20\">\r\n        <div className=\"flex max-w-[560px] flex-col items-center gap-40 rounded border bg p-24 md:flex-row md:gap-14\">\r\n          <div className=\"h-132 w-[165px]\">\r\n            <SvgImage src={secureFilesSvg} />\r\n          </div>\r\n          <form\r\n            onSubmit={e => {\r\n              e.preventDefault();\r\n              checkPassword.mutate({\r\n                linkHash: linkHash!,\r\n                password,\r\n              });\r\n            }}\r\n          >\r\n            <span className=\"text-sm\">\r\n              <Trans message=\"The link you are trying to access is password protected.\" />\r\n            </span>\r\n            <TextField\r\n              autoFocus\r\n              placeholder={fieldLabel}\r\n              aria-label={fieldLabel}\r\n              className=\"mb-20 mt-10\"\r\n              type=\"password\"\r\n              value={password}\r\n              required\r\n              errorMessage={\r\n                passwordIsInvalid && <Trans message=\"Password is not valid\" />\r\n              }\r\n              onChange={e => {\r\n                setPassword(e.target.value);\r\n              }}\r\n            />\r\n            <div className=\"text-right\">\r\n              <Button\r\n                variant=\"flat\"\r\n                color=\"primary\"\r\n                type=\"submit\"\r\n                className=\"w-full md:w-auto\"\r\n                disabled={checkPassword.isPending}\r\n              >\r\n                <Trans message=\"Enter\" />\r\n              </Button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, {ComponentPropsWithoutRef, ReactNode} from 'react';\r\nimport clsx from 'clsx';\r\nimport {FileThumbnail} from '@common/uploads/file-type-icon/file-thumbnail';\r\nimport {DriveEntry} from '../../files/drive-entry';\r\n\r\ninterface BaseFileGridItemProps extends ComponentPropsWithoutRef<'div'> {\r\n  entry: DriveEntry;\r\n  className?: string;\r\n  isSelected?: boolean;\r\n  isMobileMode?: boolean;\r\n  footerAdornment?: ReactNode;\r\n}\r\n\r\nexport const BaseFileGridItem = React.forwardRef<\r\n  HTMLDivElement,\r\n  BaseFileGridItemProps\r\n>(\r\n  (\r\n    {entry, className, isSelected, isMobileMode, footerAdornment, ...domProps},\r\n    ref\r\n  ) => {\r\n    return (\r\n      <div\r\n        {...domProps}\r\n        ref={ref}\r\n        className={clsx(\r\n          'shadow rounded border aspect-square flex flex-col grid-item transition-shadow-opacity select-none overflow-hidden outline-none dark:bg-alt',\r\n          isSelected && 'border-primary',\r\n          className\r\n        )}\r\n      >\r\n        <div className=\"flex-auto relative min-h-0\">\r\n          <FileThumbnail\r\n            className=\"h-full w-full\"\r\n            iconClassName=\"block w-70 h-70 absolute m-auto inset-0\"\r\n            file={entry}\r\n          />\r\n        </div>\r\n        <Footer\r\n          entry={entry}\r\n          isSelected={isSelected}\r\n          isMobile={isMobileMode}\r\n          adornment={footerAdornment}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n);\r\n\r\ninterface FooterProps {\r\n  entry: DriveEntry;\r\n  isSelected?: boolean;\r\n  isMobile?: boolean;\r\n  adornment?: ReactNode;\r\n}\r\nfunction Footer({entry, isSelected, isMobile, adornment}: FooterProps) {\r\n  return (\r\n    <div\r\n      className={clsx(\r\n        'text-sm h-48 flex-shrink-0 flex items-center',\r\n        isMobile ? 'justify-between gap-10 pl-18 pr-2' : 'justify-center px-16',\r\n        isSelected && 'bg-primary-light/20'\r\n      )}\r\n    >\r\n      <div className=\"min-w-0 whitespace-nowrap overflow-hidden overflow-ellipsis\">\r\n        {entry.name}\r\n      </div>\r\n      {adornment}\r\n    </div>\r\n  );\r\n}\r\n","import {BaseFileGridItem} from '../../../file-view/file-grid/base-file-grid-item';\r\nimport React from 'react';\r\nimport {DriveEntry} from '../../../files/drive-entry';\r\n\r\nexport interface FolderPreviewGridProps {\r\n  entries: DriveEntry[];\r\n  onEntrySelected: (entry: DriveEntry, index: number) => void;\r\n}\r\nexport function FolderPreviewFileGrid({\r\n  entries,\r\n  onEntrySelected,\r\n}: FolderPreviewGridProps) {\r\n  return (\r\n    <div className=\"file-grid\">\r\n      {entries.map((entry, index) => (\r\n        <BaseFileGridItem\r\n          tabIndex={-1}\r\n          className=\"hover:shadow-md cursor-pointer bg\"\r\n          entry={entry}\r\n          key={entry.id}\r\n          onContextMenu={e => {\r\n            e.preventDefault();\r\n          }}\r\n          onKeyDown={e => {\r\n            if (e.key === 'Enter' || e.key === ' ') {\r\n              onEntrySelected(entry, index);\r\n            }\r\n          }}\r\n          onClick={() => {\r\n            onEntrySelected(entry, index);\r\n          }}\r\n        />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n","import {enableMapSet} from 'immer';\r\nimport {create} from 'zustand';\r\nimport {immer} from 'zustand/middleware/immer';\r\nimport type {DrivePage} from './drive-page/drive-page';\r\nimport {Key} from 'react';\r\nimport {DriveEntry} from './files/drive-entry';\r\nimport {SortColumn, SortDirection} from './layout/sorting/available-sorts';\r\nimport {\r\n  getFromLocalStorage,\r\n  setInLocalStorage,\r\n} from '@common/utils/hooks/local-storage';\r\nimport {getBootstrapData} from '@common/core/bootstrap-data/use-backend-bootstrap-data';\r\n\r\nconst stableArray: DriveEntry[] = [];\r\nenableMapSet();\r\n\r\nexport type DriveDialog =\r\n  | 'rename'\r\n  | 'newFolder'\r\n  | 'preview'\r\n  | 'share'\r\n  | 'getLink'\r\n  | 'moveTo'\r\n  | 'confirmAndDeleteForever'\r\n  | 'trashFolderBlock';\r\n\r\nexport interface ActiveActionDialog {\r\n  name: DriveDialog;\r\n  entries: DriveEntry[];\r\n}\r\n\r\nexport interface DriveSortDescriptor {\r\n  orderBy?: SortColumn;\r\n  orderDir?: SortDirection;\r\n}\r\n\r\ninterface State {\r\n  uploadQueueIsOpen: boolean;\r\n  selectedEntries: Set<number>;\r\n  sidebarExpandedKeys: Key[];\r\n  activePage?: DrivePage;\r\n  activeActionDialog?: {\r\n    name: DriveDialog;\r\n    entries: DriveEntry[];\r\n  } | null;\r\n  entriesBeingDragged: number[];\r\n  viewMode: 'grid' | 'list';\r\n  sortDescriptor: DriveSortDescriptor;\r\n  contextMenuData: {x: number; y: number; entry?: DriveEntry} | null;\r\n}\r\n\r\ninterface Actions {\r\n  setUploadQueueIsOpen: (isOpen: boolean) => void;\r\n  setSidebarExpandedKeys: (keys: Key[]) => void;\r\n  expandSidebarItem: (key: Key) => void;\r\n  collapseSidebarItem: (key: Key) => void;\r\n  toggleSidebarItem: (key: Key) => void;\r\n  setActivePage: (page: DrivePage) => void;\r\n  setActiveActionDialog: (\r\n    name: DriveDialog | null,\r\n    entries?: DriveEntry[],\r\n  ) => void;\r\n  setViewMode: (mode: 'grid' | 'list') => void;\r\n  setSortDescriptor: (value: DriveSortDescriptor) => void;\r\n  setContextMenuData: (\r\n    position: {x: number; y: number; entry?: DriveEntry} | null,\r\n  ) => void;\r\n  setEntriesBeingDragged: (value: number[]) => void;\r\n  selectEntries: (\r\n    entries: (number | undefined | null)[],\r\n    merge?: boolean,\r\n  ) => void;\r\n  deselectEntries: (entries: number[] | 'all') => void;\r\n  reset: () => void;\r\n}\r\n\r\nconst initialState: State = {\r\n  uploadQueueIsOpen: false,\r\n  contextMenuData: null,\r\n  selectedEntries: new Set(),\r\n  entriesBeingDragged: [],\r\n  activeActionDialog: null,\r\n  sidebarExpandedKeys: [],\r\n  viewMode: getFromLocalStorage<'list' | 'grid'>(\r\n    'drive.viewMode',\r\n    getBootstrapData().settings?.drive?.default_view || 'grid',\r\n  ),\r\n  sortDescriptor: {\r\n    orderBy: 'updated_at',\r\n    orderDir: 'desc',\r\n  },\r\n};\r\n\r\nexport const useDriveStore = create<State & Actions>()(\r\n  immer((set, get) => ({\r\n    ...initialState,\r\n    setUploadQueueIsOpen: isOpen => {\r\n      set(state => {\r\n        state.uploadQueueIsOpen = isOpen;\r\n      });\r\n    },\r\n    setContextMenuData: data => {\r\n      set(state => {\r\n        state.contextMenuData = data;\r\n      });\r\n    },\r\n    setSortDescriptor: value => {\r\n      set(state => {\r\n        const activePageId = get().activePage?.uniqueId;\r\n        if (activePageId) {\r\n          setInLocalStorage('selectedSorting', {\r\n            ...getFromLocalStorage('selectedSorting'),\r\n            [activePageId]: value,\r\n          });\r\n        }\r\n        state.sortDescriptor = value;\r\n      });\r\n    },\r\n    setActivePage: value => {\r\n      set(state => {\r\n        state.activePage = value;\r\n\r\n        const storedDescriptor =\r\n          getFromLocalStorage('selectedSorting')?.[value.uniqueId];\r\n        state.sortDescriptor = storedDescriptor\r\n          ? storedDescriptor\r\n          : value.sortDescriptor;\r\n      });\r\n    },\r\n    setEntriesBeingDragged: value => {\r\n      set(state => {\r\n        state.entriesBeingDragged = value;\r\n      });\r\n    },\r\n    setActiveActionDialog: (name, entries = stableArray) => {\r\n      set(state => {\r\n        const current = get().activeActionDialog;\r\n        // prevent creating a new object, if neither name nor entries changed\r\n        if (current?.name !== name || current.entries !== entries) {\r\n          state.activeActionDialog = name ? {name, entries} : null;\r\n        }\r\n      });\r\n    },\r\n    setViewMode: mode => {\r\n      set(state => {\r\n        state.viewMode = mode;\r\n        setInLocalStorage('drive.viewMode', mode);\r\n      });\r\n    },\r\n    setSidebarExpandedKeys: value =>\r\n      set(state => {\r\n        state.sidebarExpandedKeys = value;\r\n      }),\r\n    expandSidebarItem: key =>\r\n      set(state => {\r\n        if (!state.sidebarExpandedKeys.includes(key)) {\r\n          state.sidebarExpandedKeys.push(key);\r\n        }\r\n      }),\r\n    collapseSidebarItem: key =>\r\n      set(state => {\r\n        const index = state.sidebarExpandedKeys.indexOf(key);\r\n        if (index > -1) {\r\n          state.sidebarExpandedKeys.splice(index, 1);\r\n        }\r\n      }),\r\n    toggleSidebarItem: key =>\r\n      set(state => {\r\n        if (state.sidebarExpandedKeys.includes(key)) {\r\n          state.expandSidebarItem(key);\r\n        } else {\r\n          state.collapseSidebarItem(key);\r\n        }\r\n      }),\r\n    selectEntries: (entries, merge) => {\r\n      set(state => {\r\n        if (!merge) {\r\n          state.selectedEntries.clear();\r\n        }\r\n        entries.forEach(e => e && state.selectedEntries.add(e));\r\n      });\r\n    },\r\n    deselectEntries: entries => {\r\n      set(state => {\r\n        if (!state.selectedEntries.size) return;\r\n        if (entries === 'all') {\r\n          state.selectedEntries = new Set();\r\n        } else {\r\n          entries.forEach(e => state.selectedEntries.delete(e));\r\n        }\r\n      });\r\n    },\r\n    reset: () => {\r\n      set(initialState);\r\n    },\r\n  })),\r\n);\r\n\r\nexport function driveState() {\r\n  return useDriveStore.getState();\r\n}\r\n\r\nexport function useActiveDialogEntry() {\r\n  const dialog = useDriveStore(s => s.activeActionDialog);\r\n  // this will only be used inside dialog, so entry will always be set in that case\r\n  return dialog?.entries[0]!;\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {apiClient, queryClient} from '@common/http/query-client';\r\nimport {FetchShareableLinkResponse} from './use-entry-shareable-link';\r\nimport {DriveQueryKeys} from '../../drive-query-keys';\r\nimport {message} from '@common/i18n/message';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\n\r\nfunction createShareableLink(\r\n  entryId?: number | null,\r\n): Promise<FetchShareableLinkResponse> {\r\n  if (!entryId) {\r\n    return Promise.reject(new Error('Invalid entry id'));\r\n  }\r\n  return apiClient\r\n    .post(`file-entries/${entryId}/shareable-link`)\r\n    .then(response => response.data);\r\n}\r\n\r\ninterface Payload {\r\n  entryId: number;\r\n}\r\nexport function useCreateShareableLink() {\r\n  return useMutation({\r\n    mutationFn: ({entryId}: Payload) => createShareableLink(entryId),\r\n    onSuccess: (data, {entryId}) => {\r\n      queryClient.setQueryData<FetchShareableLinkResponse>(\r\n        DriveQueryKeys.fetchEntryShareableLink(entryId),\r\n        data,\r\n      );\r\n    },\r\n    onError: err => showHttpErrorToast(err, message('Could not create link')),\r\n  });\r\n}\r\n","import {apiClient} from '@common/http/query-client';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {Tag} from '@common/tags/tag';\r\nimport {invalidateEntryQueries} from '../../drive-query-keys';\r\nimport {message} from '@common/i18n/message';\r\nimport {useMutation} from '@tanstack/react-query';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\n\r\ninterface Response extends BackendResponse {\r\n  tag: Tag;\r\n}\r\n\r\ninterface Payload {\r\n  entryIds: number[];\r\n}\r\n\r\nfunction addStarToEntries({entryIds}: Payload): Promise<Response> {\r\n  return apiClient\r\n    .post('file-entries/star', {entryIds})\r\n    .then(response => response.data);\r\n}\r\n\r\nexport function useAddStarToEntries() {\r\n  return useMutation({\r\n    mutationFn: (payload: Payload) => addStarToEntries(payload),\r\n    onSuccess: (data, {entryIds}) => {\r\n      invalidateEntryQueries();\r\n      toast(\r\n        message('Starred [one 1 item|other :count items]', {\r\n          values: {count: entryIds.length},\r\n        }),\r\n      );\r\n    },\r\n    onError: err => showHttpErrorToast(err, message('Could not star items')),\r\n  });\r\n}\r\n","import {apiClient} from '@common/http/query-client';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {Tag} from '@common/tags/tag';\r\nimport {invalidateEntryQueries} from '../../drive-query-keys';\r\nimport {message} from '@common/i18n/message';\r\nimport {useMutation} from '@tanstack/react-query';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\n\r\ninterface Response extends BackendResponse {\r\n  tag: Tag;\r\n}\r\n\r\ninterface Payload {\r\n  entryIds: number[];\r\n}\r\n\r\nfunction removeStarFromEntries({entryIds}: Payload): Promise<Response> {\r\n  return apiClient\r\n    .post('file-entries/unstar', {entryIds})\r\n    .then(response => response.data);\r\n}\r\n\r\nexport function useRemoveStarFromEntries() {\r\n  return useMutation({\r\n    mutationFn: (payload: Payload) => removeStarFromEntries(payload),\r\n    onSuccess: (data, {entryIds}) => {\r\n      invalidateEntryQueries();\r\n      toast(\r\n        message('Removed star from [one 1 item|other :count items]', {\r\n          values: {count: entryIds.length},\r\n        }),\r\n      );\r\n    },\r\n    onError: err => showHttpErrorToast(err, message('Could not remove star')),\r\n  });\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {apiClient, queryClient} from '@common/http/query-client';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {DriveEntry} from '../drive-entry';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {DriveQueryKeys, invalidateEntryQueries} from '../../drive-query-keys';\r\nimport {message} from '@common/i18n/message';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\n\r\ninterface Response extends BackendResponse {\r\n  entries: DriveEntry[];\r\n}\r\n\r\ninterface Payload {\r\n  entryIds: number[];\r\n  destinationId?: number;\r\n}\r\n\r\nfunction duplicateEntries(payload: Payload): Promise<Response> {\r\n  return apiClient\r\n    .post('file-entries/duplicate', payload)\r\n    .then(response => response.data);\r\n}\r\n\r\nexport function useDuplicateEntries() {\r\n  return useMutation({\r\n    mutationFn: (payload: Payload) => {\r\n      toast.loading(\r\n        message('Duplicating [one 1 item|other :count items]...', {\r\n          values: {\r\n            count: payload.entryIds.length,\r\n          },\r\n        }),\r\n        {disableExitAnimation: true},\r\n      );\r\n      return duplicateEntries(payload);\r\n    },\r\n    onSuccess: (r, p) => {\r\n      invalidateEntryQueries();\r\n      queryClient.invalidateQueries({\r\n        queryKey: DriveQueryKeys.fetchStorageSummary,\r\n      });\r\n      toast(\r\n        message('Duplicated [one 1 item|other :count items]', {\r\n          values: {count: p.entryIds.length},\r\n        }),\r\n        {disableEnterAnimation: true},\r\n      );\r\n    },\r\n    onError: err =>\r\n      showHttpErrorToast(err, message('Could not duplicate items'), null, {\r\n        disableEnterAnimation: true,\r\n      }),\r\n  });\r\n}\r\n","export default \"__VITE_ASSET__fdd45f16__\"","export default \"__VITE_ASSET__189838f6__\"","export default \"__VITE_ASSET__bc08ea77__\"","export default \"__VITE_ASSET__94ef2bf1__\"","export default \"__VITE_ASSET__291df933__\"","export default \"__VITE_ASSET__5cc493df__\"","import type {DriveFolder} from '../files/drive-entry';\r\nimport {message} from '@common/i18n/message';\r\nimport {MessageDescriptor} from '@common/i18n/message-descriptor';\r\nimport addFilesSvg from './add-files.svg';\r\nimport timeManagement from './time-management.svg';\r\nimport fileSearching from './file-searching.svg';\r\nimport throwAwaySvg from './throw-away.svg';\r\nimport lovingItSvg from './loving-it.svg';\r\nimport shareSvg from './../shareable-link/shareable-link-page/folder-preview/share.svg';\r\nimport {DriveSortDescriptor} from '../drive-store';\r\nimport {BootstrapData} from '@common/core/bootstrap-data/bootstrap-data';\r\nimport {getBootstrapData} from '@common/core/bootstrap-data/use-backend-bootstrap-data';\r\n\r\ninterface NoContentMessage {\r\n  title: MessageDescriptor;\r\n  description: MessageDescriptor;\r\n  image: string;\r\n}\r\n\r\nexport interface DrivePage {\r\n  uniqueId: string;\r\n  name: string;\r\n  label: MessageDescriptor | string;\r\n  path: string;\r\n  hasActions?: boolean;\r\n  canUpload?: boolean;\r\n  disableSort?: boolean;\r\n  sortDescriptor: DriveSortDescriptor;\r\n  queryParams?: Record<string, string | number | boolean>;\r\n  folder?: DriveFolder;\r\n  isFolderPage?: boolean;\r\n  noContentMessage: (isSearchingOrFiltering: boolean) => NoContentMessage;\r\n}\r\n\r\nconst defaultSortDescriptor: DriveSortDescriptor = {\r\n  orderBy: 'updated_at',\r\n  orderDir: 'desc',\r\n};\r\n\r\nexport function makeFolderPage(folder: DriveFolder): DrivePage {\r\n  return {\r\n    ...makePartialFolderPage(folder.hash),\r\n    canUpload:\r\n      folder.permissions['files.create'] || folder.permissions['files.update'],\r\n    label: folder.name,\r\n    folder,\r\n  };\r\n}\r\n\r\nexport function makePartialFolderPage(hash: string): DrivePage {\r\n  return {\r\n    name: 'folder',\r\n    uniqueId: hash,\r\n    label: '',\r\n    path: getPathForFolder(hash),\r\n    hasActions: true,\r\n    canUpload: false,\r\n    sortDescriptor: defaultSortDescriptor,\r\n    isFolderPage: true,\r\n    noContentMessage: () => ({\r\n      title: message('Drop files or folders here'),\r\n      description: message('Or use the \"Upload\" button'),\r\n      image: addFilesSvg,\r\n    }),\r\n  };\r\n}\r\n\r\nexport function getPathForFolder(hash: string): string {\r\n  if (hash === '0') {\r\n    return '/drive';\r\n  }\r\n  return `/drive/folders/${hash}`;\r\n}\r\n\r\n// bootstrap data will always be available at this point\r\ninterface BootstrapDataWithRootFolder extends BootstrapData {\r\n  rootFolder: DriveFolder;\r\n}\r\nconst rootFolder = (getBootstrapData() as BootstrapDataWithRootFolder)\r\n  .rootFolder;\r\nexport const RootFolderPage = {\r\n  ...makeFolderPage(rootFolder),\r\n  name: 'home',\r\n} as Required<DrivePage>;\r\n\r\nexport const RecentPage: DrivePage = {\r\n  name: 'recent',\r\n  uniqueId: 'recent',\r\n  label: message('Recent'),\r\n  path: '/drive/recent',\r\n  disableSort: true,\r\n  sortDescriptor: {\r\n    orderBy: 'created_at',\r\n    orderDir: 'desc',\r\n  },\r\n  queryParams: {\r\n    recentOnly: true,\r\n  },\r\n  noContentMessage: () => ({\r\n    title: message('No recent entries'),\r\n    description: message('You have not uploaded any files or folders yet'),\r\n    image: timeManagement,\r\n  }),\r\n};\r\n\r\nexport const SearchPage: DrivePage = {\r\n  name: 'search',\r\n  uniqueId: 'search',\r\n  label: message('Search results'),\r\n  path: '/drive/search',\r\n  sortDescriptor: defaultSortDescriptor,\r\n  noContentMessage: isSearchingOrFiltering => {\r\n    if (isSearchingOrFiltering) {\r\n      return {\r\n        title: message('No matching results'),\r\n        description: message('Try changing your search query or filters'),\r\n        image: fileSearching,\r\n      };\r\n    }\r\n    return {\r\n      title: message('Begin typing or select a filter to search'),\r\n      description: message('Search for files, folders and other content'),\r\n      image: fileSearching,\r\n    };\r\n  },\r\n};\r\n\r\nexport const SharesPage: DrivePage = {\r\n  name: 'sharedWithMe',\r\n  uniqueId: 'sharedWithMe',\r\n  label: message('Shared'),\r\n  path: '/drive/shares',\r\n  sortDescriptor: defaultSortDescriptor,\r\n  queryParams: {\r\n    sharedOnly: true,\r\n  },\r\n  noContentMessage: () => ({\r\n    title: message('Shared with me'),\r\n    description: message('Files and folders other people have shared with you'),\r\n    image: shareSvg,\r\n  }),\r\n};\r\n\r\nexport const TrashPage: DrivePage = {\r\n  name: 'trash',\r\n  uniqueId: 'trash',\r\n  label: message('Trash'),\r\n  path: '/drive/trash',\r\n  sortDescriptor: defaultSortDescriptor,\r\n  hasActions: true,\r\n  queryParams: {\r\n    deletedOnly: true,\r\n  },\r\n  noContentMessage: () => ({\r\n    title: message('Trash is empty'),\r\n    description: message(\r\n      'There are no files or folders in your trash currently',\r\n    ),\r\n    image: throwAwaySvg,\r\n  }),\r\n};\r\n\r\nexport const StarredPage: DrivePage = {\r\n  name: 'starred',\r\n  uniqueId: 'starred',\r\n  label: message('Starred'),\r\n  path: '/drive/starred',\r\n  sortDescriptor: defaultSortDescriptor,\r\n  queryParams: {\r\n    starredOnly: true,\r\n  },\r\n  noContentMessage: () => ({\r\n    title: message('Nothing is starred'),\r\n    description: message(\r\n      'Add stars to files and folders that you want to easily find later',\r\n    ),\r\n    image: lovingItSvg,\r\n  }),\r\n};\r\n\r\nexport const DRIVE_PAGES = [\r\n  RootFolderPage,\r\n  RecentPage,\r\n  SearchPage,\r\n  SharesPage,\r\n  TrashPage,\r\n  StarredPage,\r\n];\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {apiClient, queryClient} from '@common/http/query-client';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {DriveQueryKeys, invalidateEntryQueries} from '../../drive-query-keys';\r\nimport {message} from '@common/i18n/message';\r\nimport {getAxiosErrorMessage} from '@common/utils/http/get-axios-error-message';\r\nimport {MessageDescriptor} from '@common/i18n/message-descriptor';\r\n\r\ninterface Response extends BackendResponse {}\r\n\r\ninterface Payload {\r\n  entryIds: number[];\r\n  emptyTrash?: boolean;\r\n  deleteForever?: boolean;\r\n}\r\n\r\nfunction deleteEntries(payload: Payload): Promise<Response> {\r\n  return apiClient\r\n    .post('file-entries/delete', payload)\r\n    .then(response => response.data);\r\n}\r\n\r\nexport function useDeleteEntries() {\r\n  return useMutation({\r\n    mutationFn: (payload: Payload) => {\r\n      toast.loading(getLoaderMessage(payload), {disableExitAnimation: true});\r\n      return deleteEntries(payload);\r\n    },\r\n    onSuccess: (r, {entryIds, emptyTrash, deleteForever}) => {\r\n      invalidateEntryQueries();\r\n      queryClient.invalidateQueries({\r\n        queryKey: DriveQueryKeys.fetchStorageSummary,\r\n      });\r\n      if (emptyTrash) {\r\n        toast(message('Emptied trash'), {disableEnterAnimation: true});\r\n      } else if (deleteForever) {\r\n        toast(\r\n          message('Permanently deleted [one 1 item|other :count items]', {\r\n            values: {count: entryIds.length},\r\n          }),\r\n          {disableEnterAnimation: true},\r\n        );\r\n      } else {\r\n        toast(\r\n          message('Moved [one 1 item|other :count items] to trash', {\r\n            values: {count: entryIds.length},\r\n          }),\r\n          {disableEnterAnimation: true},\r\n        );\r\n      }\r\n    },\r\n    onError: (err, {emptyTrash}) => {\r\n      const backendError = getAxiosErrorMessage(err);\r\n      if (backendError) {\r\n        toast.danger(backendError, {disableEnterAnimation: true});\r\n      } else if (emptyTrash) {\r\n        toast.danger('could not empty trash', {disableEnterAnimation: true});\r\n      } else {\r\n        toast.danger('Could not delete items', {disableEnterAnimation: true});\r\n      }\r\n    },\r\n  });\r\n}\r\n\r\nfunction getLoaderMessage(payload: Payload): MessageDescriptor {\r\n  if (payload.emptyTrash) {\r\n    return message('Emptying trash...');\r\n  } else if (payload.deleteForever) {\r\n    return message('Deleting files...');\r\n  } else {\r\n    return message('Moving to trash...');\r\n  }\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {DriveEntryUser} from '../../files/drive-entry';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {invalidateEntryQueries} from '../../drive-query-keys';\r\n\r\ninterface Response extends BackendResponse {\r\n  users: DriveEntryUser[];\r\n}\r\n\r\ninterface Payload {\r\n  userId: number | 'me';\r\n  entryIds: number[];\r\n}\r\n\r\nexport function useUnshareEntries() {\r\n  return useMutation({\r\n    mutationFn: (payload: Payload) => unshareEntries(payload),\r\n    onSuccess: () => {\r\n      return invalidateEntryQueries();\r\n    },\r\n  });\r\n}\r\n\r\nfunction unshareEntries({entryIds, ...payload}: Payload): Promise<Response> {\r\n  return apiClient\r\n    .post(`file-entries/${entryIds.join(',')}/unshare`, payload)\r\n    .then(response => response.data);\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {invalidateEntryQueries} from '../../drive-query-keys';\r\nimport {message} from '@common/i18n/message';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\n\r\ninterface Response extends BackendResponse {}\r\n\r\ninterface Payload {\r\n  entryIds: number[];\r\n}\r\n\r\nexport function useRestoreEntries() {\r\n  return useMutation({\r\n    mutationFn: (payload: Payload) => restoreEntries(payload),\r\n    onSuccess: (r, p) => {\r\n      invalidateEntryQueries();\r\n      toast(\r\n        message('Restored [one 1 item|other :count items]', {\r\n          values: {count: p.entryIds.length},\r\n        }),\r\n      );\r\n    },\r\n    onError: err => showHttpErrorToast(err, message('Could not restore items')),\r\n  });\r\n}\r\n\r\nfunction restoreEntries(payload: Payload): Promise<Response> {\r\n  return apiClient\r\n    .post('file-entries/restore', payload)\r\n    .then(response => response.data);\r\n}\r\n","import {message} from '@common/i18n/message';\r\nimport {PersonAddIcon} from '@common/icons/material/PersonAdd';\r\nimport {driveState, useDriveStore} from '../drive-store';\r\nimport {EntryAction} from './entry-action';\r\nimport {DriveEntry} from '../files/drive-entry';\r\nimport {RemoveRedEyeIcon} from '@common/icons/material/RemoveRedEye';\r\nimport {LinkIcon} from '@common/icons/material/Link';\r\nimport {useCreateShareableLink} from '../shareable-link/queries/create-shareable-link';\r\nimport {StarIcon} from '@common/icons/material/Star';\r\nimport {useAddStarToEntries} from '../files/queries/use-add-star-to-entries';\r\nimport {StarOutlineIcon} from '@common/icons/material/StarOutline';\r\nimport {useRemoveStarFromEntries} from '../files/queries/use-remove-star-from-entries';\r\nimport {DriveFileMoveIcon} from '@common/icons/material/DriveFileMove';\r\nimport {DriveFileRenameOutlineIcon} from '@common/icons/material/DriveFileRenameOutline';\r\nimport {ContentCopyIcon} from '@common/icons/material/ContentCopy';\r\nimport {useDuplicateEntries} from '../files/queries/use-duplicate-entries';\r\nimport {FileDownloadIcon} from '@common/icons/material/FileDownload';\r\nimport {DeleteIcon} from '@common/icons/material/Delete';\r\nimport {SharesPage, TrashPage} from '../drive-page/drive-page';\r\nimport {useDeleteEntries} from '../files/queries/use-delete-entries';\r\nimport {useUnshareEntries} from '../share-dialog/queries/use-unshare-entries';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\nimport {useFileEntryUrls} from '@common/uploads/hooks/file-entry-urls';\r\nimport {downloadFileFromUrl} from '@common/uploads/utils/download-file-from-url';\r\nimport {useRestoreEntries} from '../files/queries/use-restore-entries';\r\nimport {RestoreIcon} from '@common/icons/material/Restore';\r\n\r\nexport function useEntryActions(entries: DriveEntry[]): EntryAction[] {\r\n  const preview = usePreviewAction(entries);\r\n  const share = useShareAction(entries);\r\n  const getLink = useGetLinkAction(entries);\r\n  const addStar = useAddToStarredAction(entries);\r\n  const removeStar = useRemoveFromStarred(entries);\r\n  const moveTo = useMoveToAction(entries);\r\n  const rename = useRenameAction(entries);\r\n  const makeCopy = useMakeCopyAction(entries);\r\n  const download = useDownloadEntriesAction(entries);\r\n  const deleteAction = useDeleteEntriesAction(entries);\r\n  const removeSharedEntries = useRemoveSharedEntriesAction(entries);\r\n  const restoreEntries = useRestoreEntriesAction(entries);\r\n\r\n  return [\r\n    preview,\r\n    share,\r\n    getLink,\r\n    addStar,\r\n    removeStar,\r\n    moveTo,\r\n    rename,\r\n    makeCopy,\r\n    download,\r\n    deleteAction,\r\n    removeSharedEntries,\r\n    restoreEntries,\r\n  ].filter(action => !!action) as EntryAction[];\r\n}\r\n\r\nexport function usePreviewAction(\r\n  entries: DriveEntry[],\r\n): EntryAction | undefined {\r\n  if (!entries.some(e => e.type !== 'folder')) return;\r\n  return {\r\n    label: message('Preview'),\r\n    icon: RemoveRedEyeIcon,\r\n    key: 'preview',\r\n    execute: () => {\r\n      driveState().setActiveActionDialog('preview', entries);\r\n    },\r\n  };\r\n}\r\n\r\nexport function useShareAction(entries: DriveEntry[]): EntryAction | undefined {\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  if (\r\n    entries.length > 1 ||\r\n    !entries.every(e => e.permissions['files.update']) ||\r\n    activePage === TrashPage\r\n  )\r\n    return;\r\n\r\n  return {\r\n    label: message('Share'),\r\n    icon: PersonAddIcon,\r\n    key: 'share',\r\n    execute: () => {\r\n      driveState().setActiveActionDialog('share', entries);\r\n    },\r\n  };\r\n}\r\n\r\nfunction useGetLinkAction(entries: DriveEntry[]): EntryAction | undefined {\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  const createLink = useCreateShareableLink();\r\n  if (\r\n    entries.length > 1 ||\r\n    !entries.every(e => e.permissions['files.update']) ||\r\n    activePage === TrashPage\r\n  ) {\r\n    return;\r\n  }\r\n  return {\r\n    label: message('Get link'),\r\n    icon: LinkIcon,\r\n    key: 'getLink',\r\n    execute: () => {\r\n      createLink.mutate({entryId: entries[0].id});\r\n      driveState().setActiveActionDialog('getLink', entries);\r\n    },\r\n  };\r\n}\r\n\r\nfunction useAddToStarredAction(entries: DriveEntry[]): EntryAction | undefined {\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  const starEntries = useAddStarToEntries();\r\n  if (\r\n    entries.every(e => e.tags?.find(tag => tag.name === 'starred')) ||\r\n    !entries.every(e => e.permissions['files.update']) ||\r\n    activePage === TrashPage\r\n  ) {\r\n    return;\r\n  }\r\n  return {\r\n    label: message('Add to starred'),\r\n    icon: StarIcon,\r\n    key: 'addToStarred',\r\n    execute: () => {\r\n      starEntries.mutate({entryIds: entries.map(e => e.id)});\r\n      driveState().selectEntries([]);\r\n    },\r\n  };\r\n}\r\n\r\nfunction useRemoveFromStarred(entries: DriveEntry[]): EntryAction | undefined {\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  const removeStar = useRemoveStarFromEntries();\r\n  if (\r\n    !entries.every(e => e.tags?.find(tag => tag.name === 'starred')) ||\r\n    activePage === TrashPage\r\n  )\r\n    return;\r\n  return {\r\n    label: message('Remove from starred'),\r\n    icon: StarOutlineIcon,\r\n    key: 'removeFromStarred',\r\n    execute: () => {\r\n      removeStar.mutate({entryIds: entries.map(e => e.id)});\r\n      driveState().selectEntries([]);\r\n    },\r\n  };\r\n}\r\n\r\nfunction useMoveToAction(entries: DriveEntry[]): EntryAction | undefined {\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  if (\r\n    !entries.every(e => e.permissions['files.update']) ||\r\n    activePage === SharesPage ||\r\n    activePage === TrashPage\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  return {\r\n    label: message('Move to'),\r\n    icon: DriveFileMoveIcon,\r\n    key: 'moveTo',\r\n    execute: () => {\r\n      driveState().setActiveActionDialog('moveTo', entries);\r\n    },\r\n  };\r\n}\r\n\r\nfunction useRenameAction(entries: DriveEntry[]): EntryAction | undefined {\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  if (\r\n    entries.length > 1 ||\r\n    !entries.every(e => e.permissions['files.update']) ||\r\n    activePage === TrashPage\r\n  )\r\n    return;\r\n  return {\r\n    label: message('Rename'),\r\n    icon: DriveFileRenameOutlineIcon,\r\n    key: 'rename',\r\n    execute: () => {\r\n      driveState().setActiveActionDialog('rename', entries);\r\n    },\r\n  };\r\n}\r\n\r\nfunction useMakeCopyAction(entries: DriveEntry[]): EntryAction | undefined {\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  const duplicateEntries = useDuplicateEntries();\r\n  if (\r\n    entries.length > 1 ||\r\n    !entries.every(e => e.permissions['files.update']) ||\r\n    activePage === TrashPage\r\n  ) {\r\n    return;\r\n  }\r\n  return {\r\n    label: message('Make a copy'),\r\n    icon: ContentCopyIcon,\r\n    key: 'makeCopy',\r\n    execute: () => {\r\n      duplicateEntries.mutate({\r\n        entryIds: entries.map(e => e.id),\r\n        destinationId: activePage?.folder?.id,\r\n      });\r\n      driveState().selectEntries([]);\r\n    },\r\n  };\r\n}\r\n\r\nfunction useDownloadEntriesAction(\r\n  entries: DriveEntry[],\r\n): EntryAction | undefined {\r\n  const {downloadUrl} = useFileEntryUrls(entries[0], {\r\n    downloadHashes: entries.map(e => e.hash),\r\n  });\r\n  if (!entries.every(e => e.permissions['files.download'])) return;\r\n  return {\r\n    label: message('Download'),\r\n    icon: FileDownloadIcon,\r\n    key: 'download',\r\n    execute: () => {\r\n      if (downloadUrl) {\r\n        downloadFileFromUrl(downloadUrl);\r\n      }\r\n      driveState().selectEntries([]);\r\n    },\r\n  };\r\n}\r\n\r\nexport function useDeleteEntriesAction(\r\n  entries: DriveEntry[],\r\n): EntryAction | undefined {\r\n  const deleteEntries = useDeleteEntries();\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  if (\r\n    activePage === SharesPage ||\r\n    !entries.every(e => e.permissions['files.delete'])\r\n  )\r\n    return;\r\n  return {\r\n    label:\r\n      activePage === TrashPage ? message('Delete forever') : message('Remove'),\r\n    icon: DeleteIcon,\r\n    key: 'delete',\r\n    execute: () => {\r\n      if (activePage === TrashPage) {\r\n        driveState().setActiveActionDialog('confirmAndDeleteForever', entries);\r\n      } else {\r\n        deleteEntries.mutate({\r\n          entryIds: entries.map(e => e.id),\r\n          deleteForever: activePage === TrashPage,\r\n        });\r\n        driveState().selectEntries([]);\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\nexport function useRestoreEntriesAction(\r\n  entries: DriveEntry[],\r\n): EntryAction | undefined {\r\n  const restoreEntries = useRestoreEntries();\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  if (\r\n    activePage !== TrashPage ||\r\n    !entries.every(e => e.permissions['files.delete'])\r\n  )\r\n    return;\r\n  return {\r\n    label: message('Restore'),\r\n    icon: RestoreIcon,\r\n    key: 'restore',\r\n    execute: () => {\r\n      restoreEntries.mutate({\r\n        entryIds: entries.map(e => e.id),\r\n      });\r\n      driveState().selectEntries([]);\r\n    },\r\n  };\r\n}\r\n\r\nexport function useRemoveSharedEntriesAction(\r\n  entries: DriveEntry[],\r\n): EntryAction | undefined {\r\n  const unshareEntries = useUnshareEntries();\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  if (activePage !== SharesPage) return;\r\n  return {\r\n    label: message('Remove'),\r\n    icon: DeleteIcon,\r\n    key: 'removeSharedEntry',\r\n    execute: () => {\r\n      unshareEntries.mutate(\r\n        {entryIds: entries.map(e => e.id), userId: 'me'},\r\n        {\r\n          onSuccess: (r, p) => {\r\n            toast(\r\n              message('Removed [one 1 item|other {count} items]', {\r\n                values: {count: p.entryIds.length},\r\n              }),\r\n            );\r\n          },\r\n          onError: err =>\r\n            showHttpErrorToast(err, message('Could not remove items')),\r\n        },\r\n      );\r\n      driveState().selectEntries([]);\r\n    },\r\n  };\r\n}\r\n","import {useQuery} from '@tanstack/react-query';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {prettyBytes} from '@common/uploads/utils/pretty-bytes';\r\nimport {DriveQueryKeys} from '../../../drive-query-keys';\r\nimport {apiClient} from '@common/http/query-client';\r\n\r\nexport interface FetchStorageSummaryResponse extends BackendResponse {\r\n  used: number;\r\n  available: number;\r\n}\r\n\r\nexport function useStorageSummary() {\r\n  return useQuery({\r\n    queryKey: DriveQueryKeys.fetchStorageSummary,\r\n    queryFn: fetchStorageSummary,\r\n    select: formatResponse,\r\n  });\r\n}\r\n\r\nfunction fetchStorageSummary(): Promise<FetchStorageSummaryResponse> {\r\n  return apiClient.get(`user/space-usage`).then(response => response.data);\r\n}\r\n\r\nfunction formatResponse(response: FetchStorageSummaryResponse) {\r\n  // null means that user has unlimited space available\r\n  const percentage =\r\n    response.available === null\r\n      ? 0\r\n      : (response.used * 100) / response.available;\r\n\r\n  return {\r\n    usedFormatted: prettyBytes(response.used, 2),\r\n    availableFormatted: prettyBytes(response.available, 0),\r\n    percentage,\r\n    used: response.used,\r\n    available: response.available,\r\n  };\r\n}\r\n","import {useFileUploadStore} from '@common/uploads/uploader/file-upload-provider';\r\nimport {useCallback} from 'react';\r\nimport {driveState} from '../drive-store';\r\nimport {UploadedFile} from '@common/uploads/uploaded-file';\r\nimport {UploadStrategyConfig} from '@common/uploads/uploader/strategy/upload-strategy';\r\nimport {queryClient} from '@common/http/query-client';\r\nimport {DriveQueryKeys, invalidateEntryQueries} from '../drive-query-keys';\r\nimport {useStorageSummary} from '../layout/sidebar/storage-summary/storage-summary';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {message} from '@common/i18n/message';\r\nimport {useSettings} from '@common/core/settings/use-settings';\r\nimport {getActiveWorkspaceId} from '@common/workspace/active-workspace-id';\r\n\r\nexport type UploadFilesFn = (\r\n  files: (File | UploadedFile)[] | FileList,\r\n  options?: UploadStrategyConfig,\r\n) => void;\r\n\r\nconst EightMB = 8388608;\r\n\r\nexport function useDriveUploadQueue() {\r\n  const uploadMultiple = useFileUploadStore(s => s.uploadMultiple);\r\n  const {data: usage} = useStorageSummary();\r\n\r\n  const {uploads} = useSettings();\r\n\r\n  const maxFileSize = uploads.max_size || EightMB;\r\n  const allowedFileTypes = uploads.allowed_extensions;\r\n  const blockedFileTypes = uploads.blocked_extensions;\r\n\r\n  const uploadFiles: UploadFilesFn = useCallback(\r\n    (files, options = {}) => {\r\n      if (!options.metadata) {\r\n        options.metadata = {};\r\n      }\r\n      options.metadata.workspaceId = getActiveWorkspaceId();\r\n      if (!options.metadata.parentId) {\r\n        options.metadata.parentId = driveState().activePage?.folder?.id ?? null;\r\n      }\r\n\r\n      files = [...files].map(file => {\r\n        return file instanceof UploadedFile ? file : new UploadedFile(file);\r\n      });\r\n\r\n      // check if this upload will not put user over their allowed storage space\r\n      if (usage) {\r\n        const sizeOfFiles = files.reduce((sum, file) => sum + file.size, 0);\r\n        const currentlyUsing = usage.used;\r\n        const availableSpace = usage.available;\r\n\r\n        if (sizeOfFiles + currentlyUsing > availableSpace) {\r\n          toast.danger(\r\n            message(\r\n              'You have exhausted your allowed space of :space. Delete some files or upgrade your plan.',\r\n              {values: {space: usage.availableFormatted}},\r\n            ),\r\n            {action: {action: '/pricing', label: message('Upgrade')}},\r\n          );\r\n          return;\r\n        }\r\n      }\r\n\r\n      uploadMultiple(files, {\r\n        ...options,\r\n        restrictions: {\r\n          maxFileSize,\r\n          allowedFileTypes,\r\n          blockedFileTypes,\r\n        },\r\n        onSuccess: (entry, file) => {\r\n          options?.onSuccess?.(entry, file);\r\n          invalidateEntryQueries();\r\n          queryClient.invalidateQueries({\r\n            queryKey: DriveQueryKeys.fetchStorageSummary,\r\n          });\r\n        },\r\n      });\r\n      driveState().setUploadQueueIsOpen(true);\r\n    },\r\n    [uploadMultiple, allowedFileTypes, blockedFileTypes, maxFileSize, usage],\r\n  );\r\n  return {uploadFiles};\r\n}\r\n","import {EntryAction} from './entry-action';\r\nimport {message} from '@common/i18n/message';\r\nimport {driveState, useDriveStore} from '../drive-store';\r\nimport {DrivePage, TrashPage} from '../drive-page/drive-page';\r\nimport {CreateNewFolderIcon} from '@common/icons/material/CreateNewFolder';\r\nimport {useDriveUploadQueue} from '../uploading/use-drive-upload-queue';\r\nimport {openUploadWindow} from '@common/uploads/utils/open-upload-window';\r\nimport {FileUploadIcon} from '@common/icons/material/FileUpload';\r\nimport {DriveFolderUploadIcon} from '@common/icons/material/DriveFolderUpload';\r\nimport {useDeleteEntries} from '../files/queries/use-delete-entries';\r\nimport {DeleteForeverIcon} from '@common/icons/material/DeleteForever';\r\n\r\nexport function useDrivePageActions(page: DrivePage): EntryAction[] {\r\n  const newFolder = useNewFolderAction(page);\r\n  const uploadFiles = useUploadFilesAction(page);\r\n  const uploadFolder = useUploadFolderAction(page);\r\n  const emptyTrash = useEmptyTrashAction(page);\r\n  return [newFolder, uploadFiles, uploadFolder, emptyTrash].filter(\r\n    action => !!action\r\n  ) as EntryAction[];\r\n}\r\n\r\nfunction useNewFolderAction(page: DrivePage): EntryAction | undefined {\r\n  if (!page.folder || !page.folder.permissions['files.update']) return;\r\n  return {\r\n    label: message('New folder'),\r\n    icon: CreateNewFolderIcon,\r\n    key: 'newFolder',\r\n    execute: () => {\r\n      if (page.folder) {\r\n        driveState().setActiveActionDialog('newFolder', [page.folder]);\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\nfunction useUploadFilesAction(page: DrivePage): EntryAction | undefined {\r\n  const {uploadFiles} = useDriveUploadQueue();\r\n  if (!page.folder || !page.folder.permissions['files.update']) return;\r\n  return {\r\n    label: message('Upload files'),\r\n    icon: FileUploadIcon,\r\n    key: 'uploadFiles',\r\n    execute: async () => {\r\n      uploadFiles(await openUploadWindow({multiple: true}));\r\n    },\r\n  };\r\n}\r\n\r\nfunction useUploadFolderAction(page: DrivePage): EntryAction | undefined {\r\n  const {uploadFiles} = useDriveUploadQueue();\r\n  if (!page.folder || !page.folder.permissions['files.update']) return;\r\n  return {\r\n    label: message('Upload folder'),\r\n    icon: DriveFolderUploadIcon,\r\n    key: 'uploadFolder',\r\n    execute: async () => {\r\n      uploadFiles(await openUploadWindow({directory: true}));\r\n    },\r\n  };\r\n}\r\n\r\nfunction useEmptyTrashAction(page: DrivePage): EntryAction | undefined {\r\n  const deleteEntries = useDeleteEntries();\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  if (activePage !== TrashPage) return;\r\n  return {\r\n    label: message('Empty trash'),\r\n    icon: DeleteForeverIcon,\r\n    key: 'emptyTrash',\r\n    execute: () => {\r\n      deleteEntries.mutate({entryIds: [], emptyTrash: true});\r\n      driveState().selectEntries([]);\r\n    },\r\n  };\r\n}\r\n","import React, {createElement, ReactElement} from 'react';\r\nimport {\r\n  Menu,\r\n  MenuItem,\r\n  MenuTrigger,\r\n} from '@common/ui/navigation/menu/menu-trigger';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {DriveEntry} from '../files/drive-entry';\r\nimport {useEntryActions} from './use-entry-actions';\r\nimport {EntryAction} from './entry-action';\r\nimport {DrivePage, RootFolderPage, TrashPage} from '../drive-page/drive-page';\r\nimport {useDrivePageActions} from './use-drive-page-actions';\r\n\r\ninterface Props {\r\n  children: ReactElement;\r\n  entries?: DriveEntry[];\r\n  page?: DrivePage;\r\n}\r\nexport function EntryActionMenuTrigger({children, entries, page}: Props) {\r\n  if (page?.name === RootFolderPage.name) {\r\n    return <PageMenu page={RootFolderPage}>{children}</PageMenu>;\r\n  }\r\n\r\n  if (page === TrashPage) {\r\n    return <PageMenu page={TrashPage}>{children}</PageMenu>;\r\n  }\r\n\r\n  if (page?.folder) {\r\n    return <EntriesMenu entries={[page.folder]}>{children}</EntriesMenu>;\r\n  }\r\n\r\n  if (entries?.length) {\r\n    return <EntriesMenu entries={entries}>{children}</EntriesMenu>;\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\ninterface EntriesContextMenuProps extends Omit<BaseMenuProps, 'actions'> {\r\n  entries: DriveEntry[];\r\n}\r\nfunction EntriesMenu({entries, children}: EntriesContextMenuProps) {\r\n  const actions = useEntryActions(entries);\r\n  return <BaseMenu actions={actions}>{children}</BaseMenu>;\r\n}\r\n\r\ninterface PageContextMenuProps extends Omit<BaseMenuProps, 'actions'> {\r\n  page: DrivePage;\r\n}\r\nfunction PageMenu({page, children}: PageContextMenuProps) {\r\n  const actions = useDrivePageActions(page);\r\n  return <BaseMenu actions={actions}>{children}</BaseMenu>;\r\n}\r\n\r\ninterface BaseMenuProps {\r\n  actions: EntryAction[];\r\n  children: ReactElement;\r\n}\r\nfunction BaseMenu({actions, children}: BaseMenuProps) {\r\n  return (\r\n    <MenuTrigger>\r\n      {children}\r\n      <Menu>\r\n        {actions.map(action => {\r\n          return (\r\n            <MenuItem\r\n              onSelected={() => {\r\n                action.execute();\r\n              }}\r\n              key={action.key}\r\n              value={action.key}\r\n              startIcon={createElement(action.icon)}\r\n            >\r\n              <Trans {...action.label} />\r\n            </MenuItem>\r\n          );\r\n        })}\r\n      </Menu>\r\n    </MenuTrigger>\r\n  );\r\n}\r\n","import {ColumnConfig} from '@common/datatable/column-config';\r\nimport {DriveEntry} from '../../files/drive-entry';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {FileThumbnail} from '@common/uploads/file-type-icon/file-thumbnail';\r\nimport {FormattedDate} from '@common/i18n/formatted-date';\r\nimport {prettyBytes} from '@common/uploads/utils/pretty-bytes';\r\nimport React, {useContext} from 'react';\r\nimport memoize from 'nano-memoize';\r\nimport {TableContext} from '@common/ui/tables/table-context';\r\nimport {Checkbox} from '@common/ui/forms/toggle/checkbox';\r\nimport {EntryActionMenuTrigger} from '@app/drive/entry-actions/entry-action-menu-trigger';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {MoreVertIcon} from '@common/icons/material/MoreVert';\r\nimport clsx from 'clsx';\r\n\r\nconst formatFileSize = memoize(bytes => {\r\n  return prettyBytes(bytes);\r\n});\r\n\r\nexport const fileTableColumns: ColumnConfig<DriveEntry>[] = [\r\n  {\r\n    key: 'name',\r\n    allowsSorting: true,\r\n    header: () => <Trans message=\"Name\" />,\r\n    visibleInMode: 'all',\r\n    width: 'flex-3 min-w-200',\r\n    body: entry => <FileNameColumn entry={entry} />,\r\n  },\r\n  {\r\n    key: 'updated_at',\r\n    allowsSorting: true,\r\n    maxWidth: 'max-w-184',\r\n    header: () => <Trans message=\"Last modified\" />,\r\n    body: user => <FormattedDate date={user.updated_at} />,\r\n  },\r\n  {\r\n    key: 'file_size',\r\n    allowsSorting: true,\r\n    header: () => <Trans message=\"Size\" />,\r\n    maxWidth: 'max-w-144',\r\n    body: entry => formatFileSize(entry.file_size) ?? '-',\r\n  },\r\n  {\r\n    key: 'actions',\r\n    hideHeader: true,\r\n    header: () => <Trans message=\"Actions\" />,\r\n    align: 'end',\r\n    width: 'w-42 flex-shrink-0',\r\n    visibleInMode: 'all',\r\n    body: entry => <ActionsColumn entry={entry} />,\r\n  },\r\n];\r\n\r\nfunction FileNameColumn({entry}: {entry: DriveEntry}) {\r\n  const {isCollapsedMode} = useContext(TableContext);\r\n  const sizeClassName = isCollapsedMode ? 'w-30 h-30' : 'w-24 h-24';\r\n  return (\r\n    <div className=\"flex items-center gap-14\">\r\n      <FileThumbnail\r\n        className={clsx('rounded', sizeClassName)}\r\n        iconClassName={sizeClassName}\r\n        file={entry}\r\n      />\r\n      <div className=\"min-w-0\">\r\n        <div className=\"overflow-hidden overflow-ellipsis\">{entry.name}</div>\r\n        {isCollapsedMode && (\r\n          <div className=\"text-muted text-xs flex items-center mt-4\">\r\n            <FormattedDate date={entry.updated_at} />\r\n            <div></div>\r\n            <div>{formatFileSize(entry.file_size)}</div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface ActionsBodyProps {\r\n  entry: DriveEntry;\r\n}\r\nfunction ActionsColumn({entry}: ActionsBodyProps) {\r\n  const {selectedRows} = useContext(TableContext);\r\n  return selectedRows.length ? (\r\n    <Checkbox\r\n      className=\"block mr-8\"\r\n      checked={selectedRows.includes(entry.id)}\r\n    />\r\n  ) : (\r\n    <EntryActionMenuTrigger entries={[entry]}>\r\n      <IconButton className=\"text-muted\">\r\n        <MoreVertIcon />\r\n      </IconButton>\r\n    </EntryActionMenuTrigger>\r\n  );\r\n}\r\n","import {useIsMobileMediaQuery} from '@common/utils/hooks/is-mobile-media-query';\r\nimport {DriveSortDescriptor} from '../../../drive-store';\r\nimport React from 'react';\r\nimport {Table} from '@common/ui/tables/table';\r\nimport {linkPageState, useLinkPageStore} from '../link-page-store';\r\nimport type {FolderPreviewGridProps} from './folder-preview-file-grid';\r\nimport {fileTableColumns} from '../../../file-view/file-table/file-table-columns';\r\n\r\nconst mobileColumns = fileTableColumns.filter(\r\n  config => config.key !== 'updated_at'\r\n);\r\n\r\nexport function FolderPreviewFileTable({\r\n  entries,\r\n  onEntrySelected,\r\n}: FolderPreviewGridProps) {\r\n  const sortDescriptor = useLinkPageStore(s => s.activeSort);\r\n  const isMobile = useIsMobileMediaQuery();\r\n\r\n  return (\r\n    <Table\r\n      columns={isMobile ? mobileColumns : fileTableColumns}\r\n      data={entries}\r\n      sortDescriptor={sortDescriptor}\r\n      onSortChange={value => {\r\n        linkPageState().setActiveSort(value as DriveSortDescriptor);\r\n      }}\r\n      onAction={(item, index) => {\r\n        onEntrySelected(item, index);\r\n      }}\r\n      enableSelection={false}\r\n    />\r\n  );\r\n}\r\n","import {useShareableLinkPage} from '../../queries/use-shareable-link-page';\r\nimport {useNavigate} from 'react-router-dom';\r\nimport {ShareableLink} from '../../shareable-link';\r\n\r\nfunction buildFolderHash(link: ShareableLink, folderHash?: string) {\r\n  let hash = link.hash;\r\n  if (folderHash && link.entry?.hash !== folderHash) {\r\n    hash = `${hash}:${folderHash}`;\r\n  }\r\n  return hash;\r\n}\r\n\r\nexport function useNavigateToSubfolder() {\r\n  const {link} = useShareableLinkPage();\r\n  const navigate = useNavigate();\r\n  return (hash: string) => {\r\n    if (!link) return;\r\n    navigate(`/drive/s/${buildFolderHash(link, hash)}`);\r\n  };\r\n}\r\n","import {AnimatePresence, m} from 'framer-motion';\r\nimport React, {useEffect, useRef, useState} from 'react';\r\nimport {ProgressCircle} from '@common/ui/progress/progress-circle';\r\nimport {useShareableLinkPage} from '../../queries/use-shareable-link-page';\r\nimport {FilePreviewDialog} from '@common/uploads/preview/file-preview-dialog';\r\nimport {DialogTrigger} from '@common/ui/overlays/dialog/dialog-trigger';\r\nimport clsx from 'clsx';\r\nimport {DriveEntry} from '../../../files/drive-entry';\r\nimport {FolderPreviewFileGrid} from './folder-preview-file-grid';\r\nimport {useLinkPageStore} from '../link-page-store';\r\nimport {FolderPreviewFileTable} from './folder-preview-file-table';\r\nimport {useNavigateToSubfolder} from './use-navigate-to-subfolder';\r\nimport {useLocation} from 'react-router-dom';\r\nimport {opacityAnimation} from '@common/ui/animation/opacity-animation';\r\nimport {AdHost} from '@common/admin/ads/ad-host';\r\n\r\ninterface FolderPreviewChildrenProps {\r\n  className?: string;\r\n}\r\nexport function FolderPreviewFileView({className}: FolderPreviewChildrenProps) {\r\n  const {pathname} = useLocation();\r\n  const navigateToSubfolder = useNavigateToSubfolder();\r\n  const [activePreviewIndex, setActivePreviewIndex] = useState<number>();\r\n  const viewMode = useLinkPageStore(s => s.viewMode);\r\n  const sentinelRef = useRef<HTMLDivElement>(null);\r\n  const {\r\n    link,\r\n    entries,\r\n    isFetchingNextPage,\r\n    hasNextPage,\r\n    fetchNextPage,\r\n    isPlaceholderData,\r\n  } = useShareableLinkPage();\r\n\r\n  // close preview modal on back/forward navigation\r\n  useEffect(() => {\r\n    setActivePreviewIndex(undefined);\r\n  }, [pathname]);\r\n\r\n  useEffect(() => {\r\n    const sentinelEl = sentinelRef.current;\r\n    if (!sentinelEl) return;\r\n    const observer = new IntersectionObserver(([entry]) => {\r\n      if (entry.isIntersecting && hasNextPage) {\r\n        fetchNextPage();\r\n      }\r\n    });\r\n    observer.observe(sentinelEl);\r\n    return () => {\r\n      observer.unobserve(sentinelEl);\r\n    };\r\n  }, [hasNextPage, fetchNextPage]);\r\n\r\n  if (!link || isPlaceholderData) {\r\n    return (\r\n      <div className={clsx('flex justify-center', className)}>\r\n        <ProgressCircle isIndeterminate />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const handlePreview = (entry: DriveEntry, index: number) => {\r\n    if (entry.type === 'folder') {\r\n      navigateToSubfolder(entry.hash);\r\n    } else {\r\n      setActivePreviewIndex(index);\r\n    }\r\n  };\r\n\r\n  const folderEntries = entries || [];\r\n\r\n  return (\r\n    <>\r\n      <div\r\n        className={clsx(\r\n          'file-grid-container flex-auto overflow-auto px-14 pb-14 md:px-24 md:pb-24',\r\n          className,\r\n        )}\r\n      >\r\n        <AdHost slot=\"file-preview\" className=\"mb-40\" />\r\n        {viewMode === 'grid' ? (\r\n          <FolderPreviewFileGrid\r\n            entries={folderEntries}\r\n            onEntrySelected={handlePreview}\r\n          />\r\n        ) : (\r\n          <FolderPreviewFileTable\r\n            entries={folderEntries}\r\n            onEntrySelected={handlePreview}\r\n          />\r\n        )}\r\n        <span ref={sentinelRef} aria-hidden />\r\n        <AnimatePresence>\r\n          {isFetchingNextPage && (\r\n            <m.div\r\n              className=\"mt-24 flex w-full justify-center\"\r\n              {...opacityAnimation}\r\n            >\r\n              <ProgressCircle isIndeterminate aria-label=\"loading\" />\r\n            </m.div>\r\n          )}\r\n        </AnimatePresence>\r\n      </div>\r\n      <DialogTrigger\r\n        type=\"modal\"\r\n        isOpen={activePreviewIndex != undefined}\r\n        onClose={() => setActivePreviewIndex(undefined)}\r\n      >\r\n        <FilePreviewDialog\r\n          entries={folderEntries}\r\n          defaultActiveIndex={activePreviewIndex}\r\n          allowDownload={link.allow_download}\r\n        />\r\n      </DialogTrigger>\r\n    </>\r\n  );\r\n}\r\n","import {ReactNode} from 'react';\r\nimport clsx from 'clsx';\r\n\r\ninterface DashboardContentHeaderProps {\r\n  children: ReactNode;\r\n  className?: string;\r\n}\r\nexport function DashboardContentHeader({\r\n  children,\r\n  className,\r\n}: DashboardContentHeaderProps) {\r\n  return (\r\n    <div className={clsx(className, 'dashboard-grid-header')}>{children}</div>\r\n  );\r\n}\r\n","import {useQuery} from '@tanstack/react-query';\r\nimport {DriveFolder} from '../drive-entry';\r\nimport {DriveQueryKeys} from '../../drive-query-keys';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {apiClient} from '@common/http/query-client';\r\n\r\ninterface FolderPathResponse extends BackendResponse {\r\n  path: DriveFolder[];\r\n}\r\n\r\ntype Params = Record<string, string | number | null>;\r\n\r\ninterface Props {\r\n  hash?: string;\r\n  params?: Params;\r\n  isEnabled?: boolean;\r\n}\r\nexport function useFolderPath({hash, params, isEnabled = true}: Props) {\r\n  return useQuery({\r\n    queryKey: DriveQueryKeys.fetchFolderPath(hash!, params),\r\n    queryFn: () => fetchFolderPath(hash!, params),\r\n    enabled: !!hash && isEnabled,\r\n  });\r\n}\r\n\r\nfunction fetchFolderPath(\r\n  hash: string,\r\n  params?: Params,\r\n): Promise<FolderPathResponse> {\r\n  return apiClient\r\n    .get(`folders/${hash}/path`, {params})\r\n    .then(response => response.data);\r\n}\r\n","import React, {ReactElement, ReactNode} from 'react';\r\nimport clsx from 'clsx';\r\nimport {DriveFolder} from '../../../files/drive-entry';\r\nimport {useFolderPath} from '../../../files/queries/use-folder-path';\r\nimport {Breadcrumb} from '@common/ui/breadcrumbs/breadcrumb';\r\nimport {ShareableLink} from '../../shareable-link';\r\nimport {useLinkPageStore} from '../link-page-store';\r\nimport {BreadcrumbItem} from '@common/ui/breadcrumbs/breadcrumb-item';\r\nimport {useNavigateToSubfolder} from './use-navigate-to-subfolder';\r\n\r\ninterface Props {\r\n  className?: string;\r\n  folder?: DriveFolder;\r\n  link: ShareableLink;\r\n}\r\nexport function FolderPreviewBreadcrumb({className, folder, link}: Props) {\r\n  const navigateToSubfolder = useNavigateToSubfolder();\r\n  const password = useLinkPageStore(s => s.password);\r\n  const query = useFolderPath({\r\n    hash: folder?.hash,\r\n    params: {\r\n      shareable_link: link.id,\r\n      password,\r\n    },\r\n  });\r\n\r\n  let content: ReactNode;\r\n\r\n  if (query.isLoading) {\r\n    content = null;\r\n  } else {\r\n    const items: {folder: DriveFolder; label: ReactElement}[] = [];\r\n    if (query.data) {\r\n      query.data.path.forEach(parent => {\r\n        items.push({\r\n          folder: parent,\r\n          label: <>{parent.name}</>,\r\n        });\r\n      });\r\n    }\r\n\r\n    content = (\r\n      <Breadcrumb size=\"lg\" isNavigation>\r\n        {items.map(item => {\r\n          return (\r\n            <BreadcrumbItem\r\n              onSelected={() => {\r\n                navigateToSubfolder(item.folder.hash);\r\n              }}\r\n              key={item.folder.hash}\r\n            >\r\n              {item.label}\r\n            </BreadcrumbItem>\r\n          );\r\n        })}\r\n      </Breadcrumb>\r\n    );\r\n  }\r\n\r\n  return <div className={clsx('h-36 flex-shrink-0', className)}>{content}</div>;\r\n}\r\n","import {message} from '@common/i18n/message';\r\nimport {MessageDescriptor} from '@common/i18n/message-descriptor';\r\n\r\nexport const AVAILABLE_SORTS: DriveSortOption[] = [\r\n  {id: 'file_size', label: message('Size')},\r\n  {id: 'name', label: message('Name')},\r\n  {id: 'updated_at', label: message('Last modified')},\r\n  {id: 'created_at', label: message('Upload date')},\r\n  {id: 'type', label: message('Type')},\r\n  {id: 'extension', label: message('Extension')},\r\n];\r\n\r\nexport interface DriveSortOption {\r\n  id: SortColumn;\r\n  label: MessageDescriptor;\r\n}\r\n\r\nexport type SortColumn =\r\n  | 'file_size'\r\n  | 'name'\r\n  | 'updated_at'\r\n  | 'created_at'\r\n  | 'type'\r\n  | 'extension';\r\n\r\nexport type SortDirection = 'desc' | 'asc';\r\n\r\nexport interface SortValue {\r\n  column: SortColumn;\r\n  direction: SortDirection;\r\n}\r\n","import {AVAILABLE_SORTS, SortColumn} from './available-sorts';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {SortIcon} from '@common/icons/material/Sort';\r\nimport {\r\n  Menu,\r\n  MenuItem,\r\n  MenuSection,\r\n  MenuTrigger,\r\n} from '@common/ui/navigation/menu/menu-trigger';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport type {DriveSortDescriptor} from '../../drive-store';\r\n\r\ninterface Props {\r\n  descriptor: DriveSortDescriptor;\r\n  onChange: (value: DriveSortDescriptor) => void;\r\n  isDisabled?: boolean;\r\n}\r\nexport function EntriesSortButton({\r\n  descriptor,\r\n  onChange,\r\n  isDisabled = false,\r\n}: Props) {\r\n  const column = descriptor.orderBy;\r\n  const direction = descriptor.orderDir;\r\n  const sort = AVAILABLE_SORTS.find(s => s.id === column);\r\n\r\n  return (\r\n    <MenuTrigger\r\n      showCheckmark\r\n      selectionMode=\"multiple\"\r\n      selectedValue={[direction || 'desc', column || '']}\r\n      onItemSelected={key => {\r\n        if (key === 'asc' || key === 'desc') {\r\n          onChange({\r\n            orderBy: column,\r\n            orderDir: key,\r\n          });\r\n        } else {\r\n          onChange({\r\n            orderBy: key as SortColumn,\r\n            orderDir: direction,\r\n          });\r\n        }\r\n      }}\r\n    >\r\n      <Button\r\n        className=\"text-muted\"\r\n        variant=\"text\"\r\n        size=\"sm\"\r\n        startIcon={<SortIcon />}\r\n        disabled={isDisabled}\r\n      >\r\n        {sort ? <Trans {...sort.label} /> : null}\r\n      </Button>\r\n      <Menu>\r\n        <MenuSection label={<Trans message=\"Direction\" />}>\r\n          <MenuItem value=\"asc\">\r\n            <Trans message=\"Ascending\" />\r\n          </MenuItem>\r\n          <MenuItem value=\"desc\">\r\n            <Trans message=\"Descending\" />\r\n          </MenuItem>\r\n        </MenuSection>\r\n        <MenuSection label={<Trans message=\"Sort By\" />}>\r\n          {AVAILABLE_SORTS.map(item => (\r\n            <MenuItem key={item.id} value={item.id}>\r\n              <Trans {...item.label} />\r\n            </MenuItem>\r\n          ))}\r\n        </MenuSection>\r\n      </Menu>\r\n    </MenuTrigger>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport {FolderPreviewBreadcrumb} from './folder-preview-breadcrumb';\r\nimport {EntriesSortButton} from '../../../layout/sorting/entries-sort-button';\r\nimport {linkPageState, useLinkPageStore} from '../link-page-store';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {GridViewIcon} from '@common/icons/material/GridView';\r\nimport {useShareableLinkPage} from '../../queries/use-shareable-link-page';\r\nimport {DriveFolder} from '../../../files/drive-entry';\r\n\r\nexport function FolderPreviewHeader() {\r\n  const activeSort = useLinkPageStore(s => s.activeSort);\r\n  const {link, isFetching} = useShareableLinkPage();\r\n  const hasEntry = link && link.entry;\r\n\r\n  return (\r\n    <div className=\"md:flex-row flex flex-col md:items-center gap-14 justify-between p-14 md:p-24 md:h-90\">\r\n      {hasEntry && (\r\n        <FolderPreviewBreadcrumb\r\n          link={link}\r\n          folder={link.entry as DriveFolder}\r\n          className=\"flex-auto\"\r\n        />\r\n      )}\r\n      {hasEntry && (\r\n        <div className=\"flex items-center justify-between md:justify-start text-muted\">\r\n          <EntriesSortButton\r\n            isDisabled={isFetching}\r\n            descriptor={activeSort}\r\n            onChange={value => {\r\n              linkPageState().setActiveSort(value);\r\n            }}\r\n          />\r\n          <div className=\"md:border-l md:pl-10 ml-10\">\r\n            <IconButton\r\n              onClick={() => {\r\n                linkPageState().setViewMode(\r\n                  linkPageState().viewMode === 'grid' ? 'list' : 'grid'\r\n                );\r\n              }}\r\n            >\r\n              <GridViewIcon />\r\n            </IconButton>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport {useShareableLinkPage} from '../../queries/use-shareable-link-page';\r\nimport {IllustratedMessage} from '@common/ui/images/illustrated-message';\r\nimport {SvgImage} from '@common/ui/images/svg-image/svg-image';\r\nimport {FolderPreviewFileView} from './folder-preview-file-view';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {DashboardLayout} from '@common/ui/layout/dashboard-layout';\r\nimport {FileUploadProvider} from '@common/uploads/uploader/file-upload-provider';\r\nimport {DashboardContent} from '@common/ui/layout/dashboard-content';\r\nimport {DashboardNavbar} from '@common/ui/layout/dashboard-navbar';\r\nimport {DashboardContentHeader} from '@common/ui/layout/dashboard-content-header';\r\nimport {ShareableLinkPageActionButtons} from '../shareable-link-page-action-buttons';\r\nimport {FolderPreviewHeader} from './folder-preview-header';\r\nimport shareSvg from './share.svg';\r\nimport clsx from 'clsx';\r\n\r\nexport function FolderPreview() {\r\n  const {entries, isFetched} = useShareableLinkPage();\r\n  const showEmptyMessage = isFetched && !entries?.length;\r\n\r\n  return (\r\n    <DashboardLayout name=\"folder-preview\">\r\n      <DashboardNavbar\r\n        hideToggleButton\r\n        rightChildren={<ShareableLinkPageActionButtons />}\r\n        color=\"bg\"\r\n      />\r\n      <DashboardContentHeader>\r\n        <FolderPreviewHeader />\r\n      </DashboardContentHeader>\r\n      <FileUploadProvider>\r\n        <DashboardContent>\r\n          {showEmptyMessage ? <EmptyMessage /> : <FolderPreviewFileView />}\r\n        </DashboardContent>\r\n      </FileUploadProvider>\r\n    </DashboardLayout>\r\n  );\r\n}\r\n\r\ninterface EmptyMessageProps {\r\n  className?: string;\r\n}\r\nfunction EmptyMessage({className}: EmptyMessageProps) {\r\n  return (\r\n    <IllustratedMessage\r\n      className={clsx(className, 'mt-80')}\r\n      image={<SvgImage src={shareSvg} />}\r\n      title={<Trans message=\"Folder is empty\" />}\r\n      description={\r\n        <Trans message=\"No files have been uploaded to this folder yet\" />\r\n      }\r\n    />\r\n  );\r\n}\r\n","import React from 'react';\r\nimport {FilePreviewContainer} from '@common/uploads/preview/file-preview-container';\r\nimport {useShareableLinkPage} from '../queries/use-shareable-link-page';\r\nimport {ShareableLinkNavbar} from './shareable-link-navbar';\r\nimport {AdHost} from '@common/admin/ads/ad-host';\r\n\r\nexport function ShareableLinkPageFilePreview() {\r\n  const {link} = useShareableLinkPage();\r\n\r\n  if (!link?.entry) return null;\r\n\r\n  return (\r\n    <div className=\"flex h-screen flex-col bg-alt\">\r\n      <ShareableLinkNavbar />\r\n      <AdHost slot=\"file-preview\" className=\"mx-auto mt-24\" />\r\n      <FilePreviewContainer\r\n        entries={[link.entry]}\r\n        showHeader={false}\r\n        allowDownload={link.allow_download}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","import React, {ReactElement} from 'react';\r\nimport {useShareableLinkPage} from '../queries/use-shareable-link-page';\r\nimport {useLinkPageStore} from './link-page-store';\r\nimport {useTrans} from '@common/i18n/use-trans';\r\nimport {ProgressCircle} from '@common/ui/progress/progress-circle';\r\nimport {PasswordPage} from './password-page';\r\nimport {FolderPreview} from './folder-preview/folder-preview';\r\nimport {ShareableLinkPageFilePreview} from './shareable-link-page-file-preview';\r\nimport {FileEntryUrlsContext} from '@common/uploads/hooks/file-entry-urls';\r\nimport {NotFoundPage} from '@common/ui/not-found-page/not-found-page';\r\n\r\nexport function ShareableLinkPage() {\r\n  const {status, link} = useShareableLinkPage();\r\n  const {trans} = useTrans();\r\n  const isPasswordProtected = useLinkPageStore(s => s.isPasswordProtected);\r\n  const password = useLinkPageStore(s => s.password);\r\n\r\n  let content: ReactElement;\r\n\r\n  if (status === 'pending') {\r\n    content = (\r\n      <div className=\"flex h-screen flex-auto items-center justify-center\">\r\n        <ProgressCircle\r\n          aria-label={trans({message: 'Loading link'})}\r\n          isIndeterminate\r\n        />\r\n      </div>\r\n    );\r\n  } else if (!link && !isPasswordProtected) {\r\n    return <NotFoundPage />;\r\n  } else if (isPasswordProtected && !password) {\r\n    content = <PasswordPage />;\r\n  } else if (link?.entry?.type === 'folder') {\r\n    content = <FolderPreview />;\r\n  } else {\r\n    content = <ShareableLinkPageFilePreview />;\r\n  }\r\n\r\n  return (\r\n    <FileEntryUrlsContext.Provider value={{shareable_link: link?.id, password}}>\r\n      {content}\r\n    </FileEntryUrlsContext.Provider>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport {ProgressBarBase, ProgressBarBaseProps} from './progress-bar-base';\r\n\r\nexport function Meter(props: ProgressBarBaseProps) {\r\n  return <ProgressBarBase {...props} role=\"meter progressbar\" />;\r\n}\r\n","import React from 'react';\r\nimport {useStorageSummary} from './storage-summary';\r\nimport {StorageIcon} from '@common/icons/material/Storage';\r\nimport {Meter} from '@common/ui/progress/meter';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport clsx from 'clsx';\r\n\r\nexport function StorageMeter() {\r\n  const {isLoading, data} = useStorageSummary();\r\n\r\n  // prevent translation placeholders from showing if summary is not loaded yet\r\n  const label = (\r\n    <span className={clsx('whitespace-nowrap', isLoading && 'invisible')}>\r\n      <Trans\r\n        message=\":used of :available used\"\r\n        values={{\r\n          used: data?.usedFormatted,\r\n          available: data?.availableFormatted,\r\n        }}\r\n      />\r\n    </span>\r\n  );\r\n  return (\r\n    <div className=\"pl-24 pt-24 mt-24 border-t flex items-start gap-16\">\r\n      <StorageIcon className=\"icon-md -mt-4\" />\r\n      <Meter\r\n        className=\"flex-auto max-w-144\"\r\n        size=\"xs\"\r\n        value={data?.percentage}\r\n        label={label}\r\n        showValueLabel={false}\r\n        labelPosition=\"bottom\"\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {UseFormReturn} from 'react-hook-form';\r\nimport {BackendResponse} from '../../http/backend-response/backend-response';\r\nimport {toast} from '../../ui/toast/toast';\r\nimport {apiClient, queryClient} from '../../http/query-client';\r\nimport {WorkspaceQueryKeys} from './workspace-query-keys';\r\nimport {Workspace} from '../types/workspace';\r\nimport {onFormQueryError} from '../../errors/on-form-query-error';\r\nimport {message} from '../../i18n/message';\r\n\r\ninterface Response extends BackendResponse {\r\n  workspace: Workspace;\r\n}\r\n\r\ninterface Props {\r\n  name: string;\r\n}\r\n\r\nexport function useCreateWorkspace(form: UseFormReturn<Props>) {\r\n  return useMutation({\r\n    mutationFn: (props: Props) => createWorkspace(props),\r\n    onSuccess: () => {\r\n      toast(message('Created workspace'));\r\n      queryClient.invalidateQueries({\r\n        queryKey: WorkspaceQueryKeys.fetchUserWorkspaces,\r\n      });\r\n    },\r\n    onError: r => onFormQueryError(r, form),\r\n  });\r\n}\r\n\r\nfunction createWorkspace(props: Props): Promise<Response> {\r\n  return apiClient.post('workspace', props).then(r => r.data);\r\n}\r\n","import {useForm} from 'react-hook-form';\r\nimport {FormTextField} from '../ui/forms/input-field/text-field/text-field';\r\nimport {Form} from '../ui/forms/form';\r\nimport {Button} from '../ui/buttons/button';\r\nimport {useCreateWorkspace} from './requests/create-workspace';\r\nimport {DialogFooter} from '../ui/overlays/dialog/dialog-footer';\r\nimport {useDialogContext} from '../ui/overlays/dialog/dialog-context';\r\nimport {Dialog} from '../ui/overlays/dialog/dialog';\r\nimport {DialogHeader} from '../ui/overlays/dialog/dialog-header';\r\nimport {DialogBody} from '../ui/overlays/dialog/dialog-body';\r\nimport {Trans} from '../i18n/trans';\r\n\r\nexport function NewWorkspaceDialog() {\r\n  const form = useForm<{name: string}>();\r\n  const {formId, close} = useDialogContext();\r\n  const createWorkspace = useCreateWorkspace(form);\r\n\r\n  return (\r\n    <Dialog>\r\n      <DialogHeader>\r\n        <Trans message=\"Create workspace\" />\r\n      </DialogHeader>\r\n      <DialogBody>\r\n        <Form\r\n          form={form}\r\n          id={formId}\r\n          onSubmit={() => {\r\n            createWorkspace.mutate(form.getValues(), {\r\n              onSuccess: response => {\r\n                close(response.workspace.id);\r\n              },\r\n            });\r\n          }}\r\n        >\r\n          <FormTextField\r\n            name=\"name\"\r\n            autoFocus\r\n            label={<Trans message=\"Workspace name\" />}\r\n            minLength={3}\r\n            required\r\n          />\r\n        </Form>\r\n      </DialogBody>\r\n      <DialogFooter>\r\n        <Button variant=\"text\" onClick={close}>\r\n          <Trans message=\"Cancel\" />\r\n        </Button>\r\n        <Button\r\n          variant=\"flat\"\r\n          color=\"primary\"\r\n          type=\"submit\"\r\n          form={formId}\r\n          disabled={createWorkspace.isPending}\r\n        >\r\n          <Trans message=\"Create\" />\r\n        </Button>\r\n      </DialogFooter>\r\n    </Dialog>\r\n  );\r\n}\r\n","import {useQuery} from '@tanstack/react-query';\r\nimport {WorkspaceQueryKeys} from './workspace-query-keys';\r\nimport {Workspace} from '../types/workspace';\r\nimport {BackendResponse} from '../../http/backend-response/backend-response';\r\nimport {apiClient} from '../../http/query-client';\r\n\r\nexport interface FetchWorkspaceWithMembersResponse extends BackendResponse {\r\n  workspace: Workspace;\r\n}\r\n\r\nfunction fetchWorkspaceWithMembers(\r\n  workspaceId: number,\r\n): Promise<FetchWorkspaceWithMembersResponse> {\r\n  return apiClient\r\n    .get(`workspace/${workspaceId}`)\r\n    .then(response => response.data);\r\n}\r\n\r\nexport function useWorkspaceWithMembers(workspaceId: number) {\r\n  return useQuery({\r\n    queryKey: WorkspaceQueryKeys.workspaceWithMembers(workspaceId),\r\n    queryFn: () => fetchWorkspaceWithMembers(workspaceId),\r\n  });\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {apiClient, queryClient} from '../../http/query-client';\r\nimport {BackendResponse} from '../../http/backend-response/backend-response';\r\nimport {WorkspaceInvite} from '../types/workspace-invite';\r\nimport {WorkspaceQueryKeys} from './workspace-query-keys';\r\nimport {showHttpErrorToast} from '../../utils/http/show-http-error-toast';\r\n\r\ninterface Response extends BackendResponse {\r\n  invites: WorkspaceInvite[];\r\n}\r\n\r\ninterface Props {\r\n  workspaceId: number;\r\n  emails: string[];\r\n  roleId: number;\r\n}\r\n\r\nfunction InviteMembers({workspaceId, ...other}: Props): Promise<Response> {\r\n  return apiClient\r\n    .post(`workspace/${workspaceId}/invite`, other)\r\n    .then(r => r.data);\r\n}\r\n\r\nexport function useInviteMembers() {\r\n  return useMutation({\r\n    mutationFn: (props: Props) => InviteMembers(props),\r\n    onSuccess: (response, props) => {\r\n      queryClient.invalidateQueries({\r\n        queryKey: WorkspaceQueryKeys.workspaceWithMembers(props.workspaceId),\r\n      });\r\n    },\r\n    onError: err => showHttpErrorToast(err),\r\n  });\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {BackendResponse} from '../../http/backend-response/backend-response';\r\nimport {WorkspaceInvite} from '../types/workspace-invite';\r\nimport {toast} from '../../ui/toast/toast';\r\nimport {apiClient} from '../../http/query-client';\r\nimport {showHttpErrorToast} from '../../utils/http/show-http-error-toast';\r\n\r\ninterface Response extends BackendResponse {\r\n  invite: WorkspaceInvite;\r\n}\r\n\r\ninterface Props {\r\n  workspaceId: number;\r\n  inviteId: string;\r\n}\r\n\r\nfunction ResendInvite({\r\n  workspaceId,\r\n  inviteId,\r\n  ...other\r\n}: Props): Promise<Response> {\r\n  return apiClient\r\n    .post(`workspace/${workspaceId}/${inviteId}/resend`, other)\r\n    .then(r => r.data);\r\n}\r\n\r\nexport function useResendInvite() {\r\n  return useMutation({\r\n    mutationFn: (props: Props) => ResendInvite(props),\r\n    onSuccess: () => {\r\n      toast('Invite sent');\r\n    },\r\n    onError: err => showHttpErrorToast(err),\r\n  });\r\n}\r\n","const matcher =\r\n  /^[a-zA-Z0-9.!#$%&'*+\\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;\r\n\r\nexport function isEmail(string?: string): boolean {\r\n  if (!string) return false;\r\n  if (string.length > 320) return false;\r\n  return matcher.test(string);\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {BackendResponse} from '../../http/backend-response/backend-response';\r\nimport {toast} from '../../ui/toast/toast';\r\nimport {apiClient, queryClient} from '../../http/query-client';\r\nimport {WorkspaceQueryKeys} from './workspace-query-keys';\r\nimport {WorkspaceMember} from '../types/workspace-member';\r\nimport {WorkspaceInvite} from '../types/workspace-invite';\r\nimport {message} from '../../i18n/message';\r\nimport {showHttpErrorToast} from '../../utils/http/show-http-error-toast';\r\n\r\ninterface Response extends BackendResponse {}\r\n\r\ninterface Props {\r\n  workspaceId: number;\r\n  member: WorkspaceMember | WorkspaceInvite;\r\n  roleId: number;\r\n}\r\n\r\nfunction ChangeRole({workspaceId, member, ...other}: Props): Promise<Response> {\r\n  const modelType = member.model_type;\r\n  const memberId =\r\n    member.model_type === 'invite' ? member.id : member.member_id;\r\n  return apiClient\r\n    .post(\r\n      `workspace/${workspaceId}/${modelType}/${memberId}/change-role`,\r\n      other,\r\n    )\r\n    .then(r => r.data);\r\n}\r\n\r\nexport function useChangeRole() {\r\n  return useMutation({\r\n    mutationFn: (props: Props) => ChangeRole(props),\r\n    onSuccess: (response, props) => {\r\n      toast(message('Role changed'));\r\n      queryClient.invalidateQueries({\r\n        queryKey: WorkspaceQueryKeys.workspaceWithMembers(props.workspaceId),\r\n      });\r\n    },\r\n    onError: err => showHttpErrorToast(err),\r\n  });\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {BackendResponse} from '../../http/backend-response/backend-response';\r\nimport {apiClient, queryClient} from '../../http/query-client';\r\nimport {WorkspaceQueryKeys} from './workspace-query-keys';\r\nimport {useAuth} from '../../auth/use-auth';\r\nimport {useActiveWorkspaceId} from '../active-workspace-id-context';\r\nimport {PersonalWorkspace} from '../user-workspaces';\r\nimport {showHttpErrorToast} from '../../utils/http/show-http-error-toast';\r\n\r\ninterface Response extends BackendResponse {}\r\n\r\ninterface Props {\r\n  workspaceId: number;\r\n  memberId: number | string;\r\n  memberType: 'invite' | 'member';\r\n}\r\n\r\nfunction removeMember({\r\n  workspaceId,\r\n  memberId,\r\n  memberType,\r\n}: Props): Promise<Response> {\r\n  const endpoint =\r\n    memberType === 'invite'\r\n      ? `workspace/invite/${memberId}`\r\n      : `workspace/${workspaceId}/member/${memberId}`;\r\n  return apiClient.delete(endpoint).then(r => r.data);\r\n}\r\n\r\nexport function useRemoveMember() {\r\n  const {workspaceId, setWorkspaceId} = useActiveWorkspaceId();\r\n  const {user} = useAuth();\r\n  return useMutation({\r\n    mutationFn: (props: Props) => removeMember(props),\r\n    onSuccess: (response, props) => {\r\n      queryClient.invalidateQueries({\r\n        queryKey: WorkspaceQueryKeys.fetchUserWorkspaces,\r\n      });\r\n      queryClient.invalidateQueries({\r\n        queryKey: WorkspaceQueryKeys.workspaceWithMembers(props.workspaceId),\r\n      });\r\n\r\n      // if user left workspace that is currently active, switch to personal workspace\r\n      if (props.memberId === user?.id && workspaceId === props.workspaceId) {\r\n        setWorkspaceId(PersonalWorkspace.id);\r\n      }\r\n    },\r\n    onError: err => showHttpErrorToast(err),\r\n  });\r\n}\r\n","import {ConfirmationDialog} from '../ui/overlays/dialog/confirmation-dialog';\r\nimport {Trans} from '../i18n/trans';\r\n\r\ninterface Props {\r\n  onConfirm?: () => void;\r\n  isLoading?: boolean;\r\n}\r\nexport function LeaveWorkspaceConfirmation({onConfirm, isLoading}: Props) {\r\n  return (\r\n    <ConfirmationDialog\r\n      isDanger\r\n      title={<Trans message=\"Leave workspace\" />}\r\n      isLoading={isLoading}\r\n      onConfirm={onConfirm}\r\n      body={\r\n        <div>\r\n          <Trans message=\"Are you sure you want to leave this workspace?\" />\r\n          <div className=\"mt-8 font-semibold\">\r\n            <Trans message=\"All resources you've created in the workspace will be transferred to workspace owner.\" />\r\n          </div>\r\n        </div>\r\n      }\r\n      confirm={<Trans message=\"Leave\" />}\r\n    />\r\n  );\r\n}\r\n","import {useEffect, useState} from 'react';\r\nimport {AnimatePresence, m} from 'framer-motion';\r\nimport {useWorkspaceWithMembers} from './requests/workspace-with-members';\r\nimport {ProgressCircle} from '../ui/progress/progress-circle';\r\nimport {Workspace} from './types/workspace';\r\nimport {GroupIcon} from '../icons/material/Group';\r\nimport {WorkspaceMember} from './types/workspace-member';\r\nimport {useAuth} from '../auth/use-auth';\r\nimport {\r\n  ChipField,\r\n  ChipValue,\r\n} from '../ui/forms/input-field/chip-field/chip-field';\r\nimport {useValueLists} from '../http/value-lists';\r\nimport {Button} from '../ui/buttons/button';\r\nimport {ArrowDropDownIcon} from '../icons/material/ArrowDropDown';\r\nimport {useInviteMembers} from './requests/invite-members';\r\nimport {WorkspaceInvite} from './types/workspace-invite';\r\nimport {ConfirmationDialog} from '../ui/overlays/dialog/confirmation-dialog';\r\nimport {useResendInvite} from './requests/resend-invite';\r\nimport {isEmail} from '../utils/string/is-email';\r\nimport {ButtonSize} from '../ui/buttons/button-size';\r\nimport {useChangeRole} from './requests/change-role';\r\nimport {IconButton} from '../ui/buttons/icon-button';\r\nimport {useRemoveMember} from './requests/remove-member';\r\nimport {CloseIcon} from '../icons/material/Close';\r\nimport {ExitToAppIcon} from '../icons/material/ExitToApp';\r\nimport {toast} from '../ui/toast/toast';\r\nimport {DialogTrigger} from '../ui/overlays/dialog/dialog-trigger';\r\nimport {Menu, MenuItem, MenuTrigger} from '../ui/navigation/menu/menu-trigger';\r\nimport {useDialogContext} from '../ui/overlays/dialog/dialog-context';\r\nimport {Dialog} from '../ui/overlays/dialog/dialog';\r\nimport {DialogHeader} from '../ui/overlays/dialog/dialog-header';\r\nimport {DialogBody} from '../ui/overlays/dialog/dialog-body';\r\nimport {Trans} from '../i18n/trans';\r\nimport {useTrans} from '../i18n/use-trans';\r\nimport {message} from '../i18n/message';\r\nimport {LeaveWorkspaceConfirmation} from './leave-workspace-confirmation';\r\n\r\ninterface WorkspaceMembersDialogProps {\r\n  workspace: Workspace;\r\n}\r\nexport function WorkspaceMembersDialog({\r\n  workspace,\r\n}: WorkspaceMembersDialogProps) {\r\n  const {data, isLoading} = useWorkspaceWithMembers(workspace.id);\r\n  return (\r\n    <Dialog size=\"lg\">\r\n      <DialogHeader>\r\n        <Trans message=\"Manage workspace members\" />\r\n      </DialogHeader>\r\n      <DialogBody>\r\n        {isLoading ? (\r\n          <div className=\"flex min-h-[238px] items-center justify-center\">\r\n            <ProgressCircle isIndeterminate aria-label=\"Loading workspace...\" />\r\n          </div>\r\n        ) : (\r\n          <Manager workspace={data!.workspace} />\r\n        )}\r\n      </DialogBody>\r\n    </Dialog>\r\n  );\r\n}\r\n\r\ninterface ManagerProps {\r\n  workspace: Workspace;\r\n}\r\nfunction Manager({workspace}: ManagerProps) {\r\n  const {user} = useAuth();\r\n  const can = usePermissions(workspace);\r\n  const members: (WorkspaceMember | WorkspaceInvite)[] = [\r\n    ...(workspace.members || []),\r\n    ...(workspace.invites || []),\r\n  ];\r\n  const shouldHideOtherMembers = !can.update && !can.delete;\r\n\r\n  return (\r\n    <div>\r\n      {can.invite && <InviteChipField workspace={workspace} />}\r\n      <div className=\"mb-14 flex items-center gap-10 text-base\">\r\n        <GroupIcon className=\"icon-sm\" />\r\n        <Trans\r\n          message=\"Members of `:workspace`\"\r\n          values={{workspace: workspace.name}}\r\n        />\r\n      </div>\r\n      <AnimatePresence initial={false}>\r\n        {members.map(member => {\r\n          if (shouldHideOtherMembers && member.id !== user?.id) {\r\n            return null;\r\n          }\r\n          return (\r\n            <MemberListItem\r\n              key={`${member.model_type}.${member.id}`}\r\n              workspace={workspace}\r\n              member={member}\r\n            />\r\n          );\r\n        })}\r\n        {shouldHideOtherMembers && (\r\n          <div className=\"text-muted\">\r\n            <Trans\r\n              message=\"And [one one other member|:count other members]\"\r\n              values={{count: members.length}}\r\n            />\r\n          </div>\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface MemberListItemProps {\r\n  member: WorkspaceMember | WorkspaceInvite;\r\n  workspace: Workspace;\r\n}\r\nfunction MemberListItem({workspace, member}: MemberListItemProps) {\r\n  return (\r\n    <m.div\r\n      initial={{x: '-100%', opacity: 0}}\r\n      animate={{x: 0, opacity: 1}}\r\n      exit={{x: '100%', opacity: 0}}\r\n      transition={{type: 'tween', duration: 0.125}}\r\n      className=\"mb-20 flex items-start gap-14 text-sm\"\r\n      key={`${member.model_type}.${member.id}`}\r\n    >\r\n      <img\r\n        className=\"h-36 w-36 flex-shrink-0 rounded\"\r\n        src={member.avatar}\r\n        alt=\"\"\r\n      />\r\n      <div className=\"min-w-0 flex-auto items-center justify-between gap-14 md:flex\">\r\n        <div className=\"mb-10 overflow-hidden md:mb-0 md:mr-10\">\r\n          <div className=\"flex items-center justify-start gap-6\">\r\n            <div className=\"overflow-hidden text-ellipsis whitespace-nowrap\">\r\n              {member.display_name}\r\n            </div>\r\n            <MemberDisplayNameAppend workspace={workspace} member={member} />\r\n          </div>\r\n          <div className=\"text-muted\">{member.email}</div>\r\n        </div>\r\n        <MemberActions workspace={workspace} member={member} />\r\n      </div>\r\n    </m.div>\r\n  );\r\n}\r\n\r\nfunction usePermissions(workspace: Workspace) {\r\n  const {user: authUser} = useAuth();\r\n  const response = {update: false, invite: false, delete: false};\r\n  const permissions = ['update', 'invite', 'delete'] as const;\r\n  const authMember = workspace.members?.find(mb => mb.id === authUser?.id);\r\n\r\n  if (authMember) {\r\n    permissions.forEach(permission => {\r\n      response[permission] =\r\n        authMember.is_owner ||\r\n        !!authMember.permissions?.find(\r\n          p => p.name === `workspace_members.${permission}`,\r\n        );\r\n    });\r\n  }\r\n\r\n  return response;\r\n}\r\n\r\ninterface MemberActionsProps {\r\n  workspace: Workspace;\r\n  member: WorkspaceMember | WorkspaceInvite;\r\n}\r\nfunction MemberActions({workspace, member}: MemberActionsProps) {\r\n  const [selectedRole, setSelectedRole] = useState<number>(member.role_id);\r\n  const changeRole = useChangeRole();\r\n  const {user} = useAuth();\r\n\r\n  const can = usePermissions(workspace);\r\n  const isOwner = member.model_type === 'member' && member.is_owner;\r\n  const isCurrentUser =\r\n    member.model_type === 'member' && user?.id === member.id;\r\n\r\n  const roleSelector =\r\n    !can.update || isOwner || isCurrentUser ? (\r\n      <div className=\"ml-auto text-muted first:capitalize\">\r\n        <Trans message={member.role_name} />\r\n      </div>\r\n    ) : (\r\n      <RoleMenuTrigger\r\n        className=\"ml-auto flex-shrink-0\"\r\n        size=\"xs\"\r\n        value={selectedRole}\r\n        isDisabled={changeRole.isPending}\r\n        onChange={roleId => {\r\n          setSelectedRole(roleId);\r\n          changeRole.mutate({\r\n            roleId,\r\n            workspaceId: workspace.id,\r\n            member,\r\n          });\r\n        }}\r\n      />\r\n    );\r\n\r\n  return (\r\n    <>\r\n      {roleSelector}\r\n      {!isOwner && (isCurrentUser || can.delete) && (\r\n        <RemoveMemberButton\r\n          type={isCurrentUser ? 'leave' : 'remove'}\r\n          member={member}\r\n          workspace={workspace}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\ninterface InviteChipFieldProps {\r\n  workspace: Workspace;\r\n}\r\nfunction InviteChipField({workspace}: InviteChipFieldProps) {\r\n  const {trans} = useTrans();\r\n  const [chips, setChips] = useState<ChipValue[]>([]);\r\n  const allEmailsValid = chips.every(chip => !chip.invalid);\r\n  const displayWith = (chip: ChipValue) => chip.description || chip.name;\r\n  const [selectedRole, setSelectedRole] = useState<number>();\r\n  const inviteMembers = useInviteMembers();\r\n  const {data} = useValueLists(['workspaceRoles']);\r\n\r\n  useEffect(() => {\r\n    if (!selectedRole && data?.workspaceRoles?.length) {\r\n      setSelectedRole(data.workspaceRoles[0].id);\r\n    }\r\n  }, [data, selectedRole]);\r\n\r\n  return (\r\n    <div className=\"mb-30\">\r\n      <ChipField\r\n        value={chips}\r\n        onChange={setChips}\r\n        displayWith={displayWith}\r\n        validateWith={chip => {\r\n          const invalid = !isEmail(chip.description);\r\n          return {\r\n            ...chip,\r\n            invalid,\r\n            errorMessage: invalid\r\n              ? trans({message: 'Not a valid email'})\r\n              : undefined,\r\n          };\r\n        }}\r\n        placeholder={trans({message: 'Enter email addresses'})}\r\n        label={<Trans message=\"Invite people\" />}\r\n      />\r\n      <div className=\"mt-14 flex items-center justify-between gap-14\">\r\n        <RoleMenuTrigger onChange={setSelectedRole} value={selectedRole} />\r\n        {chips.length && selectedRole ? (\r\n          <Button\r\n            variant=\"flat\"\r\n            color=\"primary\"\r\n            size=\"sm\"\r\n            disabled={inviteMembers.isPending || !allEmailsValid}\r\n            onClick={() => {\r\n              inviteMembers.mutate(\r\n                {\r\n                  emails: chips.map(c => displayWith(c)),\r\n                  roleId: selectedRole,\r\n                  workspaceId: workspace.id,\r\n                },\r\n                {\r\n                  onSuccess: () => {\r\n                    setChips([]);\r\n                  },\r\n                },\r\n              );\r\n            }}\r\n          >\r\n            <Trans message=\"Invite\" />\r\n          </Button>\r\n        ) : null}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface RemoveMemberButtonProps {\r\n  member: WorkspaceMember | WorkspaceInvite;\r\n  workspace: Workspace;\r\n  type: 'leave' | 'remove';\r\n}\r\nfunction RemoveMemberButton({\r\n  member,\r\n  workspace,\r\n  type,\r\n}: RemoveMemberButtonProps) {\r\n  const removeMember = useRemoveMember();\r\n  const {close} = useDialogContext();\r\n  return (\r\n    <DialogTrigger\r\n      type=\"modal\"\r\n      onClose={isConfirmed => {\r\n        if (isConfirmed) {\r\n          removeMember.mutate({\r\n            workspaceId: workspace.id,\r\n            memberId: member.id,\r\n            memberType: member.model_type,\r\n          });\r\n          if (type === 'leave') {\r\n            close();\r\n            toast(message('Left workspace'));\r\n          }\r\n        }\r\n      }}\r\n    >\r\n      <IconButton\r\n        size=\"md\"\r\n        className=\"flex-shrink-0 text-muted\"\r\n        disabled={removeMember.isPending}\r\n      >\r\n        {type === 'leave' ? <ExitToAppIcon /> : <CloseIcon />}\r\n      </IconButton>\r\n      {type === 'leave' ? (\r\n        <LeaveWorkspaceConfirmation />\r\n      ) : (\r\n        <RemoveMemberConfirmation member={member} />\r\n      )}\r\n    </DialogTrigger>\r\n  );\r\n}\r\n\r\ninterface RemoveMemberConfirmationProps {\r\n  member: WorkspaceMember | WorkspaceInvite;\r\n}\r\nfunction RemoveMemberConfirmation({member}: RemoveMemberConfirmationProps) {\r\n  return (\r\n    <ConfirmationDialog\r\n      isDanger\r\n      title={<Trans message=\"Remove member\" />}\r\n      body={\r\n        <div>\r\n          <Trans\r\n            message=\"Are you sure you want to remove `:name`?\"\r\n            values={{name: member.display_name}}\r\n          />\r\n          <div className=\"mt-8 font-semibold\">\r\n            <Trans\r\n              message=\"All workspace resources created by `:name` will be transferred to workspace owner.\"\r\n              values={{\r\n                name: member.display_name,\r\n              }}\r\n            />\r\n          </div>\r\n        </div>\r\n      }\r\n      confirm={<Trans message=\"Remove\" />}\r\n    />\r\n  );\r\n}\r\n\r\ninterface RoleMenuTriggerProps {\r\n  onChange: (value: number) => void;\r\n  value?: number;\r\n  size?: ButtonSize;\r\n  className?: string;\r\n  isDisabled?: boolean;\r\n}\r\nfunction RoleMenuTrigger({\r\n  value,\r\n  onChange,\r\n  size = 'xs',\r\n  className,\r\n  isDisabled,\r\n}: RoleMenuTriggerProps) {\r\n  const {data} = useValueLists(['workspaceRoles']);\r\n  const role = data?.workspaceRoles?.find(r => r.id === value);\r\n  if (!value || !role || !data?.workspaceRoles) return null;\r\n\r\n  return (\r\n    <MenuTrigger\r\n      selectionMode=\"single\"\r\n      selectedValue={value}\r\n      onSelectionChange={newValue => {\r\n        onChange(newValue as number);\r\n      }}\r\n    >\r\n      <Button\r\n        className={className}\r\n        size={size}\r\n        variant=\"flat\"\r\n        color=\"chip\"\r\n        disabled={isDisabled}\r\n        endIcon={<ArrowDropDownIcon />}\r\n      >\r\n        <Trans message={role.name} />\r\n      </Button>\r\n      <Menu>\r\n        {data.workspaceRoles.map(r => (\r\n          <MenuItem value={r.id} key={r.id} description={r.description}>\r\n            <Trans message={r.name} />\r\n          </MenuItem>\r\n        ))}\r\n      </Menu>\r\n    </MenuTrigger>\r\n  );\r\n}\r\n\r\ninterface MemberDisplayNameAppendProps {\r\n  member: WorkspaceMember | WorkspaceInvite;\r\n  workspace: Workspace;\r\n}\r\nfunction MemberDisplayNameAppend({\r\n  member,\r\n  workspace,\r\n}: MemberDisplayNameAppendProps) {\r\n  const {user} = useAuth();\r\n  const can = usePermissions(workspace);\r\n\r\n  if (user?.id === member.id) {\r\n    return (\r\n      <div className=\"font-medium\">\r\n        (<Trans message=\"You\" />)\r\n      </div>\r\n    );\r\n  }\r\n  if (member.model_type === 'invite') {\r\n    return (\r\n      <div className=\"flex items-center gap-4\">\r\n        <div></div>\r\n        <div className=\"font-medium\">\r\n          <Trans message=\"Invited\" />\r\n        </div>\r\n        {can.invite ? (\r\n          <>\r\n            <div></div>\r\n            <ResendInviteDialogTrigger member={member} workspace={workspace} />\r\n          </>\r\n        ) : null}\r\n      </div>\r\n    );\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction ResendInviteDialogTrigger({\r\n  member,\r\n  workspace,\r\n}: MemberDisplayNameAppendProps) {\r\n  const resendInvite = useResendInvite();\r\n  return (\r\n    <DialogTrigger\r\n      type=\"modal\"\r\n      onClose={isConfirmed => {\r\n        if (isConfirmed) {\r\n          resendInvite.mutate({\r\n            workspaceId: workspace.id,\r\n            inviteId: member.id as string,\r\n          });\r\n        }\r\n      }}\r\n    >\r\n      <Button\r\n        variant=\"link\"\r\n        size=\"sm\"\r\n        color=\"primary\"\r\n        disabled={resendInvite.isPending}\r\n      >\r\n        <Trans message=\"Resend invite\" />\r\n      </Button>\r\n      <ConfirmationDialog\r\n        title={<Trans message=\"Resend invite\" />}\r\n        body={\r\n          <Trans message=\"Are you sure you want to send this invite again?\" />\r\n        }\r\n        confirm={<Trans message=\"Send\" />}\r\n      />\r\n    </DialogTrigger>\r\n  );\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {UseFormReturn} from 'react-hook-form';\r\nimport {BackendResponse} from '../../http/backend-response/backend-response';\r\nimport {toast} from '../../ui/toast/toast';\r\nimport {apiClient, queryClient} from '../../http/query-client';\r\nimport {WorkspaceQueryKeys} from './workspace-query-keys';\r\nimport {Workspace} from '../types/workspace';\r\nimport {onFormQueryError} from '../../errors/on-form-query-error';\r\nimport {useDialogContext} from '../../ui/overlays/dialog/dialog-context';\r\nimport {message} from '../../i18n/message';\r\n\r\ninterface Response extends BackendResponse {\r\n  workspace: Workspace;\r\n}\r\n\r\nexport interface UpdateWorkspacePayload {\r\n  id: number;\r\n  name: string;\r\n}\r\n\r\nfunction updateWorkspace({\r\n  id,\r\n  ...props\r\n}: UpdateWorkspacePayload): Promise<Response> {\r\n  return apiClient.put(`workspace/${id}`, props).then(r => r.data);\r\n}\r\n\r\nexport function useUpdateWorkspace(\r\n  form: UseFormReturn<UpdateWorkspacePayload>,\r\n) {\r\n  const {close} = useDialogContext();\r\n  return useMutation({\r\n    mutationFn: (props: UpdateWorkspacePayload) => updateWorkspace(props),\r\n    onSuccess: response => {\r\n      close();\r\n      toast(message('Updated workspace'));\r\n      queryClient.invalidateQueries({\r\n        queryKey: WorkspaceQueryKeys.fetchUserWorkspaces,\r\n      });\r\n      queryClient.invalidateQueries({\r\n        queryKey: WorkspaceQueryKeys.workspaceWithMembers(\r\n          response.workspace.id,\r\n        ),\r\n      });\r\n    },\r\n    onError: r => onFormQueryError(r, form),\r\n  });\r\n}\r\n","import {useForm} from 'react-hook-form';\r\nimport {FormTextField} from '../ui/forms/input-field/text-field/text-field';\r\nimport {Form} from '../ui/forms/form';\r\nimport {Button} from '../ui/buttons/button';\r\nimport {DialogFooter} from '../ui/overlays/dialog/dialog-footer';\r\nimport {useDialogContext} from '../ui/overlays/dialog/dialog-context';\r\nimport {Dialog} from '../ui/overlays/dialog/dialog';\r\nimport {DialogHeader} from '../ui/overlays/dialog/dialog-header';\r\nimport {DialogBody} from '../ui/overlays/dialog/dialog-body';\r\nimport {\r\n  UpdateWorkspacePayload,\r\n  useUpdateWorkspace,\r\n} from './requests/update-workspace';\r\nimport {Workspace} from './types/workspace';\r\nimport {Trans} from '../i18n/trans';\r\n\r\ninterface Props {\r\n  workspace: Workspace;\r\n}\r\nexport function RenameWorkspaceDialog({workspace}: Props) {\r\n  const form = useForm<UpdateWorkspacePayload>({\r\n    defaultValues: {id: workspace.id, name: workspace.name},\r\n  });\r\n  const {formId, close} = useDialogContext();\r\n  const updateWorkspace = useUpdateWorkspace(form);\r\n\r\n  return (\r\n    <Dialog>\r\n      <DialogHeader>\r\n        <Trans message=\"Rename workspace\" />\r\n      </DialogHeader>\r\n      <DialogBody>\r\n        <Form\r\n          form={form}\r\n          id={formId}\r\n          onSubmit={() => {\r\n            updateWorkspace.mutate(form.getValues());\r\n          }}\r\n        >\r\n          <FormTextField\r\n            name=\"name\"\r\n            autoFocus\r\n            label={<Trans message=\"Name\" />}\r\n            minLength={3}\r\n            required\r\n          />\r\n        </Form>\r\n      </DialogBody>\r\n      <DialogFooter>\r\n        <Button variant=\"text\" onClick={close}>\r\n          <Trans message=\"Cancel\" />\r\n        </Button>\r\n        <Button\r\n          variant=\"flat\"\r\n          color=\"primary\"\r\n          type=\"submit\"\r\n          form={formId}\r\n          disabled={updateWorkspace.isPending}\r\n        >\r\n          <Trans message=\"Rename\" />\r\n        </Button>\r\n      </DialogFooter>\r\n    </Dialog>\r\n  );\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {BackendResponse} from '../../http/backend-response/backend-response';\r\nimport {toast} from '../../ui/toast/toast';\r\nimport {apiClient, queryClient} from '../../http/query-client';\r\nimport {WorkspaceQueryKeys} from './workspace-query-keys';\r\nimport {useActiveWorkspaceId} from '../active-workspace-id-context';\r\nimport {PersonalWorkspace} from '../user-workspaces';\r\nimport {message} from '../../i18n/message';\r\nimport {showHttpErrorToast} from '../../utils/http/show-http-error-toast';\r\n\r\ninterface Response extends BackendResponse {}\r\n\r\nexport interface DeleteWorkspacePayload {\r\n  id: number;\r\n}\r\n\r\nfunction deleteWorkspace({id}: DeleteWorkspacePayload): Promise<Response> {\r\n  return apiClient.delete(`workspace/${id}`).then(r => r.data);\r\n}\r\n\r\nexport function useDeleteWorkspace() {\r\n  const {workspaceId, setWorkspaceId} = useActiveWorkspaceId();\r\n  return useMutation({\r\n    mutationFn: (props: DeleteWorkspacePayload) => deleteWorkspace(props),\r\n    onSuccess: (r, payload) => {\r\n      toast(message('Deleted workspace'));\r\n      queryClient.invalidateQueries({\r\n        queryKey: WorkspaceQueryKeys.fetchUserWorkspaces,\r\n      });\r\n      queryClient.invalidateQueries({\r\n        queryKey: WorkspaceQueryKeys.workspaceWithMembers(payload.id),\r\n      });\r\n\r\n      // if user deleted workspace that is currently active, switch to personal workspace\r\n      if (workspaceId === payload.id) {\r\n        setWorkspaceId(PersonalWorkspace.id);\r\n      }\r\n    },\r\n    onError: err => showHttpErrorToast(err),\r\n  });\r\n}\r\n","import {Trans} from '@common/i18n/trans';\r\nimport {Link} from 'react-router-dom';\r\nimport {LinkStyle} from '@common/ui/buttons/external-link';\r\nimport {ReactElement, ReactNode} from 'react';\r\nimport {SectionHelper, SectionHelperProps} from '@common/ui/section-helper';\r\nimport {useSettings} from '@common/core/settings/use-settings';\r\nimport {PolicyFailReason} from '@common/billing/upgrade/policy-fail-reason';\r\n\r\ninterface Props {\r\n  className?: string;\r\n  // plural name in lowercase (e.g. 'projects')\r\n  resourceName?: ReactElement | string;\r\n  reason?: PolicyFailReason;\r\n  size?: SectionHelperProps['size'];\r\n  color?: SectionHelperProps['color'];\r\n  message?: ReactNode;\r\n}\r\nexport function PolicyFailMessage({\r\n  resourceName,\r\n  className,\r\n  size = 'md',\r\n  color = 'bgAlt',\r\n  reason = 'overQuota',\r\n  ...other\r\n}: Props) {\r\n  const message = other.message ?? (\r\n    <MessageText resourceName={resourceName!} reason={reason} />\r\n  );\r\n\r\n  return (\r\n    <SectionHelper\r\n      color={color}\r\n      size={size}\r\n      className={className}\r\n      description={message}\r\n    />\r\n  );\r\n}\r\n\r\ninterface MessageTextProps {\r\n  resourceName: ReactElement | string;\r\n  reason?: PolicyFailReason;\r\n}\r\nfunction MessageText({resourceName, reason}: MessageTextProps) {\r\n  const {billing} = useSettings();\r\n\r\n  if (reason === 'noWorkspacePermission') {\r\n    return (\r\n      <Trans\r\n        message=\"You can't create new :name in this workspace.\"\r\n        values={{name: resourceName}}\r\n      />\r\n    );\r\n  }\r\n\r\n  const upgradeMsgValues = {\r\n    name: resourceName,\r\n    a: (text: ReactNode) => (\r\n      <Link className={LinkStyle} to=\"/pricing\">\r\n        {text}\r\n      </Link>\r\n    ),\r\n  };\r\n\r\n  if (reason === 'overQuota' && billing.enable) {\r\n    return (\r\n      <Trans\r\n        message=\"Your plan is at its maximum number of :name allowed. <a>Upgrade to add more.</a>\"\r\n        values={upgradeMsgValues}\r\n      />\r\n    );\r\n  }\r\n\r\n  if (reason === 'noPermission' && billing.enable) {\r\n    return (\r\n      <Trans\r\n        message=\"To unlock ability to create :name. <a>Upgrade your plan.</a>\"\r\n        values={upgradeMsgValues}\r\n      />\r\n    );\r\n  }\r\n\r\n  return <Trans message=\"You don't have permissions to create :name.\" />;\r\n}\r\n","import clsx from 'clsx';\r\nimport {\r\n  cloneElement,\r\n  forwardRef,\r\n  Fragment,\r\n  ReactElement,\r\n  useEffect,\r\n  useState,\r\n} from 'react';\r\nimport {ButtonBase} from '../ui/buttons/button-base';\r\nimport {PersonalWorkspace, useUserWorkspaces} from './user-workspaces';\r\nimport {UnfoldMoreIcon} from '../icons/material/UnfoldMore';\r\nimport {AddIcon} from '../icons/material/Add';\r\nimport {NewWorkspaceDialog} from './new-workspace-dialog';\r\nimport {WorkspaceMembersDialog} from './workspace-members-dialog';\r\nimport {\r\n  useActiveWorkspace,\r\n  useActiveWorkspaceId,\r\n} from './active-workspace-id-context';\r\nimport {DialogTrigger} from '../ui/overlays/dialog/dialog-trigger';\r\nimport {Workspace} from './types/workspace';\r\nimport {Dialog} from '../ui/overlays/dialog/dialog';\r\nimport {DialogBody} from '../ui/overlays/dialog/dialog-body';\r\nimport {Button, ButtonProps} from '../ui/buttons/button';\r\nimport {CheckIcon} from '../icons/material/Check';\r\nimport {Menu, MenuItem, MenuTrigger} from '../ui/navigation/menu/menu-trigger';\r\nimport {KeyboardArrowDownIcon} from '../icons/material/KeyboardArrowDown';\r\nimport {PersonAddIcon} from '../icons/material/PersonAdd';\r\nimport {DeleteIcon} from '../icons/material/Delete';\r\nimport {ExitToAppIcon} from '../icons/material/ExitToApp';\r\nimport {EditIcon} from '../icons/material/Edit';\r\nimport {RenameWorkspaceDialog} from './rename-workspace-dialog';\r\nimport {ConfirmationDialog} from '../ui/overlays/dialog/confirmation-dialog';\r\nimport {useDeleteWorkspace} from './requests/delete-workspace';\r\nimport {useRemoveMember} from './requests/remove-member';\r\nimport {useAuth} from '../auth/use-auth';\r\nimport {Trans} from '../i18n/trans';\r\nimport {LeaveWorkspaceConfirmation} from './leave-workspace-confirmation';\r\nimport {openDialog} from '@common/ui/overlays/store/dialog-store';\r\nimport {useDialogContext} from '@common/ui/overlays/dialog/dialog-context';\r\nimport {PolicyFailMessage} from '@common/billing/upgrade/policy-fail-message';\r\n\r\ninterface WorkspaceSelectorProps {\r\n  className?: string;\r\n  onChange?: (id: number) => void;\r\n  trigger?: ReactElement<ButtonProps>;\r\n  placement?: 'top' | 'bottom';\r\n}\r\nexport function WorkspaceSelector({\r\n  onChange,\r\n  className,\r\n  trigger,\r\n  placement = 'top',\r\n}: WorkspaceSelectorProps) {\r\n  const {data: workspaces, isFetched, isFetching} = useUserWorkspaces();\r\n  const {setWorkspaceId} = useActiveWorkspaceId();\r\n  const activeWorkspace = useActiveWorkspace();\r\n  const [selectorIsOpen, setSelectorIsOpen] = useState(false);\r\n  const {hasPermission} = useAuth();\r\n\r\n  // if user no longer has access to previously selected workspace, select personal one\r\n  useEffect(() => {\r\n    // make sure we don't unset active workspace while user workspaces are being re-fetched\r\n    if (isFetched && !isFetching && !activeWorkspace) {\r\n      setWorkspaceId(PersonalWorkspace.id);\r\n    }\r\n  }, [activeWorkspace, workspaces, setWorkspaceId, isFetched, isFetching]);\r\n\r\n  if (\r\n    // if we have a custom trigger, leave rendering up to the customer trigger\r\n    !trigger &&\r\n    (!activeWorkspace ||\r\n      (!hasPermission('workspaces.create') && workspaces?.length === 1))\r\n  ) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <Fragment>\r\n      <DialogTrigger\r\n        type=\"popover\"\r\n        placement={placement}\r\n        isOpen={selectorIsOpen}\r\n        onClose={() => {\r\n          setSelectorIsOpen(false);\r\n        }}\r\n      >\r\n        {trigger ? (\r\n          cloneElement(trigger, {\r\n            onClick: () => setSelectorIsOpen(!selectorIsOpen),\r\n          })\r\n        ) : (\r\n          <DefaultTrigger\r\n            onClick={() => setSelectorIsOpen(!selectorIsOpen)}\r\n            workspace={activeWorkspace!}\r\n            className={className}\r\n          />\r\n        )}\r\n        <Dialog size=\"min-w-320\">\r\n          <DialogBody padding=\"p-10\">\r\n            <div className=\"mb-16 border-b pb-10\">\r\n              {workspaces?.map(workspace => (\r\n                <WorkspaceItem\r\n                  key={workspace.id}\r\n                  workspace={workspace}\r\n                  setSelectorIsOpen={setSelectorIsOpen}\r\n                  onChange={onChange}\r\n                />\r\n              ))}\r\n            </div>\r\n            <div className=\"mb-4 px-4 text-center\">\r\n              <CreateWorkspaceButton\r\n                onClick={() => setSelectorIsOpen(false)}\r\n                onCreated={id => onChange?.(id)}\r\n                workspaceCount={workspaces ? workspaces.length - 1 : 0}\r\n              />\r\n            </div>\r\n          </DialogBody>\r\n        </Dialog>\r\n      </DialogTrigger>\r\n    </Fragment>\r\n  );\r\n}\r\n\r\ninterface CreateWorkspaceButtonProps {\r\n  onClick: () => void;\r\n  onCreated?: (id: number) => void;\r\n  workspaceCount: number;\r\n}\r\nfunction CreateWorkspaceButton({\r\n  onClick,\r\n  onCreated,\r\n  workspaceCount,\r\n}: CreateWorkspaceButtonProps) {\r\n  const {setWorkspaceId} = useActiveWorkspaceId();\r\n  const {checkOverQuotaOrNoPermission} = useAuth();\r\n  const {overQuotaOrNoPermission} = checkOverQuotaOrNoPermission(\r\n    'workspaces.create',\r\n    'count',\r\n    workspaceCount,\r\n  );\r\n\r\n  return (\r\n    <Fragment>\r\n      <Button\r\n        disabled={overQuotaOrNoPermission}\r\n        onClick={async e => {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          onClick();\r\n          const workspaceId = await openDialog(NewWorkspaceDialog);\r\n          if (workspaceId) {\r\n            setWorkspaceId(workspaceId);\r\n            onCreated?.(workspaceId);\r\n          }\r\n        }}\r\n        variant=\"outline\"\r\n        startIcon={<AddIcon />}\r\n        color=\"primary\"\r\n        className=\"h-40 w-full\"\r\n      >\r\n        <Trans message=\"Create new workspace\" />\r\n      </Button>\r\n      {overQuotaOrNoPermission && (\r\n        <PolicyFailMessage\r\n          size=\"sm\"\r\n          className=\"mt-12 max-w-288\"\r\n          resourceName={<Trans message=\"worksapces\" />}\r\n        />\r\n      )}\r\n    </Fragment>\r\n  );\r\n}\r\n\r\ninterface DefaultTriggerProps {\r\n  onClick: () => void;\r\n  workspace: Workspace;\r\n  className?: string;\r\n}\r\nconst DefaultTrigger = forwardRef<HTMLButtonElement, DefaultTriggerProps>(\r\n  ({workspace, className, onClick, ...other}, ref) => {\r\n    return (\r\n      <ButtonBase\r\n        ref={ref}\r\n        onClick={onClick}\r\n        className={clsx(\r\n          'flex items-center gap-10 rounded ring-inset hover:bg-hover focus-visible:ring-2',\r\n          className,\r\n        )}\r\n        {...other}\r\n      >\r\n        <span className=\"mr-auto block flex-auto overflow-hidden text-left\">\r\n          <span className=\"block overflow-hidden overflow-ellipsis text-sm font-medium text-main\">\r\n            {workspace.default ? (\r\n              <Trans message={workspace.name} />\r\n            ) : (\r\n              workspace.name\r\n            )}\r\n          </span>\r\n          <span className=\"block text-xs text-muted\">\r\n            {workspace.default ? (\r\n              <Trans message=\"Personal workspace\" />\r\n            ) : (\r\n              <Trans\r\n                message=\":count members\"\r\n                values={{count: workspace.members_count}}\r\n              />\r\n            )}\r\n          </span>\r\n        </span>\r\n        <UnfoldMoreIcon className=\"shrink-0 icon-md\" />\r\n      </ButtonBase>\r\n    );\r\n  },\r\n);\r\n\r\ninterface WorkspaceItemProps {\r\n  workspace: Workspace;\r\n  onChange: WorkspaceSelectorProps['onChange'];\r\n  setSelectorIsOpen: (value: boolean) => void;\r\n}\r\nfunction WorkspaceItem({\r\n  workspace,\r\n  onChange,\r\n  setSelectorIsOpen,\r\n}: WorkspaceItemProps) {\r\n  const {workspaceId, setWorkspaceId} = useActiveWorkspaceId();\r\n  const isActive = workspaceId === workspace.id;\r\n\r\n  return (\r\n    <div\r\n      onClick={() => {\r\n        setWorkspaceId(workspace.id);\r\n        onChange?.(workspace.id);\r\n        setSelectorIsOpen(false);\r\n      }}\r\n      className={clsx(\r\n        'mb-4 flex cursor-pointer items-center gap-12 rounded-lg p-10 text-left',\r\n        isActive && 'bg-primary/5',\r\n        !isActive && 'hover:bg-hover',\r\n      )}\r\n    >\r\n      <CheckIcon\r\n        size=\"sm\"\r\n        className={clsx('flex-shrink-0 text-primary', !isActive && 'invisible')}\r\n      />\r\n      <div className=\"flex-auto\">\r\n        <div className={clsx('text-sm', isActive && 'font-semibold')}>\r\n          {workspace.name}\r\n        </div>\r\n        <div className=\"text-sm text-muted\">\r\n          {workspace.default ? (\r\n            <Trans message=\"Personal workspace\" />\r\n          ) : (\r\n            <Trans\r\n              message=\":count members\"\r\n              values={{count: workspace.members_count}}\r\n            />\r\n          )}\r\n        </div>\r\n      </div>\r\n      {workspace.id !== 0 && (\r\n        <ManageButton\r\n          setSelectorIsOpen={setSelectorIsOpen}\r\n          workspace={workspace}\r\n          onChange={onChange}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface LeaveWorkspaceDialogProps {\r\n  workspace: Workspace;\r\n  onChange?: (id: number) => void;\r\n}\r\nfunction LeaveWorkspaceDialog({\r\n  workspace,\r\n  onChange,\r\n}: LeaveWorkspaceDialogProps) {\r\n  const removeMember = useRemoveMember();\r\n  const {user} = useAuth();\r\n  const {close} = useDialogContext();\r\n  return (\r\n    <LeaveWorkspaceConfirmation\r\n      isLoading={removeMember.isPending}\r\n      onConfirm={() => {\r\n        removeMember.mutate(\r\n          {\r\n            workspaceId: workspace.id,\r\n            memberId: user!.id,\r\n            memberType: 'member',\r\n          },\r\n          {\r\n            onSuccess: () => {\r\n              close();\r\n              onChange?.(PersonalWorkspace.id);\r\n            },\r\n          },\r\n        );\r\n      }}\r\n    />\r\n  );\r\n}\r\n\r\ninterface DeleteWorkspaceConfirmationProps {\r\n  workspace: Workspace;\r\n  onChange?: (id: number) => void;\r\n}\r\nfunction DeleteWorkspaceConfirmation({\r\n  workspace,\r\n  onChange,\r\n}: DeleteWorkspaceConfirmationProps) {\r\n  const deleteWorkspace = useDeleteWorkspace();\r\n  const {close} = useDialogContext();\r\n  return (\r\n    <ConfirmationDialog\r\n      isDanger\r\n      title={<Trans message=\"Delete workspace\" />}\r\n      body={\r\n        <Trans\r\n          message=\"Are you sure you want to delete :name?\"\r\n          values={{name: workspace.name}}\r\n        />\r\n      }\r\n      confirm={<Trans message=\"Delete\" />}\r\n      isLoading={deleteWorkspace.isPending}\r\n      onConfirm={() => {\r\n        deleteWorkspace.mutate(\r\n          {id: workspace.id},\r\n          {\r\n            onSuccess: () => {\r\n              close();\r\n              onChange?.(PersonalWorkspace.id);\r\n            },\r\n          },\r\n        );\r\n      }}\r\n    />\r\n  );\r\n}\r\n\r\ninterface ManageButtonProps {\r\n  setSelectorIsOpen: (value: boolean) => void;\r\n  workspace: Workspace;\r\n  onChange?: (id: number) => void;\r\n}\r\nfunction ManageButton({\r\n  setSelectorIsOpen,\r\n  workspace,\r\n  onChange,\r\n}: ManageButtonProps) {\r\n  const {user} = useAuth();\r\n\r\n  return (\r\n    <MenuTrigger onItemSelected={() => setSelectorIsOpen(false)}>\r\n      <Button\r\n        onClick={e => {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n        }}\r\n        color=\"primary\"\r\n        size=\"xs\"\r\n        variant=\"outline\"\r\n        endIcon={<KeyboardArrowDownIcon />}\r\n      >\r\n        <Trans message=\"Manage\" />\r\n      </Button>\r\n      <Menu>\r\n        <MenuItem\r\n          onClick={e => {\r\n            e.stopPropagation();\r\n            openDialog(WorkspaceMembersDialog, {workspace});\r\n          }}\r\n          value=\"workspaceMembers\"\r\n          startIcon={<PersonAddIcon />}\r\n        >\r\n          <Trans message=\"Members\" />\r\n        </MenuItem>\r\n        {workspace.owner_id === user?.id && (\r\n          <MenuItem\r\n            onClick={e => {\r\n              e.stopPropagation();\r\n              openDialog(RenameWorkspaceDialog, {workspace});\r\n            }}\r\n            value=\"updateWorkspace\"\r\n            startIcon={<EditIcon />}\r\n          >\r\n            <Trans message=\"Rename\" />\r\n          </MenuItem>\r\n        )}\r\n        {workspace.owner_id !== user?.id && (\r\n          <MenuItem\r\n            onClick={e => {\r\n              e.stopPropagation();\r\n              openDialog(LeaveWorkspaceDialog, {workspace, onChange});\r\n            }}\r\n            value=\"leaveWorkspace\"\r\n            startIcon={<ExitToAppIcon />}\r\n          >\r\n            <Trans message=\"Leave\" />\r\n          </MenuItem>\r\n        )}\r\n        {workspace.owner_id === user?.id && (\r\n          <MenuItem\r\n            onClick={e => {\r\n              e.stopPropagation();\r\n              openDialog(DeleteWorkspaceConfirmation, {workspace, onChange});\r\n            }}\r\n            value=\"deleteWorkspace\"\r\n            startIcon={<DeleteIcon />}\r\n          >\r\n            <Trans message=\"Delete\" />\r\n          </MenuItem>\r\n        )}\r\n      </Menu>\r\n    </MenuTrigger>\r\n  );\r\n}\r\n","export enum MenuPositions {\r\n  DriveSidebar = 'drive-sidebar',\r\n}\r\n","import {useQuery} from '@tanstack/react-query';\r\nimport {DriveFolder} from '../drive-entry';\r\nimport {useAuth} from '@common/auth/use-auth';\r\nimport {DriveQueryKeys} from '../../drive-query-keys';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {useActiveWorkspaceId} from '@common/workspace/active-workspace-id-context';\r\n\r\nexport interface UserFoldersApiParams {\r\n  userId: number;\r\n  workspaceId: number | null;\r\n}\r\n\r\ninterface UserFoldersResponse extends BackendResponse {\r\n  folders: DriveFolder[];\r\n  rootFolder: DriveFolder;\r\n}\r\n\r\nfunction fetchUserFolders(\r\n  params: UserFoldersApiParams,\r\n): Promise<UserFoldersResponse> {\r\n  return apiClient\r\n    .get(`users/${params.userId}/folders`, {params})\r\n    .then(response => response.data);\r\n}\r\n\r\nexport function useFolders() {\r\n  const {user} = useAuth();\r\n  const {workspaceId} = useActiveWorkspaceId();\r\n  const params: UserFoldersApiParams = {\r\n    userId: user!.id,\r\n    workspaceId,\r\n  };\r\n  return useQuery({\r\n    queryKey: DriveQueryKeys.fetchUserFolders(params),\r\n    queryFn: () => fetchUserFolders(params),\r\n    enabled: !!user,\r\n  });\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {DriveEntry} from '../drive-entry';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {invalidateEntryQueries} from '../../drive-query-keys';\r\nimport {message} from '@common/i18n/message';\r\nimport {FileEntry} from '@common/uploads/file-entry';\r\nimport {RootFolderPage} from '../../drive-page/drive-page';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\n\r\ninterface Response extends BackendResponse {\r\n  entries: DriveEntry[];\r\n  destination: FileEntry | null;\r\n}\r\n\r\ninterface Payload {\r\n  entryIds: number[];\r\n  destinationId?: number | null;\r\n}\r\n\r\nexport function useMoveEntries() {\r\n  return useMutation({\r\n    mutationFn: (payload: Payload) => {\r\n      toast.loading(\r\n        message('Moving [one 1 item|other :count items]...', {\r\n          values: {\r\n            count: payload.entryIds.length,\r\n          },\r\n        }),\r\n        {disableExitAnimation: true},\r\n      );\r\n      return moveEntries(payload);\r\n    },\r\n    onSuccess: (r, p) => {\r\n      invalidateEntryQueries();\r\n      toast(\r\n        message('Moved [one 1 item|other :count items] to \":destination\"', {\r\n          values: {\r\n            count: p.entryIds.length,\r\n            destination: (r.destination || RootFolderPage.folder).name,\r\n          },\r\n        }),\r\n        {disableEnterAnimation: true},\r\n      );\r\n    },\r\n    onError: err =>\r\n      showHttpErrorToast(err, message('Could not move items'), null, {\r\n        disableEnterAnimation: true,\r\n      }),\r\n  });\r\n}\r\n\r\nfunction moveEntries(payload: Payload): Promise<Response> {\r\n  // backend expects null for root folder, it might be zero or empty string on frontend\r\n  payload.destinationId = !payload.destinationId ? null : payload.destinationId;\r\n  return apiClient\r\n    .post('file-entries/move', payload)\r\n    .then(response => response.data);\r\n}\r\n","import {FileEntry} from '@common/uploads/file-entry';\r\n\r\nexport interface PartialFolder {\r\n  id: number;\r\n  name: string;\r\n  path: string;\r\n  parent_id: number | null;\r\n  type: string;\r\n}\r\n\r\nexport function canMoveEntriesInto(\r\n  targets: FileEntry[],\r\n  destination: PartialFolder\r\n) {\r\n  if (destination.type !== 'folder') return false;\r\n\r\n  // should not be able to move folder into its\r\n  // own child or folder it's already in\r\n  return targets.every(target => {\r\n    if (!target) return false;\r\n    // entry is already in this folder\r\n    if (\r\n      destination.id === target.parent_id ||\r\n      // root folder check\r\n      (!target.parent_id && destination.id === 0)\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    return !destinationIsInTarget(destination, target);\r\n  });\r\n}\r\n\r\nfunction destinationIsInTarget(destination: PartialFolder, target: FileEntry) {\r\n  const destinationPath = (destination.path || '').split('/');\r\n  const targetPath = (target.path || '').split('/');\r\n  return targetPath.every((part, index) => {\r\n    return destinationPath[index] === part;\r\n  });\r\n}\r\n","import {FileEntry} from '@common/uploads/file-entry';\r\nimport {useMoveEntries} from './queries/use-move-entries';\r\nimport {useDriveUploadQueue} from '../uploading/use-drive-upload-queue';\r\nimport {canMoveEntriesInto} from './utils/can-move-entries-into';\r\nimport {\r\n  ConnectedDraggable,\r\n  MixedDraggable,\r\n} from '@common/ui/interactions/dnd/use-draggable';\r\nimport {NativeFileDraggable} from '@common/ui/interactions/dnd/use-droppable';\r\nimport {driveState} from '@app/drive/drive-store';\r\n\r\nexport function useFolderDropAction(folder: FileEntry) {\r\n  const moveEntries = useMoveEntries();\r\n  const {uploadFiles} = useDriveUploadQueue();\r\n\r\n  const onDrop = async (target: ConnectedDraggable | NativeFileDraggable) => {\r\n    if (folder.type !== 'folder') return;\r\n    if (target.type === 'nativeFile') {\r\n      uploadFiles(await target.getData(), {\r\n        metadata: {parentId: folder.id},\r\n      });\r\n    } else if (target.type === 'fileEntry') {\r\n      const entries = target.getData() as FileEntry[];\r\n      if (entries?.length && canMoveEntriesInto(entries, folder)) {\r\n        moveEntries.mutate({\r\n          destinationId: folder.id,\r\n          entryIds: entries.map(e => e.id),\r\n        });\r\n        driveState().deselectEntries('all');\r\n      }\r\n    }\r\n  };\r\n\r\n  return {onDrop};\r\n}\r\n\r\nexport function folderAcceptsDrop(target: MixedDraggable, entry: FileEntry) {\r\n  if (target.type === 'fileEntry') {\r\n    const entries = target.getData() as FileEntry[];\r\n    return canMoveEntriesInto(entries, entry);\r\n  }\r\n  return true;\r\n}\r\n","import {FileEntry} from '@common/uploads/file-entry';\r\n\r\nexport function makeFolderTreeDragId(entry: FileEntry) {\r\n  return `${entry.id}-tree`;\r\n}\r\n\r\nexport function isFolderTreeDragId(id: string | number): boolean {\r\n  return `${id}`.endsWith('-tree');\r\n}\r\n","import {useDroppable} from '@common/ui/interactions/dnd/use-droppable';\r\nimport {driveState} from '../../drive-store';\r\nimport {RefObject, useState} from 'react';\r\nimport {\r\n  folderAcceptsDrop,\r\n  useFolderDropAction,\r\n} from '../../files/use-folder-drop-action';\r\nimport {DriveFolder} from '../../files/drive-entry';\r\nimport {makeFolderTreeDragId} from './folder-tree-drag-id';\r\n\r\ninterface Props {\r\n  folder: DriveFolder;\r\n  ref: RefObject<HTMLDivElement>;\r\n}\r\nexport function useSidebarTreeDropTarget({folder, ref}: Props) {\r\n  const [isDragOver, setIsDragOver] = useState(false);\r\n  const {onDrop} = useFolderDropAction(folder);\r\n\r\n  const dropProps = useDroppable({\r\n    id: makeFolderTreeDragId(folder),\r\n    ref,\r\n    types: ['fileEntry', 'nativeFile'],\r\n    acceptsDrop: draggable => folderAcceptsDrop(draggable, folder),\r\n    onDragEnter: draggable => {\r\n      if (folderAcceptsDrop(draggable, folder)) {\r\n        setIsDragOver(true);\r\n      }\r\n    },\r\n    onDragLeave: () => {\r\n      setIsDragOver(false);\r\n    },\r\n    onDropActivate: () => {\r\n      if (!driveState().sidebarExpandedKeys.includes(folder.id)) {\r\n        driveState().setSidebarExpandedKeys([\r\n          ...driveState().sidebarExpandedKeys,\r\n          folder.id,\r\n        ]);\r\n      }\r\n    },\r\n    onDrop,\r\n  });\r\n\r\n  return {...dropProps, isDragOver};\r\n}\r\n","import {createContext, Key} from 'react';\r\n\r\nexport interface TreeContextValue {\r\n  expandedKeys: Key[];\r\n  setExpandedKeys: (value: Key[]) => void;\r\n  selectedKeys: Key[];\r\n  setSelectedKeys: (value: Key[]) => void;\r\n  focusedNode?: Key;\r\n  setFocusedNode: (node?: Key) => void;\r\n}\r\n\r\nexport const TreeContext = createContext<TreeContextValue>(null!);\r\n","import {TreeItemRenderer} from './tree-item';\r\nimport {cloneElement} from 'react';\r\nimport {TreeNode} from './tree';\r\n\r\ninterface RenderTreeProps<T extends TreeNode> {\r\n  nodes: T[];\r\n  parentNode?: T;\r\n  itemRenderer: TreeItemRenderer<T>;\r\n  level?: number;\r\n}\r\nexport function renderTree<T extends TreeNode>({\r\n  nodes,\r\n  itemRenderer,\r\n  parentNode,\r\n  level,\r\n}: RenderTreeProps<T>) {\r\n  return nodes.map((node, index) => {\r\n    return cloneElement(itemRenderer(node), {\r\n      level: level == undefined ? 0 : level + 1,\r\n      index,\r\n      node,\r\n      parentNode,\r\n      key: node.id,\r\n      itemRenderer,\r\n    });\r\n  });\r\n}\r\n","import React, {\r\n  forwardRef,\r\n  MouseEventHandler,\r\n  ReactNode,\r\n  useContext,\r\n} from 'react';\r\nimport {TreeContext} from './tree-context';\r\nimport clsx from 'clsx';\r\nimport {ArrowRightIcon} from '../../icons/material/ArrowRight';\r\n\r\ninterface TreeLabelProps {\r\n  level?: number;\r\n  node: any;\r\n  icon?: ReactNode;\r\n  label?: ReactNode;\r\n  className?: string;\r\n}\r\nexport const TreeLabel = forwardRef<HTMLDivElement, TreeLabelProps>(\r\n  ({icon, label, level = 0, node, className, ...domProps}, ref) => {\r\n    const {expandedKeys, setExpandedKeys, selectedKeys, setSelectedKeys} =\r\n      useContext(TreeContext);\r\n    const isExpanded = expandedKeys.includes(node.id);\r\n    const isSelected = selectedKeys.includes(node.id);\r\n\r\n    const handleExpandIconClick: MouseEventHandler = e => {\r\n      e.stopPropagation();\r\n      const index = expandedKeys.indexOf(node.id);\r\n      const newExpandedKeys = [...expandedKeys];\r\n      if (index > -1) {\r\n        newExpandedKeys.splice(index, 1);\r\n      } else {\r\n        newExpandedKeys.push(node.id);\r\n      }\r\n      setExpandedKeys(newExpandedKeys);\r\n    };\r\n\r\n    return (\r\n      <div\r\n        {...domProps}\r\n        ref={ref}\r\n        onClick={e => {\r\n          e.stopPropagation();\r\n          setSelectedKeys([node.id]);\r\n        }}\r\n        className={clsx(\r\n          'flex flex-nowrap whitespace-nowrap items-center gap-4 py-6 rounded header cursor-pointer overflow-hidden text-ellipsis tree-label',\r\n          className,\r\n          isSelected && 'bg-primary/selected text-primary font-bold',\r\n          !isSelected && 'hover:bg-hover'\r\n        )}\r\n      >\r\n        {level > 0 && (\r\n          <div className=\"flex\">\r\n            {Array.from({length: level}).map((_, i) => {\r\n              return <div key={i} className=\"w-24 h-24\" />;\r\n            })}\r\n          </div>\r\n        )}\r\n        <div onClick={handleExpandIconClick}>\r\n          <ArrowRightIcon\r\n            className={clsx(\r\n              'icon-sm cursor-default transition-transform',\r\n              isExpanded && 'rotate-90'\r\n            )}\r\n          />\r\n        </div>\r\n        {icon}\r\n        <div className=\"overflow-hidden text-ellipsis pr-6\">{label}</div>\r\n      </div>\r\n    );\r\n  }\r\n);\r\nTreeLabel.displayName = 'TreeLabel';\r\n","import React, {\r\n  HTMLAttributes,\r\n  ReactElement,\r\n  ReactNode,\r\n  Ref,\r\n  useContext,\r\n  useEffect,\r\n} from 'react';\r\nimport {useFocusManager} from '@react-aria/focus';\r\nimport {TreeContext} from './tree-context';\r\nimport {createEventHandler} from '../../utils/dom/create-event-handler';\r\nimport clsx from 'clsx';\r\nimport {AnimatePresence, m} from 'framer-motion';\r\nimport {TreeNode} from './tree';\r\nimport {renderTree} from './render-tree';\r\nimport {TreeLabel} from './tree-label';\r\n\r\nexport type TreeItemRenderer<T extends TreeNode> = (\r\n  node: any,\r\n) => ReactElement<TreeItemProps<T>>;\r\n\r\nexport interface TreeItemProps<T extends TreeNode>\r\n  extends HTMLAttributes<HTMLElement> {\r\n  label: ReactNode;\r\n  icon: ReactNode;\r\n  node?: T;\r\n  parentNode?: T;\r\n  level?: number;\r\n  index?: number;\r\n  itemRenderer?: TreeItemRenderer<T>;\r\n  labelRef?: Ref<HTMLDivElement>;\r\n  labelClassName?: string;\r\n  className?: string;\r\n}\r\nexport function TreeItem<T extends TreeNode>({\r\n  label,\r\n  icon,\r\n  node,\r\n  level,\r\n  index,\r\n  itemRenderer,\r\n  labelRef,\r\n  labelClassName,\r\n  className,\r\n  parentNode,\r\n  ...domProps\r\n}: TreeItemProps<T>) {\r\n  const focusManager = useFocusManager();\r\n  const {\r\n    expandedKeys,\r\n    selectedKeys,\r\n    focusedNode,\r\n    setFocusedNode,\r\n    setExpandedKeys,\r\n    setSelectedKeys,\r\n  } = useContext(TreeContext);\r\n\r\n  // clear focused node on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (focusedNode === node?.id) {\r\n        setFocusedNode(undefined);\r\n      }\r\n    };\r\n  }, [focusedNode, node?.id, setFocusedNode]);\r\n\r\n  if (!node || !itemRenderer) return null;\r\n\r\n  const hasChildren = node.children.length;\r\n  const isExpanded = hasChildren && expandedKeys.includes(node.id);\r\n  const isSelected = selectedKeys.includes(node.id);\r\n  const isFirstNode = level === 0 && index === 0;\r\n  const isFocused =\r\n    focusedNode == undefined ? isFirstNode : focusedNode === node.id;\r\n\r\n  const onKeyDown = (e: React.KeyboardEvent<HTMLUListElement>) => {\r\n    if (focusedNode == null) return;\r\n    switch (e.key) {\r\n      // select the node\r\n      case 'Enter':\r\n      case ' ':\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        setSelectedKeys([focusedNode]);\r\n        break;\r\n\r\n      // expand node, or move focus to first (and only first) child\r\n      case 'ArrowRight':\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (!hasChildren) return;\r\n\r\n        if (!isExpanded) {\r\n          setExpandedKeys([...expandedKeys, focusedNode]);\r\n        } else {\r\n          focusManager?.focusNext();\r\n        }\r\n        break;\r\n\r\n      // collapse node, or move focus to parent node\r\n      case 'ArrowLeft':\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (isExpanded) {\r\n          const index = expandedKeys.indexOf(focusedNode);\r\n          const newKeys = [...expandedKeys];\r\n          newKeys.splice(index, 1);\r\n          setExpandedKeys(newKeys);\r\n        } else if (parentNode) {\r\n          const parentEl =\r\n            document.activeElement?.parentElement?.closest('[tabindex]');\r\n          if (parentEl) {\r\n            (parentEl as HTMLElement).focus();\r\n          }\r\n        }\r\n        break;\r\n\r\n      // focus next visible node, recursively\r\n      case 'ArrowDown':\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        focusManager?.focusNext();\r\n        break;\r\n\r\n      // focus previous visible node, recursively\r\n      case 'ArrowUp':\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        focusManager?.focusPrevious();\r\n        break;\r\n\r\n      // focus first visible node\r\n      case 'Home':\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        focusManager?.focusFirst();\r\n        break;\r\n\r\n      // focus last visible node\r\n      case 'End':\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        focusManager?.focusLast();\r\n        break;\r\n\r\n      // expand all sibling nodes\r\n      case '*':\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (parentNode?.children) {\r\n          const newKeys = [...expandedKeys];\r\n          parentNode.children.forEach(childNode => {\r\n            if (\r\n              childNode.children.length &&\r\n              !expandedKeys.includes(childNode.id)\r\n            ) {\r\n              newKeys.push(childNode.id);\r\n            }\r\n          });\r\n          if (newKeys.length !== expandedKeys.length) {\r\n            setExpandedKeys(newKeys);\r\n          }\r\n        }\r\n        break;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <li\r\n      role=\"treeitem\"\r\n      aria-expanded={isExpanded ? 'true' : 'false'}\r\n      aria-selected={isSelected}\r\n      tabIndex={isFocused ? 0 : -1}\r\n      onKeyDown={createEventHandler(onKeyDown)}\r\n      onFocus={e => {\r\n        e.stopPropagation();\r\n        setFocusedNode(node.id);\r\n      }}\r\n      onBlur={e => {\r\n        e.stopPropagation();\r\n        // only clear focus state when focus moves outside the tree\r\n        if (!e.currentTarget.contains(e.relatedTarget)) {\r\n          setFocusedNode(undefined);\r\n        }\r\n      }}\r\n      className={clsx(\r\n        'outline-none',\r\n        // focus direct .tree-label child when this element has :focus-visible\r\n        '[&>.tree-label]:focus-visible:ring [&>.tree-label]:focus-visible:ring-2 [&>.tree-label]:focus-visible:ring-inset',\r\n        className,\r\n      )}\r\n    >\r\n      <TreeLabel\r\n        ref={labelRef}\r\n        className={labelClassName}\r\n        node={node}\r\n        level={level}\r\n        label={label}\r\n        icon={icon}\r\n        {...domProps}\r\n      />\r\n      <AnimatePresence initial={false}>\r\n        {isExpanded ? (\r\n          <m.ul\r\n            key={`${node.id}-group`}\r\n            role=\"group\"\r\n            initial=\"closed\"\r\n            animate=\"open\"\r\n            exit=\"closed\"\r\n            variants={{\r\n              open: {opacity: 1, height: 'auto'},\r\n              closed: {opacity: 0, height: 0, overflow: 'hidden'},\r\n            }}\r\n          >\r\n            {renderTree({\r\n              nodes: node.children,\r\n              parentNode: node,\r\n              itemRenderer,\r\n              level,\r\n            })}\r\n          </m.ul>\r\n        ) : null}\r\n      </AnimatePresence>\r\n    </li>\r\n  );\r\n}\r\n","import React, {Key, useState} from 'react';\r\nimport {useControlledState} from '@react-stately/utils';\r\nimport {FocusScope} from '@react-aria/focus';\r\nimport {TreeContext, TreeContextValue} from './tree-context';\r\nimport {TreeItemRenderer} from './tree-item';\r\nimport {renderTree} from './render-tree';\r\n\r\nexport interface TreeNode {\r\n  id: number | string;\r\n  children: TreeNode[];\r\n}\r\n\r\ninterface TreeProps<T extends TreeNode> {\r\n  children: TreeItemRenderer<T>;\r\n  nodes: T[];\r\n  selectedKeys?: Key[];\r\n  expandedKeys?: Key[];\r\n  defaultExpandedKeys?: Key[];\r\n  onExpandedKeysChange?: (value: Key[]) => void;\r\n  defaultSelectedKeys?: Key[];\r\n  onSelectedKeysChange?: (value: Key[]) => void;\r\n}\r\nexport function Tree<T extends TreeNode>({\r\n  children,\r\n  nodes,\r\n  ...props\r\n}: TreeProps<T>) {\r\n  const [expandedKeys, setExpandedKeys] = useControlledState(\r\n    props.expandedKeys,\r\n    props.defaultSelectedKeys,\r\n    props.onExpandedKeysChange\r\n  );\r\n  const [selectedKeys, setSelectedKeys] = useControlledState(\r\n    props.selectedKeys,\r\n    props.defaultSelectedKeys,\r\n    props.onSelectedKeysChange\r\n  );\r\n  const [focusedNode, setFocusedNode] = useState<Key | undefined>();\r\n\r\n  const value: TreeContextValue = {\r\n    expandedKeys,\r\n    setExpandedKeys,\r\n    selectedKeys,\r\n    setSelectedKeys,\r\n    focusedNode,\r\n    setFocusedNode,\r\n  };\r\n\r\n  return (\r\n    <TreeContext.Provider value={value}>\r\n      <FocusScope>\r\n        <TreeRoot nodes={nodes} itemRenderer={children} />\r\n      </FocusScope>\r\n    </TreeContext.Provider>\r\n  );\r\n}\r\n\r\ninterface TreeRootProps<T extends TreeNode> {\r\n  nodes: TreeNode[];\r\n  itemRenderer: TreeItemRenderer<T>;\r\n}\r\nfunction TreeRoot<T extends TreeNode>(props: TreeRootProps<T>) {\r\n  return (\r\n    <ul className=\"overflow-hidden text-sm\" role=\"tree\">\r\n      {renderTree(props)}\r\n    </ul>\r\n  );\r\n}\r\n","import React, {useMemo, useRef} from 'react';\r\nimport {arrayToTree} from 'performant-array-to-tree';\r\nimport {useFolders} from '../../files/queries/use-folders';\r\nimport {DriveFolder} from '../../files/drive-entry';\r\nimport {driveState, useDriveStore} from '../../drive-store';\r\nimport {FolderIcon} from '@common/icons/material/Folder';\r\nimport {getPathForFolder, RootFolderPage} from '../../drive-page/drive-page';\r\nimport {mergeProps} from '@react-aria/utils';\r\nimport {\r\n  ConnectedDraggable,\r\n  useDraggable,\r\n} from '@common/ui/interactions/dnd/use-draggable';\r\nimport {useSidebarTreeDropTarget} from './use-sidebar-tree-drop-target';\r\nimport {makeFolderTreeDragId} from './folder-tree-drag-id';\r\nimport {FileEntry} from '@common/uploads/file-entry';\r\nimport clsx from 'clsx';\r\nimport {BackupIcon} from '@common/icons/material/Backup';\r\nimport {TreeItem, TreeItemProps} from '@common/ui/tree/tree-item';\r\nimport {Tree} from '@common/ui/tree/tree';\r\nimport {useNavigate} from '@common/utils/hooks/use-navigate';\r\n\r\ninterface TreeFolder extends DriveFolder {\r\n  children: TreeFolder[];\r\n}\r\n\r\nexport function FolderTree() {\r\n  const navigate = useNavigate();\r\n  const {data} = useFolders();\r\n  const expandedKeys = useDriveStore(s => s.sidebarExpandedKeys);\r\n\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  let selectedKeys: number[] = [];\r\n  if (activePage?.isFolderPage) {\r\n    selectedKeys = activePage.folder ? [activePage.folder.id] : [];\r\n  }\r\n\r\n  const tree = useMemo(() => {\r\n    const folders = arrayToTree(data?.folders || [], {\r\n      parentId: 'parent_id',\r\n      dataField: null,\r\n    }) as TreeFolder[];\r\n    const rootFolder = {\r\n      ...RootFolderPage.folder,\r\n      children: folders,\r\n    };\r\n    return [rootFolder];\r\n  }, [data?.folders]);\r\n\r\n  return (\r\n    <Tree\r\n      nodes={tree}\r\n      expandedKeys={expandedKeys}\r\n      onExpandedKeysChange={keys => {\r\n        driveState().setSidebarExpandedKeys(keys);\r\n      }}\r\n      selectedKeys={selectedKeys}\r\n      onSelectedKeysChange={([id]) => {\r\n        const entryHash = findHash(id as number, tree);\r\n        if (entryHash) {\r\n          navigate(getPathForFolder(entryHash));\r\n        } else {\r\n          navigate(RootFolderPage.path);\r\n        }\r\n      }}\r\n    >\r\n      {() => <FolderTreeItem />}\r\n    </Tree>\r\n  );\r\n}\r\n\r\n// props will be passed by tree via cloneElement\r\nfunction FolderTreeItem(props: Partial<TreeItemProps<TreeFolder>>) {\r\n  const {node} = props as Required<TreeItemProps<TreeFolder>>;\r\n  const labelRef = useRef<HTMLDivElement>(null);\r\n  const isRootFolder = node.id === 0;\r\n  const isDragging = useDriveStore(s =>\r\n    s.entriesBeingDragged.includes(node.id)\r\n  );\r\n\r\n  const {draggableProps} = useDraggable({\r\n    type: 'fileEntry',\r\n    id: makeFolderTreeDragId(node),\r\n    ref: labelRef,\r\n    disabled: isRootFolder,\r\n    hidePreview: true,\r\n    onDragStart: (e, draggable) => {\r\n      const d = draggable as ConnectedDraggable<FileEntry[]>;\r\n      driveState().setEntriesBeingDragged(d.getData().map(e => e.id));\r\n      driveState().selectEntries([]);\r\n    },\r\n    onDragEnd: () => {\r\n      driveState().setEntriesBeingDragged([]);\r\n    },\r\n    getData: () => [node],\r\n  });\r\n\r\n  const {droppableProps, isDragOver} = useSidebarTreeDropTarget({\r\n    folder: node,\r\n    ref: labelRef,\r\n  });\r\n\r\n  return (\r\n    <TreeItem\r\n      {...mergeProps(draggableProps, droppableProps, props)}\r\n      onContextMenu={e => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        driveState().deselectEntries('all');\r\n        driveState().setContextMenuData({\r\n          x: e.clientX,\r\n          y: e.clientY,\r\n          entry: node,\r\n        });\r\n      }}\r\n      labelRef={labelRef}\r\n      className={isRootFolder ? 'focus-visible:ring-2' : undefined}\r\n      labelClassName={clsx(\r\n        isDragOver && 'bg-primary/selected ring ring-2 ring-inset ring-primary',\r\n        isDragging && 'opacity-30',\r\n        isRootFolder && 'h-40'\r\n      )}\r\n      icon={\r\n        isRootFolder ? (\r\n          <BackupIcon size=\"md\" className=\"mr-6\" />\r\n        ) : (\r\n          <FolderIcon size=\"sm\" className=\"mr-4\" />\r\n        )\r\n      }\r\n      label={node.name}\r\n    />\r\n  );\r\n}\r\n\r\nconst findHash = (id: number, nodes: FileEntry[]): string | undefined => {\r\n  for (const item of nodes) {\r\n    if (item.id === id) {\r\n      return item.hash;\r\n    } else if (item.children) {\r\n      const hash = findHash(id, item.children);\r\n      if (hash) {\r\n        return hash;\r\n      }\r\n    }\r\n  }\r\n};\r\n","import {CustomMenu, CustomMenuItem} from '@common/menus/custom-menu';\r\nimport {MenuPositions} from '../../menu-positions';\r\nimport React, {\r\n  ComponentPropsWithoutRef,\r\n  forwardRef,\r\n  useRef,\r\n  useState,\r\n} from 'react';\r\nimport {MenuItemConfig} from '@common/core/settings/settings';\r\nimport clsx from 'clsx';\r\nimport {useDroppable} from '@common/ui/interactions/dnd/use-droppable';\r\nimport {FileEntry} from '@common/uploads/file-entry';\r\nimport {FolderTree} from './folder-tree';\r\nimport {useDeleteEntries} from '../../files/queries/use-delete-entries';\r\nimport {useActiveWorkspaceId} from '@common/workspace/active-workspace-id-context';\r\n\r\nexport function SidebarMenu() {\r\n  const {workspaceId} = useActiveWorkspaceId();\r\n  return (\r\n    <div className=\"text-muted mt-26 px-12\">\r\n      <FolderTree />\r\n      <CustomMenu\r\n        menu={MenuPositions.DriveSidebar}\r\n        orientation=\"vertical\"\r\n        gap=\"gap-0\"\r\n      >\r\n        {item => {\r\n          if (item.action === '/drive/trash') {\r\n            return <TrashMenuItem key={item.id} item={item} />;\r\n          }\r\n          return <MenuItem key={item.id} item={item} />;\r\n        }}\r\n      </CustomMenu>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface MenuItemProps extends ComponentPropsWithoutRef<'a'> {\r\n  item: MenuItemConfig;\r\n  className?: string;\r\n}\r\nexport const MenuItem = forwardRef<HTMLAnchorElement, MenuItemProps>(\r\n  ({item, className, ...domProps}, ref) => {\r\n    return (\r\n      <CustomMenuItem\r\n        className={({isActive}) =>\r\n          clsx(\r\n            className,\r\n            'h-40 w-full my-4 px-24 rounded',\r\n            isActive\r\n              ? 'text-primary font-bold bg-primary/selected cursor-default'\r\n              : 'hover:bg-hover'\r\n          )\r\n        }\r\n        item={item}\r\n        ref={ref}\r\n        {...domProps}\r\n      />\r\n    );\r\n  }\r\n);\r\n\r\ninterface TrashMenuItemProps {\r\n  item: MenuItemConfig;\r\n}\r\nfunction TrashMenuItem({item}: TrashMenuItemProps) {\r\n  const deleteEntries = useDeleteEntries();\r\n  const [isDragOver, setIsDragOver] = useState(false);\r\n  const ref = useRef<HTMLAnchorElement>(null);\r\n\r\n  const {droppableProps} = useDroppable({\r\n    id: 'trash',\r\n    types: ['fileEntry'],\r\n    ref,\r\n    onDragEnter: () => {\r\n      setIsDragOver(true);\r\n    },\r\n    onDragLeave: () => {\r\n      setIsDragOver(false);\r\n    },\r\n    onDrop: draggable => {\r\n      const entryIds = (draggable.getData() as FileEntry[]).map(e => e.id);\r\n      deleteEntries.mutate({entryIds, deleteForever: false});\r\n    },\r\n  });\r\n  return (\r\n    <MenuItem\r\n      className={clsx(isDragOver && 'bg-primary/selected')}\r\n      ref={ref}\r\n      {...droppableProps}\r\n      item={item}\r\n    />\r\n  );\r\n}\r\n","import {driveState, useDriveStore} from '../drive-store';\r\nimport {useDriveUploadQueue} from '../uploading/use-drive-upload-queue';\r\nimport {\r\n  Menu,\r\n  MenuItem,\r\n  MenuTrigger,\r\n} from '@common/ui/navigation/menu/menu-trigger';\r\nimport {openUploadWindow} from '@common/uploads/utils/open-upload-window';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {FileUploadIcon} from '@common/icons/material/FileUpload';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {CreateNewFolderIcon} from '@common/icons/material/CreateNewFolder';\r\nimport {UploadFileIcon} from '@common/icons/material/UploadFile';\r\nimport {DriveFolderUploadIcon} from '@common/icons/material/DriveFolderUpload';\r\nimport React from 'react';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {AddIcon} from '@common/icons/material/Add';\r\n\r\ninterface CreateNewButtonProps {\r\n  isCompact?: boolean;\r\n  className?: string;\r\n}\r\nexport function CreateNewButton({isCompact, className}: CreateNewButtonProps) {\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  const {uploadFiles} = useDriveUploadQueue();\r\n\r\n  const button = isCompact ? (\r\n    <IconButton size=\"md\">\r\n      <AddIcon />\r\n    </IconButton>\r\n  ) : (\r\n    <Button\r\n      className=\"min-w-160\"\r\n      color=\"primary\"\r\n      variant=\"flat\"\r\n      size=\"sm\"\r\n      startIcon={<FileUploadIcon />}\r\n      disabled={!activePage?.canUpload}\r\n    >\r\n      <Trans message=\"Upload\" />\r\n    </Button>\r\n  );\r\n\r\n  return (\r\n    <div className={className}>\r\n      <MenuTrigger\r\n        onItemSelected={async value => {\r\n          if (value === 'uploadFiles') {\r\n            uploadFiles(await openUploadWindow({multiple: true}));\r\n          } else if (value === 'uploadFolder') {\r\n            uploadFiles(await openUploadWindow({directory: true}));\r\n          } else if (value === 'newFolder') {\r\n            const activeFolder = driveState().activePage?.folder;\r\n            driveState().setActiveActionDialog(\r\n              'newFolder',\r\n              activeFolder ? [activeFolder] : []\r\n            );\r\n          }\r\n        }}\r\n      >\r\n        {button}\r\n        <Menu>\r\n          <MenuItem value=\"uploadFiles\" startIcon={<UploadFileIcon />}>\r\n            <Trans message=\"Upload files\" />\r\n          </MenuItem>\r\n          <MenuItem value=\"uploadFolder\" startIcon={<DriveFolderUploadIcon />}>\r\n            <Trans message=\"Upload folder\" />\r\n          </MenuItem>\r\n          <MenuItem value=\"newFolder\" startIcon={<CreateNewFolderIcon />}>\r\n            <Trans message=\"Create folder\" />\r\n          </MenuItem>\r\n        </Menu>\r\n      </MenuTrigger>\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport {StorageMeter} from './storage-summary/storage-meter';\r\nimport {WorkspaceSelector} from '@common/workspace/workspace-selector';\r\nimport {RootFolderPage} from '../../drive-page/drive-page';\r\nimport {SidebarMenu} from './sidebar-menu';\r\nimport {useNavigate} from '@common/utils/hooks/use-navigate';\r\nimport {CreateNewButton} from '../create-new-button';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {Link} from 'react-router-dom';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {useAuth} from '@common/auth/use-auth';\r\nimport clsx from 'clsx';\r\nimport {useSettings} from '@common/core/settings/use-settings';\r\n\r\ninterface SidebarProps {\r\n  className?: string;\r\n}\r\nexport function Sidebar({className}: SidebarProps) {\r\n  const {isSubscribed} = useAuth();\r\n  const {billing} = useSettings();\r\n  return (\r\n    <div\r\n      className={clsx(\r\n        className,\r\n        'flex flex-col gap-20 border-r bg-alt text-sm font-medium text-muted',\r\n      )}\r\n    >\r\n      <div className=\"compact-scrollbar flex-auto overflow-y-auto\">\r\n        <CreateNewButton className=\"px-12 pt-28 text-center\" />\r\n        <SidebarMenu />\r\n        <StorageMeter />\r\n        {billing.enable ? (\r\n          <div className=\"mt-14 pl-60\">\r\n            <Button\r\n              elementType={Link}\r\n              to={isSubscribed ? '/billing/change-plan' : '/pricing'}\r\n              variant=\"outline\"\r\n              color=\"primary\"\r\n              size=\"xs\"\r\n            >\r\n              <Trans message=\"Upgrade\" />\r\n            </Button>\r\n          </div>\r\n        ) : null}\r\n      </div>\r\n      <WorkspaceSwitcher />\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction WorkspaceSwitcher() {\r\n  const navigate = useNavigate();\r\n  return (\r\n    <WorkspaceSelector\r\n      onChange={() => {\r\n        navigate(RootFolderPage.path);\r\n      }}\r\n      className=\"mt-auto w-full flex-shrink-0 border-t px-24 py-18\"\r\n    />\r\n  );\r\n}\r\n","import {InfiniteData, useInfiniteQuery} from '@tanstack/react-query';\r\nimport {useSearchParams} from 'react-router-dom';\r\nimport {LengthAwarePaginationResponse} from '@common/http/backend-response/pagination-response';\r\nimport {DriveEntry, DriveFolder} from '../drive-entry';\r\nimport {driveState, useDriveStore} from '../../drive-store';\r\nimport {apiClient, queryClient} from '@common/http/query-client';\r\nimport {DriveQueryKeys} from '../../drive-query-keys';\r\nimport {SortColumn, SortDirection} from '../../layout/sorting/available-sorts';\r\nimport {useActiveWorkspaceId} from '@common/workspace/active-workspace-id-context';\r\nimport {makeFolderPage, SearchPage} from '../../drive-page/drive-page';\r\nimport {useEffect} from 'react';\r\nimport {shallowEqual} from '@common/utils/shallow-equal';\r\n\r\nexport interface DriveApiIndexParams {\r\n  orderBy?: SortColumn;\r\n  orderDir?: SortDirection;\r\n  folderId?: string | number | null;\r\n  query?: string;\r\n  filters?: string;\r\n  deletedOnly?: boolean;\r\n  starredOnly?: boolean;\r\n  sharedOnly?: boolean;\r\n  perPage?: number;\r\n  page?: number;\r\n  recentOnly?: boolean;\r\n  workspaceId?: number | null;\r\n  section?: string;\r\n}\r\n\r\ninterface EntriesPaginationResponse\r\n  extends LengthAwarePaginationResponse<DriveEntry> {\r\n  folder?: DriveFolder;\r\n}\r\n\r\nfunction fetchEntries(\r\n  params: DriveApiIndexParams,\r\n): Promise<EntriesPaginationResponse> {\r\n  return apiClient\r\n    .get('drive/file-entries', {\r\n      params,\r\n    })\r\n    .then(response => response.data);\r\n}\r\n\r\nconst setActiveFolder = (response: InfiniteData<EntriesPaginationResponse>) => {\r\n  const firstPage = response.pages[0];\r\n  const newFolder = firstPage.folder;\r\n  const currentPage = driveState().activePage;\r\n\r\n  if (\r\n    newFolder &&\r\n    currentPage &&\r\n    currentPage.uniqueId === newFolder.hash &&\r\n    // only update page if once to set the folder or if permissions change, to keep page reference as stable as possible\r\n    (!currentPage.folder ||\r\n      !shallowEqual(newFolder.permissions, currentPage.folder?.permissions))\r\n  ) {\r\n    driveState().setActivePage(makeFolderPage(newFolder));\r\n  }\r\n  return response;\r\n};\r\n\r\nexport function usePaginatedEntries() {\r\n  const page = useDriveStore(s => s.activePage);\r\n  const sortDescriptor = useDriveStore(s => s.sortDescriptor);\r\n  const [searchParams] = useSearchParams();\r\n  const {workspaceId} = useActiveWorkspaceId();\r\n  const params: DriveApiIndexParams = {\r\n    section: page?.name,\r\n    ...page?.queryParams,\r\n    ...Object.fromEntries(searchParams),\r\n    folderId: page?.isFolderPage ? page.uniqueId : null,\r\n    workspaceId,\r\n    ...sortDescriptor,\r\n  };\r\n\r\n  // if we have no search query, there's no need to call the API, show no results message instead\r\n  const isDisabledInSearch =\r\n    page === SearchPage && !params.query && !params.filters;\r\n\r\n  const query = useInfiniteQuery({\r\n    queryKey: DriveQueryKeys.fetchEntries(params),\r\n    queryFn: ({pageParam = 1}) => {\r\n      return fetchEntries({...params, page: pageParam});\r\n    },\r\n    initialPageParam: 1,\r\n    getNextPageParam: lastResponse => {\r\n      const currentPage = lastResponse.current_page;\r\n      const lastPage = lastResponse.last_page;\r\n      if (currentPage >= lastPage) {\r\n        return undefined;\r\n      }\r\n      return currentPage + 1;\r\n    },\r\n    enabled: page != null && !isDisabledInSearch,\r\n  });\r\n\r\n  // need to do this in effect, to avoid react errors about\r\n  // multiple components re-rendering at the same time\r\n  useEffect(() => {\r\n    if (query.data?.pages[0].folder) {\r\n      setActiveFolder(query.data);\r\n    }\r\n  }, [query.data]);\r\n\r\n  return query;\r\n}\r\n\r\nexport function getAllEntries() {\r\n  const caches = queryClient.getQueriesData<\r\n    InfiniteData<EntriesPaginationResponse>\r\n  >({queryKey: DriveQueryKeys.fetchEntries()});\r\n  return caches.reduce<DriveEntry[]>((all, cache) => {\r\n    const current = cache[1] ? cache[1].pages.flatMap(p => p.data) : [];\r\n    return [...all, ...current];\r\n  }, []);\r\n}\r\n","import {\r\n  BackendFilter,\r\n  FilterControlType,\r\n  FilterOperator,\r\n} from '@common/datatable/filters/backend-filter';\r\nimport {FILE_ENTRY_TYPE_FILTER} from '@common/admin/file-entry/file-entry-index-filters';\r\nimport {message} from '@common/i18n/message';\r\nimport {\r\n  createdAtFilter,\r\n  updatedAtFilter,\r\n} from '@common/datatable/filters/timestamp-filters';\r\n\r\nexport const driveSearchFilters: BackendFilter[] = [\r\n  FILE_ENTRY_TYPE_FILTER,\r\n  {\r\n    key: 'owner_id',\r\n    label: message('Owner'),\r\n    description: message('User file was uploaded by'),\r\n    defaultOperator: FilterOperator.eq,\r\n    control: {\r\n      type: FilterControlType.Select,\r\n      defaultValue: '02',\r\n      options: [\r\n        {\r\n          key: '01',\r\n          label: message('anyone'),\r\n          value: {value: null, operator: '!='},\r\n        },\r\n        {\r\n          key: '02',\r\n          label: message('me'),\r\n          value: '{authId}',\r\n        },\r\n        {\r\n          key: '03',\r\n          label: message('not me'),\r\n          value: {value: '{authId}', operator: '!='},\r\n        },\r\n      ],\r\n    },\r\n  },\r\n  createdAtFilter({\r\n    description: message('Date file was uploaded'),\r\n  }),\r\n  updatedAtFilter({\r\n    description: message('Date file was last changed'),\r\n  }),\r\n  {\r\n    key: 'deleted_at',\r\n    label: message('In trash'),\r\n    description: message('Only show files that are in the trash'),\r\n    defaultOperator: FilterOperator.ne,\r\n    control: {\r\n      type: FilterControlType.BooleanToggle,\r\n      defaultValue: null,\r\n    },\r\n  },\r\n  {\r\n    key: 'shareableLink',\r\n    label: message('Has shareable link'),\r\n    description: message('Only show files that have a shareable link'),\r\n    defaultOperator: FilterOperator.has,\r\n    control: {\r\n      type: FilterControlType.BooleanToggle,\r\n      defaultValue: '*',\r\n    },\r\n  },\r\n  {\r\n    control: {\r\n      type: FilterControlType.BooleanToggle,\r\n      defaultValue: true,\r\n    },\r\n    key: 'sharedByMe',\r\n    label: message('Shared by me'),\r\n    description: message('Only show files that are shared with someone'),\r\n    defaultOperator: FilterOperator.eq,\r\n  },\r\n];\r\n","import React, {useContext, useState} from 'react';\r\nimport {driveSearchFilters} from './drive-search-filters';\r\nimport {useDriveStore} from '../drive-store';\r\nimport {SearchPage} from '../drive-page/drive-page';\r\nimport {TextField} from '@common/ui/forms/input-field/text-field/text-field';\r\nimport {SearchIcon} from '@common/icons/material/Search';\r\nimport {DashboardLayoutContext} from '@common/ui/layout/dashboard-layout-context';\r\nimport {FilterList} from '@common/datatable/filters/filter-list/filter-list';\r\nimport {useTrans} from '@common/i18n/use-trans';\r\nimport {useNavigate} from '@common/utils/hooks/use-navigate';\r\nimport {useSearchParams} from 'react-router-dom';\r\nimport {message} from '@common/i18n/message';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\n\r\nconst alwaysShownFilters = driveSearchFilters.map(f => f.key);\r\n\r\nexport function SearchFilterList() {\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  const {isMobileMode} = useContext(DashboardLayoutContext);\r\n  const {trans} = useTrans();\r\n  const navigate = useNavigate();\r\n  const [searchParams] = useSearchParams();\r\n  const [inputValue, setInputValue] = useState(searchParams.get('query') || '');\r\n\r\n  if (activePage !== SearchPage) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"mb-30 mt-10 px-10 md:px-26\">\r\n      {isMobileMode && (\r\n        <form\r\n          className=\"contents\"\r\n          onSubmit={e => {\r\n            e.preventDefault();\r\n            // blur input so mobile keyboard is hidden\r\n            if (document.activeElement?.tagName === 'INPUT') {\r\n              (document.activeElement as HTMLInputElement).blur();\r\n            }\r\n            navigate(\r\n              {\r\n                pathname: SearchPage.path,\r\n                search: `?query=${inputValue}`,\r\n              },\r\n              {replace: true},\r\n            );\r\n          }}\r\n        >\r\n          <TextField\r\n            autoFocus\r\n            className=\"mb-20\"\r\n            startAdornment={\r\n              <IconButton type=\"submit\">\r\n                <SearchIcon />\r\n              </IconButton>\r\n            }\r\n            placeholder={trans(message('Type to search'))}\r\n            value={inputValue}\r\n            onChange={e => setInputValue(e.target.value)}\r\n          />\r\n        </form>\r\n      )}\r\n      <FilterList\r\n        filters={driveSearchFilters}\r\n        pinnedFilters={alwaysShownFilters}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","import {InteractableRect} from '../interactable-event';\r\n\r\nexport function restrictResizableWithinBoundary(\r\n  rect: InteractableRect,\r\n  boundaryRect: InteractableRect\r\n) {\r\n  const boundedRect = {...rect};\r\n\r\n  // restrict to left edge of boundary\r\n  boundedRect.left = Math.max(0, boundedRect.left);\r\n  // compensate width when left is bounded\r\n  const leftRestriction = boundedRect.left - rect.left;\r\n  if (leftRestriction > 0) {\r\n    boundedRect.width -= leftRestriction;\r\n  }\r\n\r\n  // restrict to top edge of boundary\r\n  boundedRect.top = Math.max(0, boundedRect.top);\r\n  // compensate height when top is bounded\r\n  const topRestriction = boundedRect.top - rect.top;\r\n  if (topRestriction > 0) {\r\n    boundedRect.height -= topRestriction;\r\n  }\r\n\r\n  // restrict to right edge of boundary\r\n  boundedRect.width = Math.min(\r\n    boundedRect.width,\r\n    boundaryRect.width - boundedRect.left\r\n  );\r\n\r\n  // restrict to bottom edge of boundary\r\n  boundedRect.height = Math.min(\r\n    boundedRect.height,\r\n    boundaryRect.height - boundedRect.top\r\n  );\r\n\r\n  return boundedRect;\r\n}\r\n","import {RefObject, useLayoutEffect, useRef} from 'react';\r\nimport {droppables} from '../drag-state';\r\nimport {InteractableRect} from '../../interactable-event';\r\nimport {DraggableId} from '../use-draggable';\r\n\r\nexport interface ConnectedMouseSelectable {\r\n  id: DraggableId;\r\n  onSelected?: () => void;\r\n  onDeselected?: () => void;\r\n  ref: RefObject<HTMLElement>;\r\n  rect?: InteractableRect;\r\n}\r\n\r\nexport const mouseSelectables = new Map<\r\n  DraggableId,\r\n  ConnectedMouseSelectable\r\n>();\r\n\r\nexport function useMouseSelectable(options: ConnectedMouseSelectable) {\r\n  const {id, ref} = options;\r\n  const optionsRef = useRef(options);\r\n  optionsRef.current = options;\r\n\r\n  useLayoutEffect(() => {\r\n    if (!ref.current) return;\r\n    // register droppable regardless if it's enabled or not, it might be used by mouse selection box\r\n    mouseSelectables.set(id, {\r\n      ...mouseSelectables.get(id),\r\n      id,\r\n      ref,\r\n      // avoid stale closures\r\n      onSelected: () => {\r\n        optionsRef.current.onSelected?.();\r\n      },\r\n      onDeselected: () => optionsRef.current.onDeselected?.(),\r\n    });\r\n    return () => {\r\n      droppables.delete(id);\r\n    };\r\n  }, [id, optionsRef, ref]);\r\n}\r\n","import {InteractableRect} from '../interactable-event';\r\n\r\nexport function rectsIntersect(\r\n  rectA?: InteractableRect,\r\n  rectB?: InteractableRect\r\n) {\r\n  if (!rectA || !rectB) return false;\r\n  return (\r\n    rectA.left <= rectB.left + rectB.width &&\r\n    rectA.left + rectA.width >= rectB.left &&\r\n    rectA.top <= rectB.top + rectB.height &&\r\n    rectA.top + rectA.height >= rectB.top\r\n  );\r\n}\r\n","import React, {RefObject, useRef} from 'react';\r\nimport {usePointerEvents} from '../../use-pointer-events';\r\nimport {InteractableRect} from '../../interactable-event';\r\nimport {restrictResizableWithinBoundary} from '../../utils/restrict-resizable-within-boundary';\r\nimport {activeInteraction} from '../../active-interaction';\r\nimport {updateRects} from '../update-rects';\r\nimport {mouseSelectables} from './use-mouse-selectable';\r\nimport {rectsIntersect} from '../../utils/rects-intersect';\r\nimport {DraggableId} from '../use-draggable';\r\n\r\ninterface SelectionState {\r\n  startPoint?: {x: number; y: number; scrollTop: number};\r\n  endPoint?: {x: number; y: number};\r\n  boundaryRect?: InteractableRect & {heightWithoutScroll: number};\r\n  scrollListener?: EventListener;\r\n  rafId?: number;\r\n  selectedIds?: Set<DraggableId>;\r\n}\r\n\r\ninterface Props {\r\n  onPointerDown?: (e: React.PointerEvent) => void;\r\n  containerRef?: RefObject<HTMLDivElement>;\r\n}\r\nexport function useMouseSelectionBox({onPointerDown, ...props}: Props = {}) {\r\n  const defaultRef = useRef<HTMLDivElement>(null);\r\n  const containerRef = props.containerRef || defaultRef;\r\n  const boxRef = useRef<HTMLDivElement>(null);\r\n\r\n  let state = useRef<SelectionState>({}).current;\r\n\r\n  const drawSelectionBox = () => {\r\n    if (state.rafId) {\r\n      cancelAnimationFrame(state.rafId);\r\n    }\r\n\r\n    if (!state.startPoint || !state.endPoint || !state.boundaryRect) return;\r\n\r\n    const startPoint = state.startPoint;\r\n    const endPoint = state.endPoint;\r\n    const initialScrollTop = startPoint.scrollTop || 0;\r\n    const currentScrollTop = containerRef.current?.scrollTop || 0;\r\n\r\n    const newRect = {\r\n      left: Math.min(startPoint.x, endPoint.x),\r\n      top: Math.min(startPoint.y, endPoint.y),\r\n      width: Math.abs(startPoint.x - endPoint.x),\r\n      height: Math.abs(startPoint.y - endPoint.y),\r\n    };\r\n\r\n    // convert box coords to be relative to container and not viewport\r\n    newRect.left -= state.boundaryRect.left;\r\n    newRect.top -= state.boundaryRect.top;\r\n\r\n    // take initial scroll of container into account\r\n    newRect.top += initialScrollTop;\r\n\r\n    // scroll diff between drag start and now (auto scroll or mouse wheel)\r\n    const scrollDiff = currentScrollTop - initialScrollTop;\r\n    const scrollValue = Math.abs(scrollDiff);\r\n\r\n    // top needs to be changed only if scroll direction is top\r\n    if (scrollDiff < 0) {\r\n      newRect.top -= scrollValue;\r\n    }\r\n\r\n    // height needs to be changed regardless of direction and method\r\n    newRect.height += scrollValue;\r\n\r\n    const boundedRect = state.boundaryRect\r\n      ? restrictResizableWithinBoundary(newRect, state.boundaryRect)\r\n      : {...newRect};\r\n\r\n    if (boxRef.current) {\r\n      state.rafId = requestAnimationFrame(() => {\r\n        if (boxRef.current) {\r\n          boxRef.current.style.display = `block`;\r\n          boxRef.current.style.transform = `translate(${boundedRect.left}px, ${boundedRect.top}px)`;\r\n          boxRef.current.style.width = `${boundedRect.width}px`;\r\n          boxRef.current.style.height = `${boundedRect.height}px`;\r\n        }\r\n        state.rafId = undefined;\r\n      });\r\n    }\r\n\r\n    // convert rect back to absolute for intersection testing\r\n    const absoluteRect = {\r\n      ...boundedRect,\r\n      left: boundedRect.left + state.boundaryRect.left,\r\n      top: boundedRect.top + state.boundaryRect.top - currentScrollTop,\r\n    };\r\n\r\n    for (const [, selectable] of mouseSelectables) {\r\n      const intersect = rectsIntersect(selectable.rect, absoluteRect);\r\n      if (intersect && !state.selectedIds?.has(selectable.id)) {\r\n        state.selectedIds?.add(selectable.id);\r\n        selectable.onSelected?.();\r\n      } else if (!intersect && state.selectedIds?.has(selectable.id)) {\r\n        state.selectedIds?.delete(selectable.id);\r\n        selectable.onDeselected?.();\r\n      }\r\n    }\r\n  };\r\n\r\n  const pointerEvents = usePointerEvents({\r\n    minimumMovement: 4,\r\n    onPointerDown,\r\n    onMoveStart: e => {\r\n      if (activeInteraction) {\r\n        return false;\r\n      }\r\n      updateRects(mouseSelectables);\r\n      state = {\r\n        selectedIds: new Set(),\r\n      };\r\n      const el = containerRef.current;\r\n      state.startPoint = {\r\n        x: e.clientX,\r\n        y: e.clientY,\r\n        scrollTop: el?.scrollTop || 0,\r\n      };\r\n\r\n      state.scrollListener = e => {\r\n        if (!state.startPoint) return;\r\n        // update rects on scroll, because we are using relative position\r\n        updateRects(mouseSelectables);\r\n        if (state.boundaryRect?.height) {\r\n          state.boundaryRect.height = (e.target as HTMLElement).scrollHeight;\r\n        }\r\n        // draw selection box (for autoscroll and mousewheel)\r\n        drawSelectionBox();\r\n      };\r\n\r\n      if (el) {\r\n        const rect = el.getBoundingClientRect();\r\n        el.addEventListener('scroll', state.scrollListener);\r\n        state.boundaryRect = {\r\n          top: rect.top,\r\n          left: rect.left,\r\n          height: el.scrollHeight,\r\n          heightWithoutScroll: rect.height,\r\n          width: el.scrollWidth,\r\n        };\r\n      }\r\n    },\r\n    onMove: e => {\r\n      state.endPoint = {x: e.clientX, y: e.clientY};\r\n\r\n      if (state.boundaryRect && containerRef.current) {\r\n        const reachedBottomEdge =\r\n          e.clientY + 20 >\r\n          state.boundaryRect.heightWithoutScroll + state.boundaryRect.top;\r\n        const reachedTopEdge = e.clientY - 20 < state.boundaryRect.top;\r\n\r\n        if (reachedBottomEdge) {\r\n          containerRef.current.scrollBy({top: 10});\r\n        } else if (reachedTopEdge) {\r\n          containerRef.current.scrollBy({top: -10});\r\n        }\r\n      }\r\n\r\n      drawSelectionBox();\r\n    },\r\n    onMoveEnd: () => {\r\n      if (state.rafId) {\r\n        cancelAnimationFrame(state.rafId);\r\n      }\r\n      if (containerRef.current && state.scrollListener) {\r\n        containerRef.current.removeEventListener(\r\n          'scroll',\r\n          state.scrollListener\r\n        );\r\n      }\r\n      if (boxRef.current) {\r\n        boxRef.current.style.display = `none`;\r\n        boxRef.current.style.transform = '';\r\n        boxRef.current.style.width = '';\r\n        boxRef.current.style.height = '';\r\n      }\r\n      state = {};\r\n    },\r\n  });\r\n\r\n  return {\r\n    containerProps: {\r\n      ...pointerEvents.domProps,\r\n      ref: containerRef,\r\n    },\r\n    boxProps: {ref: boxRef},\r\n  };\r\n}\r\n","import {DriveEntry} from '../drive-entry';\r\nimport {usePaginatedEntries} from './use-paginated-entries';\r\n\r\nexport function useEntries(): DriveEntry[] {\r\n  const query = usePaginatedEntries();\r\n  if (!query.data) return [];\r\n  return query.data.pages.flatMap(p => p.data);\r\n}\r\n","import {driveState, useDriveStore} from '../drive-store';\r\nimport {getAllEntries} from './queries/use-paginated-entries';\r\nimport {DriveEntry, DriveFolder} from './drive-entry';\r\nimport {useEntries} from './queries/use-entries';\r\nimport {useFolders} from './queries/use-folders';\r\n\r\nexport function useSelectedEntries(): DriveEntry[] {\r\n  const ids = useDriveStore(s => s.selectedEntries);\r\n  const entries = useEntries();\r\n  return Array.from(ids)\r\n    .map(id => entries.find(entry => entry.id === id))\r\n    .filter(e => !!e) as DriveEntry[];\r\n}\r\n\r\nexport function useSelectedEntry(): DriveEntry | null {\r\n  const entries = useSelectedEntries();\r\n  return entries[0];\r\n}\r\n\r\nexport function useSelectedEntryParent(): DriveFolder | null | undefined {\r\n  const entry = useSelectedEntry();\r\n  const {data} = useFolders();\r\n  if (!entry || !data?.folders) return;\r\n  return data.folders.find(e => e.id === entry.parent_id) as DriveFolder;\r\n}\r\n\r\nexport function getSelectedEntries(): DriveEntry[] {\r\n  const ids = Array.from(driveState().selectedEntries);\r\n  const allEntries = getAllEntries();\r\n  return ids\r\n    .map(id => allEntries.find(entry => entry.id === id))\r\n    .filter(e => !!e) as DriveEntry[];\r\n}\r\n","import React, {createElement} from 'react';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {EntryActionMenuTrigger} from './entry-action-menu-trigger';\r\nimport {MoreVertIcon} from '@common/icons/material/MoreVert';\r\nimport {Tooltip} from '@common/ui/tooltip/tooltip';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {useSelectedEntries} from '../files/use-selected-entries';\r\nimport {\r\n  useDeleteEntriesAction,\r\n  usePreviewAction,\r\n  useRemoveSharedEntriesAction,\r\n  useShareAction,\r\n} from './use-entry-actions';\r\nimport {DriveEntry} from '../files/drive-entry';\r\nimport {EntryAction} from './entry-action';\r\n\r\ninterface EntryActionListProps {\r\n  className?: string;\r\n}\r\nexport function EntryActionList({className}: EntryActionListProps) {\r\n  const selectedEntries = useSelectedEntries();\r\n\r\n  if (!selectedEntries.length) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className={className}>\r\n      <ActionList entries={selectedEntries} />\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface ActionListProps {\r\n  entries: DriveEntry[];\r\n}\r\nfunction ActionList({entries}: ActionListProps) {\r\n  const preview = usePreviewAction(entries);\r\n  const share = useShareAction(entries);\r\n  const deleteAction = useDeleteEntriesAction(entries);\r\n  const removeShared = useRemoveSharedEntriesAction(entries);\r\n\r\n  const actions = [preview, share, deleteAction, removeShared].filter(\r\n    action => !!action\r\n  ) as EntryAction[];\r\n\r\n  return (\r\n    <div className=\"entry-action-list\">\r\n      {actions.map(action => (\r\n        <Tooltip key={action.key} label={<Trans {...action.label} />}>\r\n          <IconButton\r\n            size=\"sm\"\r\n            onClick={() => {\r\n              action.execute();\r\n            }}\r\n          >\r\n            {createElement(action.icon)}\r\n          </IconButton>\r\n        </Tooltip>\r\n      ))}\r\n      <EntryActionMenuTrigger entries={entries}>\r\n        <Tooltip label={<Trans message=\"More actions\" />}>\r\n          <IconButton>\r\n            <MoreVertIcon />\r\n          </IconButton>\r\n        </Tooltip>\r\n      </EntryActionMenuTrigger>\r\n    </div>\r\n  );\r\n}\r\n","import {useSelectedEntries} from './use-selected-entries';\r\nimport {DriveEntry} from './drive-entry';\r\nimport {useEntryActions} from '../entry-actions/use-entry-actions';\r\nimport {driveState, useDriveStore} from '../drive-store';\r\nimport {ContextMenu} from '@common/ui/navigation/menu/context-menu';\r\nimport {MenuItem} from '@common/ui/navigation/menu/menu-trigger';\r\nimport React, {createElement} from 'react';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {EntryAction} from '../entry-actions/entry-action';\r\nimport {DrivePage, RootFolderPage} from '../drive-page/drive-page';\r\nimport {useDrivePageActions} from '../entry-actions/use-drive-page-actions';\r\n\r\nexport function DriveContextMenu() {\r\n  const selectedEntries = useSelectedEntries();\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  const data = useDriveStore(s => s.contextMenuData);\r\n  const entries = data?.entry ? [data.entry] : selectedEntries;\r\n\r\n  // right-clicked root folder\r\n  if (data?.entry?.id === 0) {\r\n    return <PageContextMenu position={data} page={RootFolderPage} />;\r\n  }\r\n\r\n  if (data && entries.length) {\r\n    return <EntriesContextMenu entries={entries} position={data} />;\r\n  }\r\n\r\n  if (data && activePage) {\r\n    return <PageContextMenu position={data} page={activePage} />;\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\ninterface EntriesContextMenuProps {\r\n  position: {x: number; y: number};\r\n  entries: DriveEntry[];\r\n}\r\nfunction EntriesContextMenu({entries, position}: EntriesContextMenuProps) {\r\n  const actions = useEntryActions(entries);\r\n  return <BaseContextMenu position={position} actions={actions} />;\r\n}\r\n\r\ninterface PageContextMenuProps {\r\n  position: {x: number; y: number};\r\n  page: DrivePage;\r\n}\r\nfunction PageContextMenu({page, position}: PageContextMenuProps) {\r\n  const actions = useDrivePageActions(page);\r\n  return <BaseContextMenu position={position} actions={actions} />;\r\n}\r\n\r\ninterface BaseContextMenuProps {\r\n  position: {x: number; y: number};\r\n  actions: EntryAction[];\r\n}\r\nfunction BaseContextMenu({position, actions}: BaseContextMenuProps) {\r\n  return (\r\n    <ContextMenu\r\n      position={position}\r\n      onOpenChange={isOpen => {\r\n        if (!isOpen) {\r\n          driveState().setContextMenuData(null);\r\n        }\r\n      }}\r\n    >\r\n      {actions.map(action => (\r\n        <MenuItem\r\n          value={action.key}\r\n          key={action.key}\r\n          onSelected={action.execute}\r\n          startIcon={createElement(action.icon)}\r\n        >\r\n          <Trans {...action.label} />\r\n        </MenuItem>\r\n      ))}\r\n    </ContextMenu>\r\n  );\r\n}\r\n","import {useMediaQuery} from './use-media-query';\r\n\r\nexport function useIsTouchDevice() {\r\n  return useMediaQuery('((pointer: coarse))');\r\n}\r\n","import {\r\n  ConnectedDraggable,\r\n  useDraggable,\r\n} from '@common/ui/interactions/dnd/use-draggable';\r\nimport {driveState, useDriveStore} from '../drive-store';\r\nimport {getSelectedEntries} from '../files/use-selected-entries';\r\nimport {useDroppable} from '@common/ui/interactions/dnd/use-droppable';\r\nimport {\r\n  folderAcceptsDrop,\r\n  useFolderDropAction,\r\n} from '../files/use-folder-drop-action';\r\nimport {DriveEntry} from '../files/drive-entry';\r\nimport {useRef, useState} from 'react';\r\nimport clsx from 'clsx';\r\nimport {useIsTouchDevice} from '@common/utils/hooks/is-touch-device';\r\nimport {FileEntry} from '@common/uploads/file-entry';\r\nimport {useMouseSelectable} from '@common/ui/interactions/dnd/mouse-selection/use-mouse-selectable';\r\nimport {TrashPage} from '@app/drive/drive-page/drive-page';\r\n\r\nexport function useFileViewDnd<T extends HTMLElement = HTMLElement>(\r\n  entry: DriveEntry\r\n) {\r\n  const isTouchDevice = useIsTouchDevice();\r\n  const ref = useRef<T>(null);\r\n  const {onDrop} = useFolderDropAction(entry);\r\n  const [isDragOver, setIsDragOver] = useState(false);\r\n  const isDragging = useDriveStore(s =>\r\n    s.entriesBeingDragged.includes(entry.id)\r\n  );\r\n  const activePage = useDriveStore(s => s.activePage);\r\n\r\n  const {draggableProps} = useDraggable({\r\n    disabled: !!isTouchDevice || activePage === TrashPage,\r\n    id: entry.id,\r\n    type: 'fileEntry',\r\n    ref,\r\n    hidePreview: true,\r\n    onDragStart: (e, target: ConnectedDraggable<FileEntry[]>) => {\r\n      if (!driveState().selectedEntries.has(entry.id)) {\r\n        driveState().selectEntries([entry.id]);\r\n      }\r\n      driveState().setEntriesBeingDragged(target.getData().map(e => e.id));\r\n    },\r\n    onDragEnd: () => {\r\n      driveState().setEntriesBeingDragged([]);\r\n    },\r\n    getData: () => getSelectedEntries(),\r\n  });\r\n\r\n  const {droppableProps} = useDroppable<T>({\r\n    id: entry.id,\r\n    disabled: isTouchDevice || entry.type !== 'folder',\r\n    ref,\r\n    types: ['fileEntry', 'nativeFile'],\r\n    acceptsDrop: target => folderAcceptsDrop(target, entry),\r\n    onDragEnter: () => setIsDragOver(true),\r\n    onDragLeave: () => setIsDragOver(false),\r\n    onDrop,\r\n  });\r\n\r\n  useMouseSelectable({\r\n    id: entry.id,\r\n    ref,\r\n    onSelected: () => {\r\n      driveState().selectEntries([entry.id], true);\r\n    },\r\n    onDeselected: () => {\r\n      driveState().deselectEntries([entry.id]);\r\n    },\r\n  });\r\n\r\n  const itemClassName = clsx(\r\n    isDragging && 'opacity-20',\r\n    isDragOver && 'ring ring-offset-4 ring-primary bg-primary-light/10 rounded'\r\n  );\r\n\r\n  return {\r\n    draggableProps,\r\n    droppableProps,\r\n    isDragOver,\r\n    isDragging,\r\n    itemClassName,\r\n    ref,\r\n  };\r\n}\r\n","import {DriveEntry} from '../../files/drive-entry';\r\nimport {RowElementProps} from '@common/ui/tables/table-row';\r\nimport {mergeProps} from '@react-aria/utils';\r\nimport {useFileViewDnd} from '../use-file-view-dnd';\r\nimport clsx from 'clsx';\r\nimport React, {useContext} from 'react';\r\nimport {driveState} from '../../drive-store';\r\nimport {TableContext} from '@common/ui/tables/table-context';\r\n\r\nexport function FileTableRow({\r\n  item,\r\n  children,\r\n  className,\r\n  ...domProps\r\n}: RowElementProps<DriveEntry>) {\r\n  const {isCollapsedMode} = useContext(TableContext);\r\n  const {draggableProps, droppableProps, itemClassName, ref} =\r\n    useFileViewDnd<HTMLDivElement>(item);\r\n\r\n  return (\r\n    <div\r\n      className={clsx(className, itemClassName)}\r\n      ref={ref}\r\n      {...mergeProps(draggableProps, droppableProps, domProps, {\r\n        onContextMenu: (e: React.MouseEvent) => {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          if (!isCollapsedMode) {\r\n            if (!driveState().selectedEntries.has(item.id)) {\r\n              driveState().selectEntries([item.id]);\r\n            }\r\n            driveState().setContextMenuData({x: e.clientX, y: e.clientY});\r\n          }\r\n        },\r\n      })}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n","import {useCallback} from 'react';\r\nimport {getPathForFolder, TrashPage} from '../drive-page/drive-page';\r\nimport {driveState} from '../drive-store';\r\nimport {DriveEntry} from '../files/drive-entry';\r\nimport {getSelectedEntries} from '../files/use-selected-entries';\r\nimport {useNavigate} from '@common/utils/hooks/use-navigate';\r\n\r\nexport function useViewItemActionHandler() {\r\n  const navigate = useNavigate();\r\n\r\n  const performViewItemAction = useCallback(\r\n    (entry: DriveEntry) => {\r\n      if (entry && entry.type === 'folder') {\r\n        if (driveState().activePage === TrashPage) {\r\n          driveState().setActiveActionDialog('trashFolderBlock', [entry]);\r\n        } else {\r\n          navigate(getPathForFolder(entry.hash));\r\n        }\r\n      } else {\r\n        const selectedEntries = getSelectedEntries();\r\n        driveState().setActiveActionDialog(\r\n          'preview',\r\n          selectedEntries.length ? selectedEntries : [entry]\r\n        );\r\n      }\r\n    },\r\n    [navigate]\r\n  );\r\n\r\n  return {performViewItemAction};\r\n}\r\n","import {DriveEntry} from '../../files/drive-entry';\r\nimport React, {useMemo} from 'react';\r\nimport {Table} from '@common/ui/tables/table';\r\nimport {\r\n  DriveSortDescriptor,\r\n  driveState,\r\n  useDriveStore,\r\n} from '../../drive-store';\r\nimport {FileTableRow} from './file-table-row';\r\nimport {useViewItemActionHandler} from '../use-view-item-action-handler';\r\nimport {fileTableColumns} from './file-table-columns';\r\n\r\ninterface Props {\r\n  entries: DriveEntry[];\r\n}\r\nexport function FileTable({entries}: Props) {\r\n  const {performViewItemAction} = useViewItemActionHandler();\r\n  const selectedEntries = useDriveStore(s => s.selectedEntries);\r\n  const sortDescriptor = useDriveStore(s => s.sortDescriptor);\r\n\r\n  const selectedRows = useMemo(() => {\r\n    return [...selectedEntries];\r\n  }, [selectedEntries]);\r\n\r\n  return (\r\n    <Table\r\n      columns={fileTableColumns}\r\n      data={entries}\r\n      sortDescriptor={sortDescriptor}\r\n      onSortChange={value => {\r\n        driveState().setSortDescriptor(value as DriveSortDescriptor);\r\n      }}\r\n      onAction={performViewItemAction}\r\n      selectedRows={selectedRows}\r\n      selectionStyle=\"highlight\"\r\n      renderRowAs={FileTableRow}\r\n      onSelectionChange={value => {\r\n        driveState().selectEntries(value as number[]);\r\n      }}\r\n    />\r\n  );\r\n}\r\n","import React, {useContext} from 'react';\r\nimport {DriveEntry} from '../../files/drive-entry';\r\nimport {driveState, useDriveStore} from '../../drive-store';\r\nimport {mergeProps} from '@react-aria/utils';\r\nimport {useFileViewDnd} from '../use-file-view-dnd';\r\nimport {useViewItemActionHandler} from '../use-view-item-action-handler';\r\nimport {usePointerEvents} from '@common/ui/interactions/use-pointer-events';\r\nimport {createEventHandler} from '@common/utils/dom/create-event-handler';\r\nimport {DashboardLayoutContext} from '@common/ui/layout/dashboard-layout-context';\r\nimport {BaseFileGridItem} from './base-file-grid-item';\r\nimport {EntryActionMenuTrigger} from '../../entry-actions/entry-action-menu-trigger';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {MoreVertIcon} from '@common/icons/material/MoreVert';\r\nimport {Checkbox} from '@common/ui/forms/toggle/checkbox';\r\nimport {isCtrlOrShiftPressed} from '@common/utils/keybinds/is-ctrl-or-shift-pressed';\r\n\r\ninterface FileGridItemProps {\r\n  entry: DriveEntry;\r\n}\r\nexport function FileGridItem({entry}: FileGridItemProps) {\r\n  const isSelected = useDriveStore(s => s.selectedEntries.has(entry.id));\r\n  const {performViewItemAction} = useViewItemActionHandler();\r\n  const {isMobileMode} = useContext(DashboardLayoutContext);\r\n\r\n  const {draggableProps, droppableProps, itemClassName, ref} =\r\n    useFileViewDnd<HTMLDivElement>(entry);\r\n\r\n  const toggleEntry = () => {\r\n    if (isSelected) {\r\n      driveState().deselectEntries([entry.id]);\r\n    } else {\r\n      driveState().selectEntries([entry.id], true);\r\n    }\r\n  };\r\n\r\n  const pressHandler = (e: PointerEvent, el: HTMLElement) => {\r\n    if (isMobileMode) {\r\n      if (driveState().selectedEntries.size) {\r\n        toggleEntry();\r\n      } else {\r\n        performViewItemAction(entry);\r\n      }\r\n    } else {\r\n      if (isCtrlOrShiftPressed(e)) {\r\n        toggleEntry();\r\n      } else {\r\n        driveState().selectEntries([entry.id]);\r\n      }\r\n    }\r\n  };\r\n\r\n  const {domProps: pressProps} = usePointerEvents({\r\n    onLongPress: isMobileMode ? () => toggleEntry() : undefined,\r\n    onPress: pressHandler,\r\n  });\r\n\r\n  const keyboardHandler: React.KeyboardEventHandler = e => {\r\n    if (e.key === 'Enter' || e.key === ' ') {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      performViewItemAction(entry);\r\n    }\r\n  };\r\n\r\n  const contextMenuHandler: React.MouseEventHandler = e => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (!isMobileMode) {\r\n      if (!driveState().selectedEntries.has(entry.id)) {\r\n        driveState().selectEntries([entry.id]);\r\n      }\r\n      driveState().setContextMenuData({x: e.clientX, y: e.clientY});\r\n    }\r\n  };\r\n\r\n  return (\r\n    <BaseFileGridItem\r\n      {...mergeProps(draggableProps, droppableProps, pressProps, {\r\n        onKeyDown: createEventHandler(keyboardHandler),\r\n      })}\r\n      ref={ref}\r\n      entry={entry}\r\n      isSelected={isSelected}\r\n      isMobileMode={!!isMobileMode}\r\n      tabIndex={-1}\r\n      onDoubleClick={e => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        if (!isMobileMode) {\r\n          performViewItemAction(entry);\r\n        }\r\n      }}\r\n      footerAdornment={\r\n        isMobileMode && (\r\n          <FooterAdornment entry={entry} isSelected={isSelected} />\r\n        )\r\n      }\r\n      onContextMenu={createEventHandler(contextMenuHandler)}\r\n      className={itemClassName}\r\n    />\r\n  );\r\n}\r\n\r\ninterface FooterProps {\r\n  entry: DriveEntry;\r\n  isSelected?: boolean;\r\n}\r\nfunction FooterAdornment({entry, isSelected}: FooterProps) {\r\n  const anySelected = useDriveStore(s => s.selectedEntries.size);\r\n\r\n  if (anySelected) {\r\n    return <Checkbox className=\"block mr-8\" checked={isSelected} />;\r\n  }\r\n\r\n  return (\r\n    <EntryActionMenuTrigger entries={[entry]}>\r\n      <IconButton\r\n        className=\"text-muted\"\r\n        onPointerDown={e => {\r\n          e.stopPropagation();\r\n        }}\r\n      >\r\n        <MoreVertIcon />\r\n      </IconButton>\r\n    </EntryActionMenuTrigger>\r\n  );\r\n}\r\n","import {FileGridItem} from './file-grid-item';\r\nimport React from 'react';\r\nimport {DriveEntry} from '../../files/drive-entry';\r\n\r\ninterface FileGridProps {\r\n  entries: DriveEntry[];\r\n}\r\nexport function FileGrid({entries}: FileGridProps) {\r\n  return (\r\n    <div className=\"file-grid-container\">\r\n      <div className=\"file-grid\">\r\n        {entries.map(entry => {\r\n          return <FileGridItem key={entry.id} entry={entry} />;\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import {driveState, useDriveStore} from '../../drive-store';\r\nimport {EntriesSortButton} from './entries-sort-button';\r\nimport React from 'react';\r\n\r\ninterface DriveSortButtonProps {\r\n  isDisabled?: boolean;\r\n}\r\nexport function DriveSortButton({isDisabled}: DriveSortButtonProps) {\r\n  const descriptor = useDriveStore(s => s.sortDescriptor);\r\n  return (\r\n    <EntriesSortButton\r\n      isDisabled={isDisabled}\r\n      descriptor={descriptor}\r\n      onChange={value => {\r\n        driveState().setSortDescriptor(value);\r\n      }}\r\n    />\r\n  );\r\n}\r\n","import React, {ReactNode, useContext} from 'react';\r\nimport {useDriveStore} from './drive-store';\r\nimport {\r\n  DrivePage,\r\n  makeFolderPage,\r\n  RootFolderPage,\r\n  SharesPage,\r\n  TrashPage,\r\n} from './drive-page/drive-page';\r\nimport {Breadcrumb} from '@common/ui/breadcrumbs/breadcrumb';\r\nimport {useAuth} from '@common/auth/use-auth';\r\nimport {useFolderPath} from './files/queries/use-folder-path';\r\nimport {EntryActionMenuTrigger} from './entry-actions/entry-action-menu-trigger';\r\nimport {useActiveWorkspace} from '@common/workspace/active-workspace-id-context';\r\nimport {ButtonBase} from '@common/ui/buttons/button-base';\r\nimport {BreadcrumbItem} from '@common/ui/breadcrumbs/breadcrumb-item';\r\nimport {ArrowDropDownIcon} from '@common/icons/material/ArrowDropDown';\r\nimport {MessageDescriptor} from '@common/i18n/message-descriptor';\r\nimport {MixedText} from '@common/i18n/mixed-text';\r\nimport {useNavigate} from '@common/utils/hooks/use-navigate';\r\nimport {DashboardLayoutContext} from '@common/ui/layout/dashboard-layout-context';\r\n\r\ninterface ItemConfig {\r\n  page: DrivePage;\r\n  label: MessageDescriptor | string;\r\n}\r\n\r\ninterface PageBreadcrumbsProps {\r\n  className?: string;\r\n}\r\nexport function PageBreadcrumbs({className}: PageBreadcrumbsProps) {\r\n  const {isMobileMode} = useContext(DashboardLayoutContext);\r\n  const navigate = useNavigate();\r\n  const page = useDriveStore(s => s.activePage);\r\n  const folder = page?.folder;\r\n  const query = useFolderPath({\r\n    hash: folder?.hash,\r\n    isEnabled: folder?.hash !== RootFolderPage.folder.hash,\r\n  });\r\n  const workspace = useActiveWorkspace();\r\n  const rootItem = useRootItem();\r\n  // wait until path, folder and workspace load fully\r\n  const isLoading =\r\n    !page ||\r\n    !workspace ||\r\n    (page.isFolderPage && !folder) ||\r\n    query.fetchStatus !== 'idle';\r\n\r\n  let content: ReactNode;\r\n\r\n  if (isLoading) {\r\n    content = null;\r\n  } else {\r\n    const items: ItemConfig[] = rootItem ? [rootItem] : [];\r\n\r\n    if (query.data) {\r\n      query.data.path.forEach(parent => {\r\n        items.push({\r\n          page: makeFolderPage(parent),\r\n          label: parent.name,\r\n        });\r\n      });\r\n    }\r\n\r\n    content = (\r\n      <Breadcrumb\r\n        className={className}\r\n        size={isMobileMode ? 'md' : 'lg'}\r\n        currentIsClickable\r\n      >\r\n        {items.map((item, index) => {\r\n          const isLast = index === items.length - 1;\r\n          if (!isLast) {\r\n            return (\r\n              <BreadcrumbItem\r\n                key={item.page.uniqueId}\r\n                onSelected={() => {\r\n                  navigate(item.page.path);\r\n                }}\r\n              >\r\n                <MixedText value={item.label} />\r\n              </BreadcrumbItem>\r\n            );\r\n          }\r\n\r\n          return (\r\n            <BreadcrumbItem key={item.page.uniqueId}>\r\n              {({isMenuItem}) => {\r\n                if (\r\n                  isMenuItem ||\r\n                  (!item.page.folder && item.page !== TrashPage)\r\n                )\r\n                  return <MixedText value={item.label} />;\r\n                return (\r\n                  <EntryActionMenuTrigger page={item.page}>\r\n                    <ButtonBase className=\"flex items-center gap-2 rounded focus-visible:ring-offset-4\">\r\n                      <MixedText value={item.label} />\r\n                      <ArrowDropDownIcon className=\"text-muted icon-md\" />\r\n                    </ButtonBase>\r\n                  </EntryActionMenuTrigger>\r\n                );\r\n              }}\r\n            </BreadcrumbItem>\r\n          );\r\n        })}\r\n      </Breadcrumb>\r\n    );\r\n  }\r\n\r\n  return content;\r\n}\r\n\r\nfunction useRootItem(): ItemConfig | null {\r\n  const page = useDriveStore(s => s.activePage);\r\n  const workspace = useActiveWorkspace();\r\n  const {user} = useAuth();\r\n\r\n  if (!page) return null;\r\n\r\n  // in workspace\r\n  if (workspace && !workspace.default) {\r\n    if (\r\n      page?.isFolderPage &&\r\n      (page?.name === RootFolderPage.name ||\r\n        page.folder?.workspace_id === workspace.id)\r\n    ) {\r\n      return {label: workspace.name, page: RootFolderPage};\r\n    }\r\n  }\r\n\r\n  if (page?.isFolderPage) {\r\n    const owner = page.folder?.users.find(u => u.owns_entry);\r\n    // inside shared folder\r\n    if (owner?.id !== user?.id) {\r\n      return {label: SharesPage.label, page: SharesPage};\r\n    }\r\n    // if folder is currently active, root item will always be root folder page\r\n    return {label: RootFolderPage.label, page: RootFolderPage};\r\n  }\r\n\r\n  // if folder page is not active, we are already at the root\r\n  return {label: page.label, page};\r\n}\r\n","import React, {ReactNode, useEffect, useRef, useState} from 'react';\r\nimport clsx from 'clsx';\r\nimport {UseInfiniteQueryResult} from '@tanstack/react-query/src/types';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {AnimatePresence, m} from 'framer-motion';\r\nimport {opacityAnimation} from '@common/ui/animation/opacity-animation';\r\nimport {ProgressCircle} from '@common/ui/progress/progress-circle';\r\n\r\nexport interface InfiniteScrollSentinelProps {\r\n  loaderMarginTop?: string;\r\n  children?: ReactNode;\r\n  loadMoreExtraContent?: ReactNode;\r\n  query: UseInfiniteQueryResult;\r\n  style?: React.CSSProperties;\r\n  className?: string;\r\n  variant?: 'infiniteScroll' | 'loadMore';\r\n  size?: 'sm' | 'md';\r\n}\r\nexport function InfiniteScrollSentinel({\r\n  query: {isInitialLoading, fetchNextPage, isFetchingNextPage, hasNextPage},\r\n  children,\r\n  loaderMarginTop = 'mt-24',\r\n  style,\r\n  className,\r\n  variant: _variant = 'infiniteScroll',\r\n  loadMoreExtraContent,\r\n  size = 'md',\r\n}: InfiniteScrollSentinelProps) {\r\n  const sentinelRef = useRef<HTMLDivElement>(null);\r\n  const isLoading = isFetchingNextPage || isInitialLoading;\r\n  const [loadMoreClickCount, setLoadMoreClickCount] = useState(0);\r\n  const innerVariant =\r\n    _variant === 'loadMore' && loadMoreClickCount < 3\r\n      ? 'loadMore'\r\n      : 'infiniteScroll';\r\n\r\n  useEffect(() => {\r\n    const sentinelEl = sentinelRef.current;\r\n    if (!sentinelEl || innerVariant === 'loadMore') return;\r\n    const observer = new IntersectionObserver(([entry]) => {\r\n      if (entry.isIntersecting && hasNextPage && !isLoading) {\r\n        fetchNextPage();\r\n      }\r\n    });\r\n    observer.observe(sentinelEl);\r\n    return () => {\r\n      observer.unobserve(sentinelEl);\r\n    };\r\n  }, [fetchNextPage, hasNextPage, isLoading, innerVariant]);\r\n\r\n  let content: ReactNode;\r\n\r\n  if (children) {\r\n    // children might already be wrapped in AnimatePresence, so only wrap default loader with it\r\n    content = isFetchingNextPage ? children : null;\r\n  } else if (innerVariant === 'loadMore') {\r\n    content = !isInitialLoading && hasNextPage && (\r\n      <div className={clsx('flex items-center gap-8', loaderMarginTop)}>\r\n        {loadMoreExtraContent}\r\n        <Button\r\n          size={size === 'md' ? 'sm' : 'xs'}\r\n          className={clsx(\r\n            size === 'sm' ? 'min-h-24 min-w-96' : 'min-h-36 min-w-112'\r\n          )}\r\n          variant=\"outline\"\r\n          color=\"primary\"\r\n          onClick={() => {\r\n            fetchNextPage();\r\n            setLoadMoreClickCount(loadMoreClickCount + 1);\r\n          }}\r\n          disabled={isLoading}\r\n        >\r\n          {loadMoreClickCount >= 2 && !isFetchingNextPage ? (\r\n            <Trans message=\"Load all\" />\r\n          ) : (\r\n            <Trans message=\"Show more\" />\r\n          )}\r\n        </Button>\r\n      </div>\r\n    );\r\n  } else {\r\n    content = (\r\n      <AnimatePresence>\r\n        {isFetchingNextPage && (\r\n          <m.div\r\n            className={clsx('flex justify-center w-full', loaderMarginTop)}\r\n            {...opacityAnimation}\r\n          >\r\n            <ProgressCircle size={size} isIndeterminate aria-label=\"loading\" />\r\n          </m.div>\r\n        )}\r\n      </AnimatePresence>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div\r\n      style={style}\r\n      className={clsx('w-full', className, hasNextPage && 'min-h-36')}\r\n      role=\"presentation\"\r\n    >\r\n      <div ref={sentinelRef} aria-hidden />\r\n      {content}\r\n    </div>\r\n  );\r\n}\r\n","import {AnimatePresence, m} from 'framer-motion';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport React from 'react';\r\nimport {opacityAnimation} from '@common/ui/animation/opacity-animation';\r\n\r\ninterface DropTargetMaskProps {\r\n  isVisible: boolean;\r\n}\r\nexport function DropTargetMask({isVisible}: DropTargetMaskProps) {\r\n  const mask = (\r\n    <m.div\r\n      key=\"dragTargetMask\"\r\n      {...opacityAnimation}\r\n      transition={{duration: 0.3}}\r\n      className=\"absolute inset-0 w-full min-h-full bg-primary-light/30 border-2 border-dashed border-primary pointer-events-none\"\r\n    >\r\n      <m.div\r\n        initial={{y: '100%', opacity: 0}}\r\n        animate={{y: '-10px', opacity: 1}}\r\n        exit={{y: '100%', opacity: 0}}\r\n        className=\"p-10 bg-primary text-on-primary fixed bottom-0 left-0 right-0 max-w-max mx-auto rounded\"\r\n      >\r\n        <Trans message=\"Drop files to upload them to this folder.\" />\r\n      </m.div>\r\n    </m.div>\r\n  );\r\n  return <AnimatePresence>{isVisible ? mask : null}</AnimatePresence>;\r\n}\r\n","import React, {\r\n  KeyboardEventHandler,\r\n  MouseEventHandler,\r\n  ReactNode,\r\n  useContext,\r\n  useRef,\r\n  useState,\r\n} from 'react';\r\nimport {usePaginatedEntries} from '../files/queries/use-paginated-entries';\r\nimport {driveState, useDriveStore} from '../drive-store';\r\nimport {IllustratedMessage} from '@common/ui/images/illustrated-message';\r\nimport {SvgImage} from '@common/ui/images/svg-image/svg-image';\r\nimport {SearchFilterList} from '../search/search-filter-list';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {useMouseSelectionBox} from '@common/ui/interactions/dnd/mouse-selection/use-mouse-selection-box';\r\nimport {useDroppable} from '@common/ui/interactions/dnd/use-droppable';\r\nimport {mergeProps} from '@react-aria/utils';\r\nimport {useDriveUploadQueue} from '../uploading/use-drive-upload-queue';\r\nimport {EntryActionList} from '../entry-actions/entry-action-list';\r\nimport {DriveContextMenu} from '../files/drive-context-menu';\r\nimport {FileTable} from './file-table/file-table';\r\nimport {FileGrid} from './file-grid/file-grid';\r\nimport {DriveSortButton} from '../layout/sorting/drive-sort-button';\r\nimport {DashboardLayoutContext} from '@common/ui/layout/dashboard-layout-context';\r\nimport {PageBreadcrumbs} from '../page-breadcrumbs';\r\nimport {InfiniteScrollSentinel} from '@common/ui/infinite-scroll/infinite-scroll-sentinel';\r\nimport {useEntries} from '../files/queries/use-entries';\r\nimport {AdHost} from '@common/admin/ads/ad-host';\r\nimport {DropTargetMask} from '../drop-target-mask';\r\nimport {useSearchParams} from 'react-router-dom';\r\nimport clsx from 'clsx';\r\nimport {MixedDraggable} from '@common/ui/interactions/dnd/use-draggable';\r\nimport {isCtrlKeyPressed} from '@common/utils/keybinds/is-ctrl-key-pressed';\r\nimport {useDeleteEntries} from '@app/drive/files/queries/use-delete-entries';\r\nimport {createEventHandler} from '@common/utils/dom/create-event-handler';\r\nimport {TrashPage} from '@app/drive/drive-page/drive-page';\r\nimport {getSelectedEntries} from '@app/drive/files/use-selected-entries';\r\n\r\ninterface FileViewProps {\r\n  className?: string;\r\n}\r\nexport function FileView({className}: FileViewProps) {\r\n  const [params] = useSearchParams();\r\n  const isSearchingOrFiltering =\r\n    !!params.get('query') || !!params.get('filters');\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const query = usePaginatedEntries();\r\n  const entries = useEntries();\r\n  const {uploadFiles} = useDriveUploadQueue();\r\n  const deleteEntries = useDeleteEntries();\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  const [isDragOver, setIsDragOver] = useState(false);\r\n  const viewMode = useDriveStore(s => s.viewMode);\r\n  const {isMobileMode} = useContext(DashboardLayoutContext);\r\n\r\n  const {containerProps, boxProps} = useMouseSelectionBox({\r\n    containerRef,\r\n    onPointerDown: e => {\r\n      if (!(e.target as HTMLElement).closest('.entry-action-list')) {\r\n        driveState().deselectEntries('all');\r\n      }\r\n    },\r\n  });\r\n\r\n  const {droppableProps} = useDroppable({\r\n    id: 'driveRoot',\r\n    ref: containerRef,\r\n    types: ['nativeFile'],\r\n    disabled: !activePage?.canUpload,\r\n    onDragEnter: () => {\r\n      setIsDragOver(true);\r\n    },\r\n    onDragLeave: () => {\r\n      setIsDragOver(false);\r\n    },\r\n    onDrop: async (draggable: MixedDraggable) => {\r\n      if (draggable.type === 'nativeFile') {\r\n        uploadFiles(await draggable.getData());\r\n      }\r\n    },\r\n  });\r\n\r\n  if (!activePage) return null;\r\n\r\n  let content: ReactNode;\r\n  if (!entries.length && (!query.isLoading || query.fetchStatus === 'idle')) {\r\n    const noContentMessage = activePage.noContentMessage(\r\n      isSearchingOrFiltering,\r\n    );\r\n    content = (\r\n      <IllustratedMessage\r\n        className=\"mt-40\"\r\n        image={<SvgImage src={noContentMessage.image} />}\r\n        title={<Trans {...noContentMessage.title} />}\r\n        description={<Trans {...noContentMessage.description} />}\r\n      />\r\n    );\r\n  } else if (!query.isLoading) {\r\n    content =\r\n      viewMode === 'list' ? (\r\n        <FileTable entries={entries} />\r\n      ) : (\r\n        <FileGrid entries={entries} />\r\n      );\r\n  }\r\n\r\n  const handleContextMenu: MouseEventHandler = e => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    driveState().deselectEntries('all');\r\n    driveState().setContextMenuData({x: e.clientX, y: e.clientY});\r\n  };\r\n\r\n  const handleKeybinds: KeyboardEventHandler = e => {\r\n    if (e.key === 'a' && isCtrlKeyPressed(e)) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      driveState().selectEntries(entries.map(entry => entry.id));\r\n    }\r\n    if (e.key === 'Delete') {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      if (driveState().selectedEntries.size && !deleteEntries.isPending) {\r\n        if (activePage === TrashPage) {\r\n          driveState().setActiveActionDialog(\r\n            'confirmAndDeleteForever',\r\n            getSelectedEntries(),\r\n          );\r\n        } else {\r\n          deleteEntries.mutate({\r\n            entryIds: [...driveState().selectedEntries],\r\n            deleteForever: activePage === TrashPage,\r\n          });\r\n          driveState().selectEntries([]);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={clsx('relative outline-none', className)}\r\n      tabIndex={-1}\r\n      {...mergeProps(containerProps, droppableProps, {\r\n        onKeyDown: createEventHandler(handleKeybinds),\r\n      })}\r\n      onContextMenu={handleContextMenu}\r\n    >\r\n      <div className=\"relative flex min-h-full flex-col pt-10\">\r\n        {isMobileMode ? (\r\n          <PageBreadcrumbs className=\"mb-10 px-14\" />\r\n        ) : (\r\n          <Toolbar />\r\n        )}\r\n        <SearchFilterList />\r\n        <div className=\"relative flex-auto px-18 pb-18 md:px-24\">\r\n          <AdHost slot=\"drive\" className=\"mb-24\" />\r\n          {content}\r\n          <InfiniteScrollSentinel query={query} />\r\n        </div>\r\n        <div\r\n          {...boxProps}\r\n          className=\"pointer-events-none absolute left-0 top-0 z-10 hidden border border-primary-light bg-primary-light/20 shadow-md\"\r\n        />\r\n        <DriveContextMenu />\r\n        <DropTargetMask isVisible={isDragOver} />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction Toolbar() {\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  return (\r\n    <div className=\"my-10 flex min-h-42 items-center justify-between gap-40 px-10 text-muted md:px-18\">\r\n      <DriveSortButton isDisabled={activePage?.disableSort} />\r\n      <EntryActionList className=\"text-muted\" />\r\n    </div>\r\n  );\r\n}\r\n","import {\r\n  ComponentPropsWithoutRef,\r\n  CSSProperties,\r\n  memo,\r\n  ReactElement,\r\n  useMemo,\r\n  useState,\r\n} from 'react';\r\nimport {AnimatePresence, m} from 'framer-motion';\r\nimport {FileTypeIcon} from '@common/uploads/file-type-icon/file-type-icon';\r\nimport {prettyBytes} from '@common/uploads/utils/pretty-bytes';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {CloseIcon} from '@common/icons/material/Close';\r\nimport {ProgressCircle} from '@common/ui/progress/progress-circle';\r\nimport {CheckCircleIcon} from '@common/icons/material/CheckCircle';\r\nimport {UploadedFile} from '@common/uploads/uploaded-file';\r\nimport {useFileUploadStore} from '@common/uploads/uploader/file-upload-provider';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {MixedText} from '@common/i18n/mixed-text';\r\nimport {Tooltip} from '@common/ui/tooltip/tooltip';\r\nimport {ErrorIcon} from '@common/icons/material/Error';\r\nimport {WarningIcon} from '@common/icons/material/Warning';\r\nimport {message} from '@common/i18n/message';\r\n\r\ninterface UploadQueueProps {\r\n  file: UploadedFile;\r\n  style: CSSProperties;\r\n}\r\nexport const UploadQueueItem = memo(({file, style}: UploadQueueProps) => {\r\n  return (\r\n    <div\r\n      className=\"p-10 flex items-center gap-14 w-full absolute top-0 left-0\"\r\n      style={style}\r\n    >\r\n      <div className=\"shrink-0 border rounded p-8\">\r\n        <FileTypeIcon className=\"w-22 h-22\" mime={file.mime} />\r\n      </div>\r\n      <div className=\"flex-auto min-w-0 pr-10\">\r\n        <div className=\"mb-2 flex items-center min-w-0 gap-10\">\r\n          <div className=\"flex-auto font-medium whitespace-nowrap min-w-0 overflow-hidden overflow-ellipsis\">\r\n            {file.name}\r\n          </div>\r\n        </div>\r\n        <SizeInfo file={file} />\r\n      </div>\r\n      <div className=\"mr-10\">\r\n        <FileStatus file={file} />\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\ninterface SizeInfoProps {\r\n  file: UploadedFile;\r\n}\r\nfunction SizeInfo({file}: SizeInfoProps) {\r\n  const fileUpload = useFileUploadStore(s => s.fileUploads.get(file.id));\r\n  const bytesUploaded = fileUpload?.bytesUploaded || 0;\r\n\r\n  const totalBytes = useMemo(() => prettyBytes(file.size), [file]);\r\n  const uploadedBytes = useMemo(\r\n    () => prettyBytes(bytesUploaded),\r\n    [bytesUploaded]\r\n  );\r\n\r\n  let statusMessage: ReactElement;\r\n  if (fileUpload?.status === 'completed') {\r\n    statusMessage = <Trans message=\"Upload complete\" />;\r\n  } else if (fileUpload?.status === 'aborted') {\r\n    statusMessage = <Trans message=\"Upload cancelled\" />;\r\n  } else if (fileUpload?.status === 'failed') {\r\n    statusMessage = <Trans message=\"Upload failed\" />;\r\n  } else {\r\n    statusMessage = (\r\n      <Trans\r\n        message=\":bytesUploaded of :totalBytes\"\r\n        values={{\r\n          bytesUploaded: uploadedBytes,\r\n          totalBytes,\r\n        }}\r\n      />\r\n    );\r\n  }\r\n\r\n  return <div className=\"text-muted text-xs\">{statusMessage}</div>;\r\n}\r\n\r\ninterface FileStatusProps {\r\n  file: UploadedFile;\r\n}\r\nfunction FileStatus({file}: FileStatusProps) {\r\n  const fileUpload = useFileUploadStore(s => s.fileUploads.get(file.id));\r\n  const abortUpload = useFileUploadStore(s => s.abortUpload);\r\n  const percentage = fileUpload?.percentage || 0;\r\n  const status = fileUpload?.status;\r\n  const errorMessage = fileUpload?.errorMessage;\r\n  const [isHovered, setIsHovered] = useState(false);\r\n\r\n  const abortButton = (\r\n    <IconButton\r\n      size=\"sm\"\r\n      onClick={() => {\r\n        abortUpload(file.id);\r\n      }}\r\n    >\r\n      <CloseIcon />\r\n    </IconButton>\r\n  );\r\n\r\n  const progressButton = (\r\n    <ProgressCircle aria-label=\"Upload progress\" size=\"sm\" value={percentage} />\r\n  );\r\n\r\n  let statusButton: ReactElement;\r\n  if (status === 'failed') {\r\n    const errMessage =\r\n      errorMessage || message('This file could not be uploaded');\r\n    statusButton = (\r\n      <AnimatedStatus>\r\n        <Tooltip variant=\"danger\" label={<MixedText value={errMessage} />}>\r\n          <ErrorIcon className=\"text-danger\" size=\"md\" />\r\n        </Tooltip>\r\n      </AnimatedStatus>\r\n    );\r\n  } else if (status === 'aborted') {\r\n    statusButton = (\r\n      <AnimatedStatus>\r\n        <WarningIcon className=\"text-warning\" size=\"md\" />\r\n      </AnimatedStatus>\r\n    );\r\n  } else if (status === 'completed') {\r\n    statusButton = (\r\n      <AnimatedStatus>\r\n        <CheckCircleIcon size=\"md\" className=\"text-positive\" />\r\n      </AnimatedStatus>\r\n    );\r\n  } else {\r\n    statusButton = (\r\n      <AnimatedStatus\r\n        onPointerEnter={e => {\r\n          if (e.pointerType === 'mouse') {\r\n            setIsHovered(true);\r\n          }\r\n        }}\r\n        onPointerLeave={e => {\r\n          if (e.pointerType === 'mouse') {\r\n            setIsHovered(false);\r\n          }\r\n        }}\r\n      >\r\n        {isHovered ? abortButton : progressButton}\r\n      </AnimatedStatus>\r\n    );\r\n  }\r\n\r\n  return <AnimatePresence>{statusButton}</AnimatePresence>;\r\n}\r\n\r\ninterface AnimatedStatusProps\r\n  extends Omit<\r\n    ComponentPropsWithoutRef<'div'>,\r\n    'onAnimationStart' | 'onDragStart' | 'onDragEnd' | 'onDrag'\r\n  > {\r\n  children: ReactElement;\r\n}\r\nfunction AnimatedStatus({children, ...domProps}: AnimatedStatusProps) {\r\n  return (\r\n    <m.div\r\n      {...domProps}\r\n      initial={{scale: 0, opacity: 0}}\r\n      animate={{scale: 1, opacity: 1}}\r\n      exit={{scale: 0, opacity: 0}}\r\n    >\r\n      {children}\r\n    </m.div>\r\n  );\r\n}\r\n","import {ReactElement, useRef} from 'react';\r\nimport {AnimatePresence, m} from 'framer-motion';\r\nimport {driveState, useDriveStore} from '../drive-store';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {CloseIcon} from '@common/icons/material/Close';\r\nimport {useFileUploadStore} from '@common/uploads/uploader/file-upload-provider';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {UploadQueueItem} from './upload-queue-item';\r\nimport {useVirtualizer} from '@tanstack/react-virtual';\r\n\r\nexport function UploadQueue() {\r\n  const isOpen = useDriveStore(s => s.uploadQueueIsOpen);\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      {isOpen && (\r\n        <m.div\r\n          key=\"upload-queue\"\r\n          className=\"shadow-xl rounded fixed bottom-16 right-16 bg z-modal border w-375 text-sm\"\r\n          initial={{y: '100%', opacity: 0}}\r\n          animate={{y: 0, opacity: 1}}\r\n          exit={{y: '100%', opacity: 0}}\r\n        >\r\n          <Header />\r\n          <UploadList />\r\n        </m.div>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n}\r\n\r\nexport function Header() {\r\n  const inProgressUploadsCount = useFileUploadStore(s => s.activeUploadsCount);\r\n  const completedUploadsCount = useFileUploadStore(\r\n    s => s.completedUploadsCount\r\n  );\r\n  const clearInactive = useFileUploadStore(s => s.clearInactive);\r\n\r\n  let message: ReactElement;\r\n  if (inProgressUploadsCount) {\r\n    message = (\r\n      <Trans\r\n        message=\"Uploading :count files\"\r\n        values={{count: inProgressUploadsCount}}\r\n      />\r\n    );\r\n  } else if (completedUploadsCount) {\r\n    message = (\r\n      <Trans\r\n        message=\"Uploaded :count files\"\r\n        values={{count: completedUploadsCount}}\r\n      />\r\n    );\r\n  } else {\r\n    message = <Trans message=\"No active uploads\" />;\r\n  }\r\n\r\n  // only allow closing upload queue if there are no active uploads\r\n  return (\r\n    <div className=\"px-10 py-4 bg-alt flex items-center gap-10 justify-between border-b min-h-[45px]\">\r\n      {message}\r\n      {inProgressUploadsCount === 0 ? (\r\n        <IconButton\r\n          size=\"sm\"\r\n          onClick={() => {\r\n            driveState().setUploadQueueIsOpen(false);\r\n            // wait for upload queue panel animation to complete, then clear inactive uploads\r\n            setTimeout(() => {\r\n              clearInactive();\r\n            }, 200);\r\n          }}\r\n        >\r\n          <CloseIcon />\r\n        </IconButton>\r\n      ) : undefined}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction UploadList() {\r\n  const uploads = useFileUploadStore(s => s.fileUploads);\r\n  const uploadsArray = [...uploads.values()];\r\n  const ref = useRef<HTMLDivElement>(null);\r\n  const virtualizer = useVirtualizer({\r\n    count: uploads.size,\r\n    getScrollElement: () => ref.current,\r\n    estimateSize: () => 60,\r\n    overscan: 4,\r\n  });\r\n\r\n  return (\r\n    <div className=\"max-h-320 overflow-y-auto\" ref={ref}>\r\n      <div\r\n        className=\"relative w-full\"\r\n        style={{\r\n          height: `${virtualizer.getTotalSize()}px`,\r\n        }}\r\n      >\r\n        {virtualizer.getVirtualItems().map(virtualItem => {\r\n          const upload = uploadsArray[virtualItem.index];\r\n          return (\r\n            <UploadQueueItem\r\n              style={{\r\n                height: `${virtualItem.size}px`,\r\n                transform: `translateY(${virtualItem.start}px)`,\r\n              }}\r\n              key={upload.file.id}\r\n              file={upload.file}\r\n            />\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","export default \"__VITE_ASSET__6b065fb0__\"","import React, {ReactNode, useContext} from 'react';\r\nimport {DashboardLayoutContext} from '@common/ui/layout/dashboard-layout-context';\r\nimport {FileTypeIcon} from '@common/uploads/file-type-icon/file-type-icon';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {CloseIcon} from '@common/icons/material/Close';\r\n\r\ninterface HeaderProps {\r\n  entryType: string;\r\n  entryName: ReactNode;\r\n}\r\nexport function DetailsSidebarHeader({entryType, entryName}: HeaderProps) {\r\n  const {setRightSidenavStatus} = useContext(DashboardLayoutContext);\r\n  return (\r\n    <div className=\"flex items-center gap-16 text-text-main mb-38\">\r\n      <FileTypeIcon className=\"w-24 h-24\" type={entryType} />\r\n      <div className=\"text-xl font-normal text-ellipsis flex-auto mr-auto min-w-0 break-words\">\r\n        {entryName}\r\n      </div>\r\n      <IconButton\r\n        size=\"md\"\r\n        className=\"flex-shrink-0\"\r\n        onClick={() => {\r\n          setRightSidenavStatus('closed');\r\n        }}\r\n      >\r\n        <CloseIcon />\r\n      </IconButton>\r\n    </div>\r\n  );\r\n}\r\n","import React, {ReactNode} from 'react';\r\nimport clsx from 'clsx';\r\n\r\ninterface Props {\r\n  children: ReactNode;\r\n  margin?: string;\r\n}\r\nexport function DetailsSidebarSectionHeader({\r\n  children,\r\n  margin = 'mb-20',\r\n}: Props) {\r\n  return <div className={clsx('text-base text-main', margin)}>{children}</div>;\r\n}\r\n","import {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {useMutation} from '@tanstack/react-query';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\nimport {message} from '@common/i18n/message';\r\nimport {ChipValue} from '@common/ui/forms/input-field/chip-field/chip-field';\r\nimport {DriveEntry} from '@app/drive/files/drive-entry';\r\nimport {invalidateEntryQueries} from '@app/drive/drive-query-keys';\r\n\r\ninterface Response extends BackendResponse {\r\n  //\r\n}\r\n\r\ninterface Payload {\r\n  entry: DriveEntry;\r\n  tags: ChipValue[];\r\n}\r\n\r\nexport function useSyncEntryTags() {\r\n  return useMutation({\r\n    mutationFn: (props: Payload) => createComment(props),\r\n    onSuccess: () => {\r\n      invalidateEntryQueries();\r\n    },\r\n    onError: err => showHttpErrorToast(err, message('Failed to save tags.')),\r\n  });\r\n}\r\n\r\nfunction createComment({entry, tags}: Payload): Promise<Response> {\r\n  return apiClient\r\n    .post(`file-entries/${entry.id}/sync-tags`, {\r\n      tags: tags.map(tag => tag.name),\r\n    })\r\n    .then(r => r.data);\r\n}\r\n","import {keepPreviousData, useQuery} from '@tanstack/react-query';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {NormalizedModel} from '@common/datatable/filters/normalized-model';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\n\r\ninterface Response extends BackendResponse {\r\n  results: NormalizedModel[];\r\n}\r\n\r\nexport function useFileEntryTags(query?: string) {\r\n  return useQuery({\r\n    queryKey: ['file-entry-tags', query],\r\n    queryFn: () => fetchTags(query),\r\n    placeholderData: keepPreviousData,\r\n  });\r\n}\r\n\r\nasync function fetchTags(query?: string) {\r\n  return apiClient\r\n    .get<Response>('file-entry-tags', {params: {query}})\r\n    .then(r => r.data);\r\n}\r\n","import {DetailsSidebarSectionHeader} from '@app/drive/details-sidebar/details-sidebar-section-header';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {DriveEntry} from '@app/drive/files/drive-entry';\r\nimport {\r\n  ChipField,\r\n  ChipValue,\r\n} from '@common/ui/forms/input-field/chip-field/chip-field';\r\nimport React, {useState} from 'react';\r\nimport {Item} from '@common/ui/forms/listbox/item';\r\nimport {useTrans} from '@common/i18n/use-trans';\r\nimport {message} from '@common/i18n/message';\r\nimport {useSyncEntryTags} from '@app/drive/details-sidebar/requests/use-sync-entry-tags';\r\nimport {useFileEntryTags} from '@app/drive/details-sidebar/requests/use-file-entry-tags';\r\nimport {useNavigate} from '@common/utils/hooks/use-navigate';\r\n\r\ninterface Props {\r\n  entry: DriveEntry;\r\n}\r\nexport function DetailsSidebarTags({entry}: Props) {\r\n  // use key={entry.id} to force re-render tag chip field when entry changes\r\n  return (\r\n    <div className=\"mt-20 border-t pt-20\">\r\n      <DetailsSidebarSectionHeader margin=\"mb-10\">\r\n        <Trans message=\"Tags\" />\r\n      </DetailsSidebarSectionHeader>\r\n      <TagChipField entry={entry} key={entry.id} />\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction TagChipField({entry}: Props) {\r\n  const {trans} = useTrans();\r\n  const navigate = useNavigate();\r\n  const syncTags = useSyncEntryTags();\r\n  const [inputValue, setInputValue] = useState('');\r\n  const [value, setValue] = useState<ChipValue[]>(entry.tags || []);\r\n  const {data, isLoading} = useFileEntryTags(inputValue);\r\n\r\n  const handleChange = (newTags: ChipValue[]) => {\r\n    setValue(newTags);\r\n    if (!syncTags.isPending) {\r\n      syncTags.mutate({tags: newTags, entry});\r\n    }\r\n  };\r\n\r\n  return (\r\n    <ChipField\r\n      isAsync\r\n      inputValue={inputValue}\r\n      onInputValueChange={setInputValue}\r\n      suggestions={data?.results}\r\n      placeholder={trans(message('+Add tag'))}\r\n      isLoading={isLoading}\r\n      chipSize=\"sm\"\r\n      value={value}\r\n      onChange={handleChange}\r\n      onChipClick={chip => {\r\n        navigate(`/drive/search?query=${chip.name}`);\r\n      }}\r\n    >\r\n      {data?.results?.map(result => (\r\n        <Item value={result} key={result.id}>\r\n          {result.name}\r\n        </Item>\r\n      ))}\r\n    </ChipField>\r\n  );\r\n}\r\n","import {useSelectedEntryParent} from '@app/drive/files/use-selected-entries';\r\nimport {useNavigate} from '@common/utils/hooks/use-navigate';\r\nimport React, {ReactNode, useMemo} from 'react';\r\nimport {prettyBytes} from '@common/uploads/utils/pretty-bytes';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {FolderIcon} from '@common/icons/material/Folder';\r\nimport {\r\n  getPathForFolder,\r\n  RootFolderPage,\r\n} from '@app/drive/drive-page/drive-page';\r\nimport {FormattedDate} from '@common/i18n/formatted-date';\r\nimport {DriveEntry} from '@app/drive/files/drive-entry';\r\nimport {FileThumbnail} from '@common/uploads/file-type-icon/file-thumbnail';\r\nimport {GroupsIcon} from '@common/icons/material/Groups';\r\nimport {Tooltip} from '@common/ui/tooltip/tooltip';\r\nimport {Avatar} from '@common/ui/images/avatar';\r\nimport {driveState} from '@app/drive/drive-store';\r\nimport {DetailsSidebarHeader} from '@app/drive/details-sidebar/details-sidebar-header';\r\nimport {DetailsSidebarSectionHeader} from '@app/drive/details-sidebar/details-sidebar-section-header';\r\nimport {DetailsSidebarTags} from '@app/drive/details-sidebar/details-sidebar-tags';\r\n\r\ninterface EntryPropertiesProps {\r\n  entry: DriveEntry;\r\n}\r\nexport function DetailsSidebarProperties({entry}: EntryPropertiesProps) {\r\n  return (\r\n    <div>\r\n      <DetailsSidebarHeader entryType={entry.type} entryName={entry.name} />\r\n      {entry.type === 'image' && (\r\n        <FileThumbnail className=\"mb-20\" file={entry} />\r\n      )}\r\n      <div>\r\n        <DetailsSidebarSectionHeader>\r\n          <Trans message=\"Who has access\" />\r\n        </DetailsSidebarSectionHeader>\r\n        <div className=\"flex items-center gap-14\">\r\n          {entry.workspace_id ? (\r\n            <div className=\"rounded-full border w-32 h-32 flex items-center justify-center\">\r\n              <GroupsIcon className=\"icon-md\" />\r\n            </div>\r\n          ) : null}\r\n          {entry.users.map(user => (\r\n            <Tooltip label={user.display_name} key={user.id}>\r\n              <Avatar src={user.avatar} size=\"md\" circle />\r\n            </Tooltip>\r\n          ))}\r\n        </div>\r\n        {entry.permissions['files.update'] && (\r\n          <Button\r\n            className=\"block mt-20\"\r\n            variant=\"link\"\r\n            color=\"primary\"\r\n            onClick={() => {\r\n              driveState().setActiveActionDialog('share', [entry]);\r\n            }}\r\n          >\r\n            <Trans message=\"Manage Access\" />\r\n          </Button>\r\n        )}\r\n      </div>\r\n      <PropertyList entry={entry} />\r\n      <DetailsSidebarTags entry={entry} />\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface Props {\r\n  entry: DriveEntry;\r\n}\r\nfunction PropertyList({entry}: Props) {\r\n  const parent = useSelectedEntryParent();\r\n  const navigate = useNavigate();\r\n  const owner = entry.users.find(user => user.owns_entry);\r\n  const prettySize = useMemo(\r\n    () => prettyBytes(entry.file_size),\r\n    [entry.file_size]\r\n  );\r\n\r\n  return (\r\n    <div className=\"mt-20 border-t pt-20\">\r\n      <DetailsSidebarSectionHeader>\r\n        <Trans message=\"Properties\" />\r\n      </DetailsSidebarSectionHeader>\r\n      <PropertyItem\r\n        label={<Trans message=\"Type\" />}\r\n        value={\r\n          <span className=\"capitalize\">\r\n            <Trans message={entry.type} />\r\n          </span>\r\n        }\r\n      />\r\n      <PropertyItem\r\n        label={<Trans message=\"Size\" />}\r\n        value={entry.file_size ? prettySize : '-'}\r\n      />\r\n      <PropertyItem\r\n        label={<Trans message=\"Location\" />}\r\n        value={\r\n          <Button\r\n            variant=\"link\"\r\n            startIcon={<FolderIcon />}\r\n            onClick={() => {\r\n              navigate(\r\n                parent ? getPathForFolder(parent.hash) : RootFolderPage.path\r\n              );\r\n            }}\r\n          >\r\n            {parent ? parent.name : <Trans message=\"Root\" />}\r\n          </Button>\r\n        }\r\n      />\r\n      {owner && (\r\n        <PropertyItem\r\n          label={<Trans message=\"Owner\" />}\r\n          value={owner.display_name}\r\n        />\r\n      )}\r\n      <PropertyItem\r\n        label={<Trans message=\"Modified\" />}\r\n        value={<FormattedDate date={entry.updated_at} />}\r\n      />\r\n      <PropertyItem\r\n        label={<Trans message=\"Created\" />}\r\n        value={<FormattedDate date={entry.updated_at} />}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface PropertyItemProps {\r\n  label: ReactNode;\r\n  value: ReactNode;\r\n}\r\nfunction PropertyItem({label, value}: PropertyItemProps) {\r\n  return (\r\n    <div className=\"flex items-center mb-14\">\r\n      <div className=\"w-1/3 text-xs text-muted\">{label}</div>\r\n      <div className=\"w-2/3 text-sm text-main\">{value}</div>\r\n    </div>\r\n  );\r\n}\r\n","import React, {Fragment} from 'react';\r\nimport {useSelectedEntry} from '../files/use-selected-entries';\r\nimport {IllustratedMessage} from '@common/ui/images/illustrated-message';\r\nimport {SvgImage} from '@common/ui/images/svg-image/svg-image';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport detailedExamination from './detailed-examination.svg';\r\nimport clsx from 'clsx';\r\nimport {DetailsSidebarHeader} from '@app/drive/details-sidebar/details-sidebar-header';\r\nimport {DetailsSidebarProperties} from '@app/drive/details-sidebar/details-sidebar-properties';\r\n\r\ninterface DetailsSidebarProps {\r\n  className?: string;\r\n}\r\nexport function DetailsSidebar({className}: DetailsSidebarProps) {\r\n  const selectedEntry = useSelectedEntry();\r\n  return (\r\n    <div\r\n      className={clsx(\r\n        className,\r\n        'bg p-18 text-sm text-muted border-l h-full overflow-y-auto'\r\n      )}\r\n    >\r\n      {selectedEntry ? (\r\n        <DetailsSidebarProperties entry={selectedEntry} />\r\n      ) : (\r\n        <NothingSelected />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction NothingSelected() {\r\n  return (\r\n    <Fragment>\r\n      <DetailsSidebarHeader\r\n        entryType=\"folder\"\r\n        entryName={<Trans message=\"All files\" />}\r\n      />\r\n      <IllustratedMessage\r\n        image={<SvgImage src={detailedExamination} />}\r\n        description={\r\n          <Trans message=\"Select file or folder to see details here\" />\r\n        }\r\n      />\r\n    </Fragment>\r\n  );\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {UseFormReturn} from 'react-hook-form';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {message} from '@common/i18n/message';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {FileEntry} from '@common/uploads/file-entry';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {invalidateEntryQueries} from '../../drive-query-keys';\r\nimport {onFormQueryError} from '@common/errors/on-form-query-error';\r\n\r\ninterface Response extends BackendResponse {\r\n  fileEntry: FileEntry;\r\n}\r\n\r\ninterface Payload {\r\n  entryId: number;\r\n  name: string;\r\n  initialName: string;\r\n}\r\n\r\nexport function useRenameEntry(form: UseFormReturn<any>) {\r\n  return useMutation({\r\n    mutationFn: (payload: Payload) => renameEntry(payload),\r\n    onSuccess: (r, p) => {\r\n      invalidateEntryQueries();\r\n      toast(\r\n        message(':oldName renamed to :newName', {\r\n          values: {oldName: p.initialName, newName: r.fileEntry.name},\r\n        }),\r\n      );\r\n    },\r\n    onError: err => onFormQueryError(err, form),\r\n  });\r\n}\r\n\r\nfunction renameEntry({entryId, ...payload}: Payload): Promise<Response> {\r\n  return apiClient\r\n    .put(`file-entries/${entryId}`, payload)\r\n    .then(response => response.data);\r\n}\r\n","import React from 'react';\r\nimport {useForm} from 'react-hook-form';\r\nimport {useRenameEntry} from '../queries/use-rename-entry';\r\nimport {FormTextField} from '@common/ui/forms/input-field/text-field/text-field';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {Form} from '@common/ui/forms/form';\r\nimport {DialogFooter} from '@common/ui/overlays/dialog/dialog-footer';\r\nimport {useDialogContext} from '@common/ui/overlays/dialog/dialog-context';\r\nimport {Dialog} from '@common/ui/overlays/dialog/dialog';\r\nimport {DialogHeader} from '@common/ui/overlays/dialog/dialog-header';\r\nimport {DialogBody} from '@common/ui/overlays/dialog/dialog-body';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {DriveEntry} from '../drive-entry';\r\n\r\ninterface FormValue {\r\n  name?: string;\r\n}\r\n\r\ninterface RenameEntryDialogProps {\r\n  entries: DriveEntry[];\r\n}\r\nexport function RenameEntryDialog({entries}: RenameEntryDialogProps) {\r\n  const {close, formId} = useDialogContext();\r\n  const initialName = entries[0]?.name;\r\n  const form = useForm({defaultValues: {name: initialName}});\r\n  const renameEntry = useRenameEntry(form);\r\n\r\n  const onSubmit = (e: Required<FormValue>) => {\r\n    renameEntry.mutate(\r\n      {\r\n        entryId: entries[0].id,\r\n        name: e.name,\r\n        initialName,\r\n      },\r\n      {onSuccess: close},\r\n    );\r\n  };\r\n\r\n  return (\r\n    <Dialog>\r\n      <DialogHeader>\r\n        <Trans message=\"Rename\" />\r\n      </DialogHeader>\r\n      <DialogBody>\r\n        <Form onSubmit={onSubmit} form={form} id={formId}>\r\n          <FormTextField\r\n            placeholder=\"Enter a name...\"\r\n            aria-label=\"Entry name\"\r\n            autoFocus\r\n            name=\"name\"\r\n            required\r\n            minLength={3}\r\n            maxLength={200}\r\n          />\r\n        </Form>\r\n      </DialogBody>\r\n      <DialogFooter>\r\n        <Button variant=\"flat\" onClick={() => close()}>\r\n          <Trans message=\"Cancel\" />\r\n        </Button>\r\n        <Button\r\n          form={formId}\r\n          type=\"submit\"\r\n          variant=\"flat\"\r\n          color=\"primary\"\r\n          disabled={renameEntry.isPending || !form.formState.isDirty}\r\n        >\r\n          <Trans message=\"Save\" />\r\n        </Button>\r\n      </DialogFooter>\r\n    </Dialog>\r\n  );\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {UseFormReturn} from 'react-hook-form';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {onFormQueryError} from '@common/errors/on-form-query-error';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {DriveFolder} from '../drive-entry';\r\nimport {invalidateEntryQueries} from '../../drive-query-keys';\r\n\r\ninterface Response extends BackendResponse {\r\n  folder: DriveFolder;\r\n}\r\n\r\ninterface CreateFolderProps {\r\n  name: string;\r\n  parentId?: number | null;\r\n}\r\n\r\nfunction createFolder({name, parentId}: CreateFolderProps): Promise<Response> {\r\n  return apiClient\r\n    .post('folders', {\r\n      name,\r\n      parentId: parentId === 0 ? null : parentId,\r\n    })\r\n    .then(response => response.data);\r\n}\r\n\r\nexport function useCreateFolder(form: UseFormReturn<any>) {\r\n  return useMutation({\r\n    mutationFn: ({name, parentId}: CreateFolderProps) => {\r\n      return createFolder({name, parentId});\r\n    },\r\n    onSuccess: () => invalidateEntryQueries(),\r\n    onError: r => onFormQueryError(r, form),\r\n  });\r\n}\r\n","import React from 'react';\r\nimport {useForm} from 'react-hook-form';\r\nimport {FormTextField} from '@common/ui/forms/input-field/text-field/text-field';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {Form} from '@common/ui/forms/form';\r\nimport {useCreateFolder} from '../queries/create-folder';\r\nimport {DialogFooter} from '@common/ui/overlays/dialog/dialog-footer';\r\nimport {useDialogContext} from '@common/ui/overlays/dialog/dialog-context';\r\nimport {Dialog} from '@common/ui/overlays/dialog/dialog';\r\nimport {DialogHeader} from '@common/ui/overlays/dialog/dialog-header';\r\nimport {DialogBody} from '@common/ui/overlays/dialog/dialog-body';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {message} from '@common/i18n/message';\r\nimport {useTrans} from '@common/i18n/use-trans';\r\n\r\ninterface FormValue {\r\n  name?: string;\r\n}\r\n\r\ninterface NewFolderDialogProps {\r\n  parentId: number;\r\n}\r\nexport function NewFolderDialog({parentId}: NewFolderDialogProps) {\r\n  const {close, formId} = useDialogContext();\r\n  const {trans} = useTrans();\r\n  const form = useForm({\r\n    defaultValues: {\r\n      name: trans({message: 'Untitled Folder'}),\r\n    },\r\n  });\r\n  const createFolder = useCreateFolder(form);\r\n\r\n  const onSubmit = (value: Required<FormValue>) => {\r\n    createFolder.mutate(\r\n      {...value, parentId},\r\n      {\r\n        onSuccess: response => {\r\n          close(response.folder);\r\n          toast(message('Folder created'));\r\n        },\r\n      },\r\n    );\r\n  };\r\n\r\n  return (\r\n    <Dialog>\r\n      <DialogHeader>\r\n        <Trans message=\"New Folder\" />\r\n      </DialogHeader>\r\n      <DialogBody>\r\n        <Form onSubmit={onSubmit} form={form} id={formId}>\r\n          <FormTextField\r\n            placeholder={trans({\r\n              message: 'Enter a name...',\r\n            })}\r\n            aria-label=\"Entry name\"\r\n            autoFocus\r\n            autoSelectText\r\n            name=\"name\"\r\n            required\r\n            minLength={3}\r\n            maxLength={200}\r\n          />\r\n        </Form>\r\n      </DialogBody>\r\n      <DialogFooter>\r\n        <Button variant=\"flat\" onClick={() => close()}>\r\n          <Trans message=\"Cancel\" />\r\n        </Button>\r\n        <Button\r\n          form={formId}\r\n          type=\"submit\"\r\n          variant=\"flat\"\r\n          color=\"primary\"\r\n          disabled={createFolder.isPending}\r\n        >\r\n          <Trans message=\"Create\" />\r\n        </Button>\r\n      </DialogFooter>\r\n    </Dialog>\r\n  );\r\n}\r\n","import {FilePreviewDialog} from '@common/uploads/preview/file-preview-dialog';\r\nimport {DriveEntry} from '../drive-entry';\r\nimport {createElement, Fragment, useState} from 'react';\r\nimport {useShareAction} from '../../entry-actions/use-entry-actions';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {useEntries} from '../queries/use-entries';\r\n\r\ninterface EntryPreviewDialogProps {\r\n  selectedEntry: DriveEntry;\r\n}\r\nexport function EntryPreviewDialog({selectedEntry}: EntryPreviewDialogProps) {\r\n  const files = useEntries().filter(entry => entry.type !== 'folder');\r\n  const defaultActiveIndex = files.findIndex(\r\n    file => file.id === selectedEntry?.id\r\n  );\r\n  const [activeIndex, setActiveIndex] = useState(defaultActiveIndex);\r\n  return (\r\n    <FilePreviewDialog\r\n      allowDownload={selectedEntry.permissions['files.download']}\r\n      headerActionsLeft={\r\n        <DriveActions activeIndex={activeIndex} entries={files} />\r\n      }\r\n      activeIndex={activeIndex}\r\n      onActiveIndexChange={setActiveIndex}\r\n      entries={files}\r\n    />\r\n  );\r\n}\r\n\r\ninterface DriveActionsProps {\r\n  activeIndex: number;\r\n  entries: DriveEntry[];\r\n}\r\nfunction DriveActions({activeIndex, entries}: DriveActionsProps) {\r\n  const selectedEntry = entries[activeIndex];\r\n  const share = useShareAction([selectedEntry]);\r\n  if (!selectedEntry || !share) return null;\r\n\r\n  return (\r\n    <Fragment>\r\n      <IconButton\r\n        className=\"md:hidden\"\r\n        onClick={() => {\r\n          share.execute();\r\n        }}\r\n      >\r\n        {createElement(share.icon)}\r\n      </IconButton>\r\n      <Button\r\n        className=\"max-md:hidden\"\r\n        variant=\"text\"\r\n        startIcon={createElement(share.icon)}\r\n        onClick={() => {\r\n          share.execute();\r\n        }}\r\n      >\r\n        <Trans {...share.label} />\r\n      </Button>\r\n    </Fragment>\r\n  );\r\n}\r\n","import axios from 'axios';\r\nimport {useMutation} from '@tanstack/react-query';\r\nimport {DriveEntryPermissions} from '../../files/drive-entry';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {invalidateEntryQueries} from '../../drive-query-keys';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {BackendErrorResponse} from '@common/errors/backend-error-response';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\n\r\nexport interface ShareEntryPayload {\r\n  emails: string[];\r\n  permissions: DriveEntryPermissions;\r\n  entryId: number;\r\n}\r\n\r\nfunction shareEntry({\r\n  entryId,\r\n  ...payload\r\n}: ShareEntryPayload): Promise<BackendResponse> {\r\n  return apiClient\r\n    .post(`file-entries/${entryId}/share`, payload)\r\n    .then(response => response.data);\r\n}\r\n\r\nexport function useShareEntry() {\r\n  return useMutation({\r\n    mutationFn: (payload: ShareEntryPayload) => shareEntry(payload),\r\n    onSuccess: () => {\r\n      invalidateEntryQueries();\r\n    },\r\n    onError: err => {\r\n      if (axios.isAxiosError(err) && err.response) {\r\n        const response = err.response.data as BackendErrorResponse;\r\n        if (response.errors?.emails) {\r\n          toast.danger(response.errors?.emails[0]);\r\n        } else {\r\n          showHttpErrorToast(err);\r\n        }\r\n      }\r\n    },\r\n  });\r\n}\r\n","import {FileEntry} from '@common/uploads/file-entry';\r\n\r\nexport interface DriveEntry extends FileEntry {\r\n  users: DriveEntryUser[];\r\n  workspace_id?: number;\r\n  permissions: {\r\n    'files.create': boolean;\r\n    'files.update': boolean;\r\n    'files.delete': boolean;\r\n    'files.download': boolean;\r\n  };\r\n}\r\n\r\nexport interface DriveFolder extends DriveEntry {\r\n  type: 'folder';\r\n  model_type?: string;\r\n}\r\n\r\nexport interface DriveEntryUser {\r\n  id: number;\r\n  email: string;\r\n  display_name: string;\r\n  avatar?: string;\r\n  owns_entry: boolean;\r\n  entry_permissions: DriveEntryPermissions;\r\n}\r\n\r\nexport interface DriveEntryPermissions {\r\n  edit?: boolean;\r\n  view?: boolean;\r\n  download?: boolean;\r\n}\r\n\r\nexport const DRIVE_ENTRY_FULL_PERMISSIONS = {\r\n  edit: true,\r\n  view: true,\r\n  download: true,\r\n};\r\n","import {Button} from '@common/ui/buttons/button';\r\nimport {ArrowDropDownIcon} from '@common/icons/material/ArrowDropDown';\r\nimport {\r\n  DRIVE_ENTRY_FULL_PERMISSIONS,\r\n  DriveEntryPermissions,\r\n  DriveEntryUser,\r\n} from '../files/drive-entry';\r\nimport {\r\n  Menu,\r\n  MenuItem,\r\n  MenuTrigger,\r\n} from '@common/ui/navigation/menu/menu-trigger';\r\nimport {message} from '@common/i18n/message';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {MessageDescriptor} from '@common/i18n/message-descriptor';\r\n\r\nexport interface PermissionSelectorItem {\r\n  key: keyof DriveEntryPermissions;\r\n  value: DriveEntryPermissions;\r\n  label: MessageDescriptor;\r\n}\r\n\r\nexport const PermissionSelectorItems: PermissionSelectorItem[] = [\r\n  {\r\n    key: 'view',\r\n    value: {view: true},\r\n    label: message('Can view'),\r\n  },\r\n  {\r\n    key: 'download',\r\n    value: {view: true, download: true},\r\n    label: message('Can Download'),\r\n  },\r\n  {\r\n    key: 'edit',\r\n    value: DRIVE_ENTRY_FULL_PERMISSIONS,\r\n    label: message('Can edit'),\r\n  },\r\n];\r\n\r\ninterface Props {\r\n  onChange: (value: PermissionSelectorItem) => void;\r\n  value: PermissionSelectorItem;\r\n}\r\nexport function PermissionSelector({value, onChange}: Props) {\r\n  return (\r\n    <MenuTrigger\r\n      selectedValue={value.key}\r\n      selectionMode=\"single\"\r\n      onSelectionChange={key => {\r\n        if (key !== value.key) {\r\n          onChange(PermissionSelectorItems.find(p => p.key === key)!);\r\n        }\r\n      }}\r\n    >\r\n      <Button\r\n        variant=\"flat\"\r\n        color=\"chip\"\r\n        size=\"xs\"\r\n        endIcon={<ArrowDropDownIcon />}\r\n      >\r\n        <Trans {...value.label} />\r\n      </Button>\r\n      <Menu>\r\n        {PermissionSelectorItems.map(item => {\r\n          return (\r\n            <MenuItem key={item.key} value={item.key}>\r\n              <Trans {...item.label} />\r\n            </MenuItem>\r\n          );\r\n        })}\r\n      </Menu>\r\n    </MenuTrigger>\r\n  );\r\n}\r\n\r\nexport function getPermissionItemForUser(\r\n  user: DriveEntryUser\r\n): PermissionSelectorItem {\r\n  const {download, edit} = user.entry_permissions;\r\n  if (edit) {\r\n    return PermissionSelectorItems.find(item => item.key === 'edit')!;\r\n  }\r\n  if (download) {\r\n    return PermissionSelectorItems.find(item => item.key === 'download')!;\r\n  }\r\n  return PermissionSelectorItems.find(item => item.key === 'view')!;\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {DriveEntryPermissions} from '../../files/drive-entry';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {invalidateEntryQueries} from '../../drive-query-keys';\r\nimport {message} from '@common/i18n/message';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\n\r\nexport interface ChangePermissionsPayload {\r\n  userId: number;\r\n  permissions: DriveEntryPermissions;\r\n  entryId: number;\r\n}\r\n\r\nexport function useChangePermission() {\r\n  return useMutation({\r\n    mutationFn: (payload: ChangePermissionsPayload) =>\r\n      changePermission(payload),\r\n    onSuccess: () => {\r\n      invalidateEntryQueries();\r\n      toast(message('Updated user permissions'));\r\n    },\r\n    onError: err =>\r\n      showHttpErrorToast(err, message('Could not update permissions')),\r\n  });\r\n}\r\n\r\nfunction changePermission({\r\n  entryId,\r\n  ...payload\r\n}: ChangePermissionsPayload): Promise<BackendResponse> {\r\n  return apiClient\r\n    .put(`file-entries/${entryId}/change-permissions`, payload)\r\n    .then(response => response.data);\r\n}\r\n","import {Avatar, AvatarProps} from '@common/ui/images/avatar';\r\nimport {User} from '@common/auth/user';\r\nimport {useContext} from 'react';\r\nimport {SiteConfigContext} from '@common/core/settings/site-config-context';\r\n\r\ninterface UserAvatarProps extends Omit<AvatarProps, 'label' | 'src' | 'link'> {\r\n  user?: User;\r\n}\r\nexport function UserAvatar({user, ...props}: UserAvatarProps) {\r\n  const {auth} = useContext(SiteConfigContext);\r\n  return (\r\n    <Avatar\r\n      {...props}\r\n      label={user?.display_name}\r\n      src={user?.avatar}\r\n      link={user?.id && auth.getUserProfileLink?.(user)}\r\n    />\r\n  );\r\n}\r\n","import {useState} from 'react';\r\nimport {AnimatePresence, m} from 'framer-motion';\r\nimport clsx from 'clsx';\r\nimport {DriveEntry, DriveEntryUser} from '../files/drive-entry';\r\nimport {\r\n  getPermissionItemForUser,\r\n  PermissionSelector,\r\n  PermissionSelectorItem,\r\n} from './permission-selector';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {CloseIcon} from '@common/icons/material/Close';\r\nimport {useChangePermission} from './queries/use-change-permission';\r\nimport {useUnshareEntries} from './queries/use-unshare-entries';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {message} from '@common/i18n/message';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\nimport {UserAvatar} from '@common/ui/images/user-avatar';\r\n\r\ninterface MemberListProps {\r\n  className?: string;\r\n  entry: DriveEntry;\r\n}\r\n\r\nexport function MemberList({className, entry}: MemberListProps) {\r\n  if (!entry) return null;\r\n\r\n  const users = entry.users;\r\n\r\n  return (\r\n    <div className={clsx(className, 'overflow-hidden')}>\r\n      <div className=\"mb-14 text-sm\">\r\n        <Trans message=\"Who has access\" />\r\n      </div>\r\n      <AnimatePresence initial={false}>\r\n        {users.map(user => {\r\n          return <MemberListItem key={user.id} user={user} entry={entry} />;\r\n        })}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface MemberListItemProps {\r\n  user: DriveEntryUser;\r\n  entry: DriveEntry;\r\n}\r\nfunction MemberListItem({user, entry}: MemberListItemProps) {\r\n  return (\r\n    <m.div\r\n      initial={{x: '-100%', opacity: 0}}\r\n      animate={{x: 0, opacity: 1}}\r\n      exit={{x: '100%', opacity: 0}}\r\n      transition={{type: 'tween', duration: 0.125}}\r\n      className=\"flex items-center text-sm gap-14 mb-20\"\r\n      key={user.id}\r\n    >\r\n      <UserAvatar user={user as any} circle size=\"w-44 h-44\" />\r\n      <div>\r\n        <div>{user.display_name}</div>\r\n        <div className=\"text-muted\">{user.email}</div>\r\n      </div>\r\n      <div className=\"ml-auto\">\r\n        {user.owns_entry ? (\r\n          <span className=\"text-muted\">\r\n            <Trans message=\"Owner\" />\r\n          </span>\r\n        ) : (\r\n          <ActionButtons user={user} entry={entry} />\r\n        )}\r\n      </div>\r\n    </m.div>\r\n  );\r\n}\r\n\r\ninterface ActionButtonsProps {\r\n  user: DriveEntryUser;\r\n  entry: DriveEntry;\r\n}\r\nfunction ActionButtons({user, entry}: ActionButtonsProps) {\r\n  const changePermissions = useChangePermission();\r\n  const unshareEntry = useUnshareEntries();\r\n  const [activePermission, setActivePermission] =\r\n    useState<PermissionSelectorItem>(() => {\r\n      return getPermissionItemForUser(user);\r\n    });\r\n\r\n  return (\r\n    <div className=\"flex items-center gap-10\">\r\n      <PermissionSelector\r\n        onChange={item => {\r\n          changePermissions.mutate({\r\n            userId: user.id,\r\n            permissions: item.value,\r\n            entryId: entry.id,\r\n          });\r\n          setActivePermission(item);\r\n        }}\r\n        value={activePermission}\r\n      />\r\n      <IconButton\r\n        onClick={() => {\r\n          unshareEntry.mutate(\r\n            {userId: user.id, entryIds: [entry.id]},\r\n            {\r\n              onSuccess: () => {\r\n                toast(message('Member removed'));\r\n              },\r\n              onError: err =>\r\n                showHttpErrorToast(err, message('Could not remove member')),\r\n            }\r\n          );\r\n        }}\r\n      >\r\n        <CloseIcon />\r\n      </IconButton>\r\n    </div>\r\n  );\r\n}\r\n","import {useState} from 'react';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {useShareEntry} from './queries/use-share-entry';\r\nimport {\r\n  PermissionSelector,\r\n  PermissionSelectorItem,\r\n  PermissionSelectorItems,\r\n} from './permission-selector';\r\nimport {MemberList} from './member-list';\r\nimport {\r\n  ChipField,\r\n  ChipValue,\r\n} from '@common/ui/forms/input-field/chip-field/chip-field';\r\nimport {Avatar} from '@common/ui/images/avatar';\r\nimport {useTrans} from '@common/i18n/use-trans';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {DriveEntry} from '../files/drive-entry';\r\nimport {Item} from '@common/ui/forms/listbox/item';\r\nimport {isEmail} from '@common/utils/string/is-email';\r\nimport {useNormalizedModels} from '@common/users/queries/use-normalized-models';\r\nimport {useSettings} from '@common/core/settings/use-settings';\r\n\r\ninterface SharePanelProps {\r\n  className?: string;\r\n  entry: DriveEntry;\r\n}\r\nexport function SharePanel({className, entry}: SharePanelProps) {\r\n  const {trans} = useTrans();\r\n  const {share} = useSettings();\r\n  const shareEntry = useShareEntry();\r\n  const [chips, setChips] = useState<ChipValue[]>([]);\r\n  const [isSharing, setIsSharing] = useState(false);\r\n  const [selectedPermission, setSelectedPermission] =\r\n    useState<PermissionSelectorItem>(PermissionSelectorItems[0]);\r\n  const allEmailsValid = chips.every(chip => !chip.invalid);\r\n  const [inputValue, setInputValue] = useState('');\r\n  const query = useNormalizedModels(\r\n    'normalized-models/user',\r\n    {perPage: 7, query: inputValue},\r\n    {enabled: share.suggest_emails},\r\n  );\r\n\r\n  // show user's email, instead of name in the chip\r\n  const displayWith = (chip: ChipValue) => chip.description || chip.name;\r\n\r\n  return (\r\n    <div className={className}>\r\n      <ChipField\r\n        value={chips}\r\n        onChange={setChips}\r\n        isAsync\r\n        isLoading={query.fetchStatus === 'fetching'}\r\n        inputValue={inputValue}\r\n        onInputValueChange={setInputValue}\r\n        suggestions={query.data?.results}\r\n        displayWith={displayWith}\r\n        validateWith={chip => {\r\n          const invalid = !isEmail(chip.description);\r\n          return {\r\n            ...chip,\r\n            invalid,\r\n            errorMessage: invalid\r\n              ? trans({message: 'Not a valid email'})\r\n              : undefined,\r\n          };\r\n        }}\r\n        placeholder={trans({message: 'Enter email addresses'})}\r\n        label={<Trans message=\"Invite people\" />}\r\n      >\r\n        {user => (\r\n          <Item\r\n            value={user.id}\r\n            startIcon={<Avatar circle src={user.image} alt=\"\" />}\r\n            description={user.description}\r\n          >\r\n            {user.name}\r\n          </Item>\r\n        )}\r\n      </ChipField>\r\n      <div className=\"mt-14 flex items-center justify-between gap-14\">\r\n        <PermissionSelector\r\n          onChange={setSelectedPermission}\r\n          value={selectedPermission}\r\n        />\r\n        {chips.length ? (\r\n          <Button\r\n            variant=\"flat\"\r\n            color=\"primary\"\r\n            size=\"sm\"\r\n            disabled={isSharing || !allEmailsValid}\r\n            onClick={() => {\r\n              setIsSharing(true);\r\n              shareEntry.mutate(\r\n                {\r\n                  emails: chips.map(c => displayWith(c)),\r\n                  permissions: selectedPermission.value,\r\n                  entryId: entry.id,\r\n                },\r\n                {\r\n                  onSuccess: () => {\r\n                    setChips([]);\r\n                  },\r\n                  onSettled: () => {\r\n                    setIsSharing(false);\r\n                  },\r\n                },\r\n              );\r\n            }}\r\n          >\r\n            <Trans message=\"Share\" />\r\n          </Button>\r\n        ) : null}\r\n      </div>\r\n      <MemberList className=\"mt-30\" entry={entry} />\r\n    </div>\r\n  );\r\n}\r\n","import {useQuery} from '@tanstack/react-query';\r\nimport {ShareableLink} from '../shareable-link';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {DriveQueryKeys} from '../../drive-query-keys';\r\nimport {apiClient} from '@common/http/query-client';\r\n\r\nexport interface FetchShareableLinkResponse extends BackendResponse {\r\n  link: ShareableLink | null;\r\n}\r\n\r\nexport function useEntryShareableLink(entryId: number) {\r\n  return useQuery({\r\n    queryKey: DriveQueryKeys.fetchEntryShareableLink(entryId!),\r\n    queryFn: () => fetchLinkByEntryId(entryId!),\r\n    enabled: !!entryId,\r\n  });\r\n}\r\n\r\nfunction fetchLinkByEntryId(\r\n  entryId: number,\r\n): Promise<FetchShareableLinkResponse> {\r\n  return apiClient\r\n    .get(`file-entries/${entryId}/shareable-link`, {\r\n      params: {loader: 'shareableLink'},\r\n    })\r\n    .then(response => response.data);\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {apiClient, queryClient} from '@common/http/query-client';\r\nimport {FetchShareableLinkResponse} from './use-entry-shareable-link';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {DriveQueryKeys} from '../../drive-query-keys';\r\nimport {message} from '@common/i18n/message';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\n\r\ninterface DeleteLinkParams {\r\n  entryId: number;\r\n}\r\n\r\nfunction deleteShareableLink({\r\n  entryId,\r\n}: DeleteLinkParams): Promise<BackendResponse> {\r\n  return apiClient\r\n    .delete(`file-entries/${entryId}/shareable-link`)\r\n    .then(r => r.data);\r\n}\r\n\r\ninterface Payload {\r\n  entryId: number;\r\n}\r\nexport function useDeleteShareableLink() {\r\n  return useMutation({\r\n    mutationFn: ({entryId}: Payload) => deleteShareableLink({entryId}),\r\n    onSuccess: (response, {entryId}) => {\r\n      queryClient.setQueryData<FetchShareableLinkResponse>(\r\n        DriveQueryKeys.fetchEntryShareableLink(entryId),\r\n        {...response, link: null},\r\n      );\r\n    },\r\n    onError: err => showHttpErrorToast(err, message('Could not delete link')),\r\n  });\r\n}\r\n","export function randomString(length: number = 36) {\r\n  let random = '';\r\n  const possible =\r\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n\r\n  for (let i = 0; i < length; i += 1) {\r\n    random += possible.charAt(Math.floor(Math.random() * possible.length));\r\n  }\r\n\r\n  return random;\r\n}\r\n","import useClipboard from 'react-use-clipboard';\r\nimport {useEntryShareableLink} from '../../shareable-link/queries/use-entry-shareable-link';\r\nimport {useCreateShareableLink} from '../../shareable-link/queries/create-shareable-link';\r\nimport {useDeleteShareableLink} from '../../shareable-link/queries/use-delete-shareable-link';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {ShareableLink} from '../../shareable-link/shareable-link';\r\nimport {TextField} from '@common/ui/forms/input-field/text-field/text-field';\r\nimport type {ShareDialogActivePanel} from '../share-dialog';\r\nimport {Switch} from '@common/ui/forms/toggle/switch';\r\nimport {randomString} from '@common/utils/string/random-string';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {useTrans} from '@common/i18n/use-trans';\r\nimport {useActiveDialogEntry} from '../../drive-store';\r\nimport {DriveEntry} from '../../files/drive-entry';\r\nimport {useSettings} from '@common/core/settings/use-settings';\r\n\r\ninterface ShareableLinkPanelProps {\r\n  setActivePanel: (name: ShareDialogActivePanel) => void;\r\n  entry: DriveEntry;\r\n  focusInput?: boolean;\r\n}\r\nexport function ShareableLinkPanel({\r\n  setActivePanel,\r\n  entry,\r\n  focusInput,\r\n}: ShareableLinkPanelProps) {\r\n  const query = useEntryShareableLink(entry.id);\r\n  const linkExists = !!query.data?.link;\r\n  const createLink = useCreateShareableLink();\r\n  const deleteLink = useDeleteShareableLink();\r\n  const isLoading =\r\n    query.isLoading || createLink.isPending || deleteLink.isPending;\r\n  return (\r\n    <div>\r\n      <div className=\"mb-10\">\r\n        <Trans message=\"Share link\" />\r\n      </div>\r\n      <div className=\"flex items-center justify-between gap-14 px-2 pb-4\">\r\n        <Switch\r\n          checked={linkExists}\r\n          disabled={isLoading}\r\n          onChange={() => {\r\n            if (linkExists) {\r\n              deleteLink.mutate({entryId: entry.id});\r\n            } else {\r\n              createLink.mutate({entryId: entry.id});\r\n            }\r\n          }}\r\n        >\r\n          {linkExists ? (\r\n            <Trans message=\"Shareable link is created\" />\r\n          ) : (\r\n            <Trans message=\"Create shareable link\" />\r\n          )}\r\n        </Switch>\r\n        {linkExists && (\r\n          <Button\r\n            variant=\"link\"\r\n            color=\"primary\"\r\n            onClick={() => {\r\n              setActivePanel('linkSettings');\r\n            }}\r\n          >\r\n            <Trans message=\"Link settings\" />\r\n          </Button>\r\n        )}\r\n      </div>\r\n      <ShareableLinkInput autoFocus={focusInput} link={query.data?.link} />\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface ShareableLinkInputProps {\r\n  link?: ShareableLink | null;\r\n  autoFocus?: boolean;\r\n}\r\nfunction ShareableLinkInput({link, autoFocus}: ShareableLinkInputProps) {\r\n  const {base_url} = useSettings();\r\n  const {trans} = useTrans();\r\n  const entry = useActiveDialogEntry();\r\n  const hash = link?.hash || entry?.hash || randomString();\r\n  const linkUrl = `${base_url}/drive/s/${hash}`;\r\n  const [isCopied, setCopied] = useClipboard(linkUrl, {\r\n    successDuration: 1000,\r\n  });\r\n  return (\r\n    <TextField\r\n      autoFocus={autoFocus}\r\n      disabled={!link}\r\n      className=\"mt-10\"\r\n      readOnly\r\n      value={linkUrl}\r\n      aria-label={trans({message: 'Shareable link'})}\r\n      onFocus={e => {\r\n        (e.target as HTMLInputElement).select();\r\n      }}\r\n      endAppend={\r\n        <Button\r\n          className=\"min-w-100\"\r\n          variant=\"flat\"\r\n          color=\"primary\"\r\n          onClick={setCopied}\r\n        >\r\n          {isCopied ? <Trans message=\"Copied!\" /> : <Trans message=\"Copy\" />}\r\n        </Button>\r\n      }\r\n    />\r\n  );\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {UseFormReturn} from 'react-hook-form';\r\nimport {apiClient, queryClient} from '@common/http/query-client';\r\nimport {FetchShareableLinkResponse} from './use-entry-shareable-link';\r\nimport {onFormQueryError} from '@common/errors/on-form-query-error';\r\nimport {DriveQueryKeys} from '../../drive-query-keys';\r\n\r\nexport interface UpdateShareableLinkPayload {\r\n  allowEdit: boolean;\r\n  allowDownload: boolean;\r\n  expiresAt: string;\r\n  password: string;\r\n  entryId: number;\r\n}\r\n\r\nfunction updateShareableLink({\r\n  entryId,\r\n  ...payload\r\n}: UpdateShareableLinkPayload): Promise<FetchShareableLinkResponse> {\r\n  return apiClient\r\n    .put(`file-entries/${entryId}/shareable-link`, payload)\r\n    .then(response => response.data);\r\n}\r\n\r\nexport function useUpdateShareableLink(\r\n  form: UseFormReturn<UpdateShareableLinkPayload>,\r\n) {\r\n  return useMutation({\r\n    mutationFn: (payload: UpdateShareableLinkPayload) =>\r\n      updateShareableLink(payload),\r\n    onSuccess: (data, {entryId}) => {\r\n      queryClient.setQueryData<FetchShareableLinkResponse>(\r\n        DriveQueryKeys.fetchEntryShareableLink(entryId),\r\n        data,\r\n      );\r\n    },\r\n    onError: r => onFormQueryError(r, form),\r\n  });\r\n}\r\n","import {useForm} from 'react-hook-form';\r\nimport {Fragment, ReactElement, useState} from 'react';\r\nimport clsx from 'clsx';\r\nimport {m} from 'framer-motion';\r\nimport {getLocalTimeZone, now} from '@internationalized/date';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {FormTextField} from '@common/ui/forms/input-field/text-field/text-field';\r\nimport {DialogFooter} from '@common/ui/overlays/dialog/dialog-footer';\r\nimport type {ShareDialogActivePanel} from '../share-dialog';\r\nimport {useEntryShareableLink} from '../../shareable-link/queries/use-entry-shareable-link';\r\nimport {Form} from '@common/ui/forms/form';\r\nimport {\r\n  UpdateShareableLinkPayload,\r\n  useUpdateShareableLink,\r\n} from '../../shareable-link/queries/use-update-shareable-link';\r\nimport {FormSwitch, Switch} from '@common/ui/forms/toggle/switch';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {useDialogContext} from '@common/ui/overlays/dialog/dialog-context';\r\nimport {DialogHeader} from '@common/ui/overlays/dialog/dialog-header';\r\nimport {DialogBody} from '@common/ui/overlays/dialog/dialog-body';\r\nimport {FormDatePicker} from '@common/ui/forms/input-field/date/date-picker/date-picker';\r\nimport {useTrans} from '@common/i18n/use-trans';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {message} from '@common/i18n/message';\r\nimport {FileEntry} from '@common/uploads/file-entry';\r\n\r\ninterface LinkSettingsDialogProps {\r\n  className?: string;\r\n  setActivePanel: (name: ShareDialogActivePanel) => void;\r\n  entry: FileEntry;\r\n}\r\nexport function LinkSettingsDialog({\r\n  className,\r\n  setActivePanel,\r\n  entry,\r\n}: LinkSettingsDialogProps) {\r\n  const {formId} = useDialogContext();\r\n  const {data} = useEntryShareableLink(entry.id);\r\n  const link = data?.link;\r\n  const form = useForm<UpdateShareableLinkPayload>({\r\n    defaultValues: {\r\n      allowDownload: link?.allow_download,\r\n      allowEdit: link?.allow_edit,\r\n      expiresAt: link?.expires_at,\r\n      entryId: entry.id,\r\n    },\r\n  });\r\n  const updateLink = useUpdateShareableLink(form);\r\n\r\n  return (\r\n    <Fragment>\r\n      <DialogHeader\r\n        onDismiss={() => {\r\n          setActivePanel('main');\r\n        }}\r\n      >\r\n        <Trans message=\"Shareable Link Settings\" />\r\n      </DialogHeader>\r\n      <DialogBody>\r\n        <m.div\r\n          key=\"link-settings-content\"\r\n          className=\"min-h-[335px]\"\r\n          animate={{opacity: 1, y: 0}}\r\n          initial={{opacity: 0, y: 20}}\r\n          exit={{opacity: 0, y: -20}}\r\n          transition={{duration: 0.1}}\r\n        >\r\n          <Form\r\n            id={formId}\r\n            className={className}\r\n            form={form}\r\n            onSubmit={value => {\r\n              updateLink.mutate(value, {\r\n                onSuccess: () => {\r\n                  setActivePanel('main');\r\n                  toast(message('Link settings saved'));\r\n                },\r\n              });\r\n            }}\r\n          >\r\n            <LinkExpirationOption showField={!!link?.expires_at} />\r\n            <LinkPasswordOption showField={!!link?.password} />\r\n            <LinkOption>\r\n              <Trans message=\"Allow download\" />\r\n              <FormSwitch name=\"allowDownload\">\r\n                <Trans message=\"Users with link can download this item\" />\r\n              </FormSwitch>\r\n            </LinkOption>\r\n            <LinkOption showBorder={false}>\r\n              <Trans message=\"Allow import\" />\r\n              <FormSwitch name=\"allowEdit\">\r\n                <Trans message=\"Users with link can import this item into their own drive\" />\r\n              </FormSwitch>\r\n            </LinkOption>\r\n          </Form>\r\n        </m.div>\r\n      </DialogBody>\r\n      <DialogFooter>\r\n        <Button\r\n          type=\"button\"\r\n          onClick={() => {\r\n            setActivePanel('main');\r\n          }}\r\n        >\r\n          <Trans message=\"Cancel\" />\r\n        </Button>\r\n        <Button\r\n          type=\"submit\"\r\n          form={formId}\r\n          variant=\"flat\"\r\n          color=\"primary\"\r\n          disabled={updateLink.isPending}\r\n        >\r\n          <Trans message=\"Save\" />\r\n        </Button>\r\n      </DialogFooter>\r\n    </Fragment>\r\n  );\r\n}\r\n\r\nconst minDate = now(getLocalTimeZone());\r\n\r\ninterface LinkExpirationOptionProps {\r\n  showField: boolean;\r\n}\r\nfunction LinkExpirationOption({\r\n  showField: showFieldDefault,\r\n}: LinkExpirationOptionProps) {\r\n  const {trans} = useTrans();\r\n  const [showField, setShowField] = useState(showFieldDefault);\r\n  return (\r\n    <LinkOption>\r\n      <Trans message=\"Link expiration\" />\r\n      <div>\r\n        <Switch\r\n          checked={showField}\r\n          onChange={e => {\r\n            setShowField(e.target.checked);\r\n          }}\r\n        >\r\n          <Trans message=\"Link is valid until\" />\r\n        </Switch>\r\n        {showField && (\r\n          <FormDatePicker\r\n            min={minDate}\r\n            name=\"expiresAt\"\r\n            granularity=\"minute\"\r\n            className=\"mt-20\"\r\n            aria-label={trans({\r\n              message: 'Link expiration date and time',\r\n            })}\r\n          />\r\n        )}\r\n      </div>\r\n    </LinkOption>\r\n  );\r\n}\r\n\r\ninterface LinkPasswordOptionProps {\r\n  showField: boolean;\r\n}\r\nfunction LinkPasswordOption({\r\n  showField: showFieldDefault,\r\n}: LinkPasswordOptionProps) {\r\n  const {trans} = useTrans();\r\n  const [showField, setShowField] = useState(showFieldDefault);\r\n  return (\r\n    <LinkOption>\r\n      <Trans message=\"Password protect\" />\r\n      <div>\r\n        <Switch\r\n          checked={showField}\r\n          onChange={e => {\r\n            setShowField(e.target.checked);\r\n          }}\r\n        >\r\n          <Trans message=\"Users will need to enter password in order to view this link\" />\r\n        </Switch>\r\n        {showField && (\r\n          <FormTextField\r\n            type=\"password\"\r\n            autoFocus\r\n            name=\"password\"\r\n            className=\"mt-20\"\r\n            aria-label={trans({message: 'Link password'})}\r\n            description={\r\n              <Trans message=\"Password will not be requested when viewing the link as file owner.\" />\r\n            }\r\n            placeholder={trans({\r\n              message: 'Enter new password...',\r\n            })}\r\n          />\r\n        )}\r\n      </div>\r\n    </LinkOption>\r\n  );\r\n}\r\n\r\ninterface LinkOptionProps {\r\n  children: [ReactElement, ReactElement];\r\n  showBorder?: boolean;\r\n}\r\nfunction LinkOption({children, showBorder = true}: LinkOptionProps) {\r\n  const [title, content] = children;\r\n  return (\r\n    <div className={clsx(showBorder && 'mb-20 border-b pb-20')}>\r\n      <div className=\"mb-8 text-sm font-medium\">{title}</div>\r\n      {content}\r\n    </div>\r\n  );\r\n}\r\n","import {Fragment, useState} from 'react';\r\nimport {AnimatePresence, m} from 'framer-motion';\r\nimport {SharePanel} from './share-panel';\r\nimport {ShareableLinkPanel} from './link-panel/shareable-link-panel';\r\nimport {LinkSettingsDialog} from './link-panel/link-settings-dialog';\r\nimport {Dialog} from '@common/ui/overlays/dialog/dialog';\r\nimport {DialogHeader} from '@common/ui/overlays/dialog/dialog-header';\r\nimport {DialogBody} from '@common/ui/overlays/dialog/dialog-body';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {DriveEntry} from '../files/drive-entry';\r\nimport {useQuery} from '@tanstack/react-query';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {DriveQueryKeys} from '../drive-query-keys';\r\n\r\nexport type ShareDialogActivePanel = 'main' | 'linkSettings';\r\n\r\ninterface ShareDialogProps {\r\n  entry: DriveEntry;\r\n  focusLinkInput?: boolean;\r\n}\r\nexport function ShareDialog({\r\n  entry: initialEntry,\r\n  focusLinkInput,\r\n}: ShareDialogProps) {\r\n  const {\r\n    data: {fileEntry},\r\n  } = useQuery({\r\n    queryKey: DriveQueryKeys.fetchFileEntry(initialEntry.id),\r\n    queryFn: () =>\r\n      apiClient\r\n        .get(`drive/file-entries/${initialEntry.id}/model`)\r\n        .then(response => response.data as {fileEntry: DriveEntry}),\r\n    initialData: {fileEntry: initialEntry},\r\n  });\r\n\r\n  const [activePanel, setActivePanel] =\r\n    useState<ShareDialogActivePanel>('main');\r\n\r\n  return (\r\n    <Dialog size=\"lg\">\r\n      <AnimatePresence initial={false} mode=\"wait\">\r\n        {activePanel === 'linkSettings' ? (\r\n          <LinkSettingsDialog\r\n            key=\"one\"\r\n            setActivePanel={setActivePanel}\r\n            entry={fileEntry}\r\n          />\r\n        ) : (\r\n          <MainDialog\r\n            key=\"two\"\r\n            setActivePanel={setActivePanel}\r\n            entry={fileEntry}\r\n            focusLinkInput={focusLinkInput}\r\n          />\r\n        )}\r\n      </AnimatePresence>\r\n    </Dialog>\r\n  );\r\n}\r\n\r\ninterface MainDialogProps {\r\n  setActivePanel: (name: ShareDialogActivePanel) => void;\r\n  entry: DriveEntry;\r\n  focusLinkInput?: boolean;\r\n}\r\nfunction MainDialog({setActivePanel, entry, focusLinkInput}: MainDialogProps) {\r\n  return (\r\n    <Fragment>\r\n      <DialogHeader>\r\n        <Trans message=\"Share :name\" values={{name: entry.name}} />\r\n      </DialogHeader>\r\n      <DialogBody className=\"relative\">\r\n        <m.div\r\n          key=\"share-content\"\r\n          animate={{opacity: 1, y: 0}}\r\n          initial={{opacity: 0, y: 20}}\r\n          exit={{opacity: 0, y: -20}}\r\n          transition={{duration: 0.1}}\r\n        >\r\n          <SharePanel className=\"mb-30 border-b pb-30\" entry={entry} />\r\n          <ShareableLinkPanel\r\n            setActivePanel={setActivePanel}\r\n            entry={entry}\r\n            focusInput={!!focusLinkInput}\r\n          />\r\n        </m.div>\r\n      </DialogBody>\r\n    </Fragment>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport {SearchIcon} from '@common/icons/material/Search';\r\nimport {ComboBox} from '@common/ui/forms/combobox/combobox';\r\nimport {Item} from '@common/ui/forms/listbox/item';\r\nimport {useTrans} from '@common/i18n/use-trans';\r\nimport {PartialFolder} from '../../utils/can-move-entries-into';\r\n\r\ninterface SearchComboBoxProps {\r\n  allFolders: PartialFolder[];\r\n  onFolderSelected: (folder: PartialFolder) => void;\r\n}\r\nexport function MoveEntriesDialogSearch({\r\n  allFolders,\r\n  onFolderSelected,\r\n}: SearchComboBoxProps) {\r\n  const {trans} = useTrans();\r\n  const searchLabel = trans({message: 'Search folders'});\r\n  return (\r\n    <ComboBox\r\n      size=\"sm\"\r\n      maxItems={10}\r\n      placeholder={searchLabel}\r\n      aria-label={searchLabel}\r\n      className=\"pt-20\"\r\n      endAdornmentIcon={<SearchIcon />}\r\n      items={allFolders}\r\n      clearInputOnItemSelection\r\n      onItemSelected={value => {\r\n        const folderId = parseInt(value as string);\r\n        const folder = allFolders.find(f => f.id === folderId);\r\n        if (folder) {\r\n          onFolderSelected(folder);\r\n        }\r\n      }}\r\n    >\r\n      {item => (\r\n        <Item key={item.id} value={item.id}>\r\n          {item.name}\r\n        </Item>\r\n      )}\r\n    </ComboBox>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {ArrowBackIcon} from '@common/icons/material/ArrowBack';\r\nimport {Breadcrumb} from '@common/ui/breadcrumbs/breadcrumb';\r\nimport {FolderIcon} from '@common/icons/material/Folder';\r\nimport {BreadcrumbItem} from '@common/ui/breadcrumbs/breadcrumb-item';\r\nimport {PartialFolder} from '../../utils/can-move-entries-into';\r\n\r\ninterface FolderBreadCrumbsProps {\r\n  selectedFolder: PartialFolder;\r\n  allFolders: PartialFolder[];\r\n  rootFolder: PartialFolder;\r\n  onFolderSelected: (folder: PartialFolder) => void;\r\n}\r\nexport function MoveEntriesDialogBreadcrumbs({\r\n  selectedFolder,\r\n  allFolders,\r\n  rootFolder,\r\n  onFolderSelected,\r\n}: FolderBreadCrumbsProps) {\r\n  const path: PartialFolder[] = selectedFolder.path\r\n    .split('/')\r\n    .map(part => {\r\n      const folderId = parseInt(part);\r\n      return allFolders.find(folder => folderId === folder.id);\r\n    })\r\n    .filter(f => !!f) as PartialFolder[];\r\n  const fullPath: PartialFolder[] = [rootFolder, ...path];\r\n\r\n  const previous = path[path.length - 2];\r\n\r\n  return (\r\n    <div className=\"flex items-center gap-6 border-b pb-10\">\r\n      <IconButton\r\n        className=\"flex-shrink-0\"\r\n        variant=\"outline\"\r\n        size=\"xs\"\r\n        disabled={!previous && !selectedFolder.id}\r\n        onClick={() => {\r\n          onFolderSelected(previous || rootFolder);\r\n        }}\r\n      >\r\n        <ArrowBackIcon />\r\n      </IconButton>\r\n      <Breadcrumb size=\"sm\" className=\"flex-auto\">\r\n        {fullPath.map(item => {\r\n          return (\r\n            <BreadcrumbItem\r\n              onSelected={() => {\r\n                onFolderSelected(item);\r\n              }}\r\n              key={item.id || 'root'}\r\n              className=\"flex items-center gap-8\"\r\n            >\r\n              {!item.id && <FolderIcon className=\"icon-sm\" />}\r\n              {item.name}\r\n            </BreadcrumbItem>\r\n          );\r\n        })}\r\n      </Breadcrumb>\r\n    </div>\r\n  );\r\n}\r\n","export default \"__VITE_ASSET__b64d6dd2__\"","import React, {useMemo} from 'react';\r\nimport {IllustratedMessage} from '@common/ui/images/illustrated-message';\r\nimport {SvgImage} from '@common/ui/images/svg-image/svg-image';\r\nimport {FileTypeIcon} from '@common/uploads/file-type-icon/file-type-icon';\r\nimport {ChevronRightIcon} from '@common/icons/material/ChevronRight';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {List, ListItem} from '@common/ui/list/list';\r\nimport myFilesSvg from './my-files.svg';\r\nimport {PartialFolder} from '../../utils/can-move-entries-into';\r\n\r\ninterface FolderListProps {\r\n  selectedFolder: PartialFolder;\r\n  allFolders: PartialFolder[];\r\n  onFolderSelected: (folder: PartialFolder) => void;\r\n}\r\n\r\nexport function MoveEntriesDialogFolderList(props: FolderListProps) {\r\n  const {onFolderSelected, selectedFolder, allFolders} = props;\r\n\r\n  const subFolders = useMemo(() => {\r\n    const parentId = selectedFolder.id || null;\r\n    return allFolders.filter(f => f.parent_id === parentId);\r\n  }, [selectedFolder.id, allFolders]);\r\n\r\n  if (!subFolders.length) {\r\n    return (\r\n      <IllustratedMessage\r\n        size=\"xs\"\r\n        className=\"pt-64 pb-20 min-h-288\"\r\n        image={<SvgImage src={myFilesSvg} />}\r\n        title={\r\n          <Trans\r\n            message={`There are no subfolders in \":folder\"`}\r\n            values={{folder: selectedFolder.name}}\r\n          />\r\n        }\r\n      />\r\n    );\r\n  }\r\n\r\n  return (\r\n    <List className=\"h-288 overflow-y-auto\">\r\n      {subFolders.map(folder => {\r\n        return (\r\n          <ListItem\r\n            className=\"border-b min-h-48\"\r\n            key={folder.id}\r\n            onSelected={() => {\r\n              onFolderSelected(folder);\r\n            }}\r\n            startIcon={<FileTypeIcon type=\"folder\" />}\r\n            endIcon={<ChevronRightIcon size=\"md\" />}\r\n          >\r\n            {folder.name}\r\n          </ListItem>\r\n        );\r\n      })}\r\n    </List>\r\n  );\r\n}\r\n","import React, {useState} from 'react';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {useFolders} from '../../queries/use-folders';\r\nimport {useMoveEntries} from '../../queries/use-move-entries';\r\nimport {NewFolderDialog} from '../new-folder-dialog';\r\nimport {CreateNewFolderIcon} from '@common/icons/material/CreateNewFolder';\r\nimport {MoveEntriesDialogSearch} from './move-entries-dialog-search';\r\nimport {MoveEntriesDialogBreadcrumbs} from './move-entries-dialog-breadcrumbs';\r\nimport {MoveEntriesDialogFolderList} from './move-entries-dialog-folder-list';\r\nimport {DialogTrigger} from '@common/ui/overlays/dialog/dialog-trigger';\r\nimport {DialogFooter} from '@common/ui/overlays/dialog/dialog-footer';\r\nimport {useDialogContext} from '@common/ui/overlays/dialog/dialog-context';\r\nimport {Dialog} from '@common/ui/overlays/dialog/dialog';\r\nimport {DialogHeader} from '@common/ui/overlays/dialog/dialog-header';\r\nimport {DialogBody} from '@common/ui/overlays/dialog/dialog-body';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {RootFolderPage} from '../../../drive-page/drive-page';\r\nimport {DriveEntry} from '../../drive-entry';\r\nimport {useDriveStore} from '../../../drive-store';\r\nimport {\r\n  canMoveEntriesInto,\r\n  PartialFolder,\r\n} from '../../utils/can-move-entries-into';\r\n\r\ninterface MoveEntriesDialogProps {\r\n  entries: DriveEntry[];\r\n}\r\nexport function MoveEntriesDialog({entries}: MoveEntriesDialogProps) {\r\n  const {data} = useFolders();\r\n  const allFolders = data?.folders || [];\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  const [selectedFolder, setSelectedFolder] = useState<PartialFolder>(\r\n    activePage?.folder || RootFolderPage.folder,\r\n  );\r\n\r\n  return (\r\n    <Dialog size=\"lg\">\r\n      <DialogHeader>\r\n        <Trans\r\n          message=\"Move [one :name|other :count items]\"\r\n          values={{\r\n            count: entries.length,\r\n            name: entries[0].name,\r\n          }}\r\n        />\r\n      </DialogHeader>\r\n      <DialogBody>\r\n        <div className=\"text-sm\">\r\n          <Trans message=\"Select a destination folder.\" />\r\n        </div>\r\n        <MoveEntriesDialogSearch\r\n          allFolders={allFolders}\r\n          onFolderSelected={setSelectedFolder}\r\n        />\r\n        <div className=\"mb-20 mt-40\">\r\n          <MoveEntriesDialogBreadcrumbs\r\n            selectedFolder={selectedFolder}\r\n            allFolders={allFolders}\r\n            rootFolder={RootFolderPage.folder}\r\n            onFolderSelected={setSelectedFolder}\r\n          />\r\n          <MoveEntriesDialogFolderList\r\n            selectedFolder={selectedFolder}\r\n            allFolders={allFolders}\r\n            onFolderSelected={setSelectedFolder}\r\n          />\r\n        </div>\r\n      </DialogBody>\r\n      <Footer\r\n        selectedFolder={selectedFolder}\r\n        setSelectedFolder={setSelectedFolder}\r\n        entries={entries}\r\n      />\r\n    </Dialog>\r\n  );\r\n}\r\n\r\ninterface FooterProps {\r\n  selectedFolder: PartialFolder;\r\n  setSelectedFolder: (folder: PartialFolder) => void;\r\n  entries: DriveEntry[];\r\n}\r\nfunction Footer({selectedFolder, setSelectedFolder, entries}: FooterProps) {\r\n  const {close} = useDialogContext();\r\n  const moveEntries = useMoveEntries();\r\n  return (\r\n    <DialogFooter\r\n      className=\"border-t\"\r\n      startAction={\r\n        <DialogTrigger\r\n          type=\"modal\"\r\n          onClose={folder => {\r\n            if (folder) {\r\n              setSelectedFolder(folder);\r\n            }\r\n          }}\r\n        >\r\n          <Button startIcon={<CreateNewFolderIcon />} variant=\"text\">\r\n            <Trans message=\"New Folder\" />\r\n          </Button>\r\n          <NewFolderDialog parentId={selectedFolder.id} />\r\n        </DialogTrigger>\r\n      }\r\n    >\r\n      <Button className=\"max-md:hidden\" variant=\"flat\" onClick={() => close()}>\r\n        <Trans message=\"Cancel\" />\r\n      </Button>\r\n      <Button\r\n        type=\"submit\"\r\n        variant=\"flat\"\r\n        color=\"primary\"\r\n        disabled={\r\n          !canMoveEntriesInto(entries, selectedFolder) || moveEntries.isPending\r\n        }\r\n        onClick={() => {\r\n          moveEntries.mutate(\r\n            {\r\n              destinationId: selectedFolder.id,\r\n              entryIds: entries.map(e => e.id),\r\n            },\r\n            {onSuccess: close},\r\n          );\r\n        }}\r\n      >\r\n        <Trans message=\"Move here\" />\r\n      </Button>\r\n    </DialogFooter>\r\n  );\r\n}\r\n","import {DriveEntry} from '../drive-entry';\r\nimport {ConfirmationDialog} from '@common/ui/overlays/dialog/confirmation-dialog';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {useDeleteEntries} from '../queries/use-delete-entries';\r\nimport {driveState} from '../../drive-store';\r\nimport {useDialogContext} from '@common/ui/overlays/dialog/dialog-context';\r\n\r\ninterface DeleteEntriesForeverDialogProps {\r\n  entries: DriveEntry[];\r\n}\r\nexport function DeleteEntriesForeverDialog({\r\n  entries,\r\n}: DeleteEntriesForeverDialogProps) {\r\n  const deleteEntries = useDeleteEntries();\r\n  const {close} = useDialogContext();\r\n\r\n  const message =\r\n    entries.length === 1 ? (\r\n      <Trans\r\n        message=\":name will be deleted forever and you won't be able to restore it.\"\r\n        values={{name: entries[0].name}}\r\n      />\r\n    ) : (\r\n      <Trans\r\n        message=\":count items will be deleted forever and you won't be able to restore them.\"\r\n        values={{count: entries.length}}\r\n      />\r\n    );\r\n\r\n  return (\r\n    <ConfirmationDialog\r\n      isDanger\r\n      title={<Trans message=\"Delete forever?\" />}\r\n      body={message}\r\n      confirm={<Trans message=\"Delete forever\" />}\r\n      isLoading={deleteEntries.isPending}\r\n      onConfirm={() => {\r\n        deleteEntries.mutate(\r\n          {\r\n            entryIds: entries.map(e => e.id),\r\n            deleteForever: true,\r\n          },\r\n          {\r\n            onSuccess: () => {\r\n              close();\r\n              driveState().selectEntries([]);\r\n            },\r\n          },\r\n        );\r\n      }}\r\n    />\r\n  );\r\n}\r\n","import {DriveEntry} from '../drive-entry';\r\nimport {ConfirmationDialog} from '@common/ui/overlays/dialog/confirmation-dialog';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {driveState} from '../../drive-store';\r\nimport {useRestoreEntries} from '../queries/use-restore-entries';\r\nimport {useDialogContext} from '@common/ui/overlays/dialog/dialog-context';\r\n\r\ninterface DeleteEntriesForeverDialogProps {\r\n  entries: DriveEntry[];\r\n}\r\nexport function BlockTrashFolderViewDialog({\r\n  entries,\r\n}: DeleteEntriesForeverDialogProps) {\r\n  const restoreEntries = useRestoreEntries();\r\n  const {close} = useDialogContext();\r\n\r\n  return (\r\n    <ConfirmationDialog\r\n      title={<Trans message=\"This folder is in your trash\" />}\r\n      body={<Trans message=\"To view this folder, restore it from the trash.\" />}\r\n      confirm={<Trans message=\"Restore\" />}\r\n      isLoading={restoreEntries.isPending}\r\n      onConfirm={() => {\r\n        restoreEntries.mutate(\r\n          {\r\n            entryIds: entries.map(e => e.id),\r\n          },\r\n          {\r\n            onSuccess: () => {\r\n              close();\r\n              driveState().selectEntries([]);\r\n            },\r\n          },\r\n        );\r\n      }}\r\n    />\r\n  );\r\n}\r\n","import React, {ReactElement} from 'react';\r\nimport {ActiveActionDialog, driveState, useDriveStore} from '../../drive-store';\r\nimport {RenameEntryDialog} from './rename-entry-dialog';\r\nimport {NewFolderDialog} from './new-folder-dialog';\r\nimport {EntryPreviewDialog} from './entry-preview-dialog';\r\nimport {ShareDialog} from '../../share-dialog/share-dialog';\r\nimport {MoveEntriesDialog} from './move-entries-dialog/move-entries-dialog';\r\nimport {DialogTrigger} from '@common/ui/overlays/dialog/dialog-trigger';\r\nimport {DeleteEntriesForeverDialog} from './delete-entries-forever-dialog';\r\nimport {BlockTrashFolderViewDialog} from './block-trash-folder-view-dialog';\r\n\r\nexport function DriveDialogsContainer() {\r\n  const activeDialog = useDriveStore(s => s.activeActionDialog);\r\n  const dialog = getDialog(activeDialog);\r\n\r\n  return (\r\n    <DialogTrigger\r\n      type=\"modal\"\r\n      isOpen={!!dialog}\r\n      onClose={() => {\r\n        driveState().setActiveActionDialog(null);\r\n      }}\r\n    >\r\n      {dialog}\r\n    </DialogTrigger>\r\n  );\r\n}\r\n\r\nfunction getDialog(dialog?: ActiveActionDialog | null): ReactElement | null {\r\n  switch (dialog?.name) {\r\n    case 'rename':\r\n      return <RenameEntryDialog entries={dialog.entries} />;\r\n    case 'newFolder':\r\n      return <NewFolderDialog parentId={dialog.entries[0]?.id} />;\r\n    case 'preview':\r\n      return <EntryPreviewDialog selectedEntry={dialog.entries[0]} />;\r\n    case 'share':\r\n      return <ShareDialog entry={dialog.entries[0]} />;\r\n    case 'getLink':\r\n      return <ShareDialog entry={dialog.entries[0]} focusLinkInput />;\r\n    case 'moveTo':\r\n      return <MoveEntriesDialog entries={dialog.entries} />;\r\n    case 'confirmAndDeleteForever':\r\n      return <DeleteEntriesForeverDialog entries={dialog.entries} />;\r\n    case 'trashFolderBlock':\r\n      return <BlockTrashFolderViewDialog entries={dialog.entries} />;\r\n    default:\r\n      return null;\r\n  }\r\n}\r\n","import React, {useState} from 'react';\r\nimport {SearchIcon} from '@common/icons/material/Search';\r\nimport {TextField} from '@common/ui/forms/input-field/text-field/text-field';\r\nimport {SearchPage} from '../drive-page/drive-page';\r\nimport {useTrans} from '@common/i18n/use-trans';\r\nimport {useDriveStore} from '../drive-store';\r\nimport {useNavigate} from '@common/utils/hooks/use-navigate';\r\nimport {useSearchParams} from 'react-router-dom';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\n\r\nexport function NavbarSearch() {\r\n  const {trans} = useTrans();\r\n  const navigate = useNavigate();\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  const [searchParams] = useSearchParams();\r\n  const [inputValue, setInputValue] = useState(searchParams.get('query') || '');\r\n\r\n  return (\r\n    <form\r\n      className=\"max-w-620 flex-auto\"\r\n      onSubmit={e => {\r\n        e.preventDefault();\r\n        navigate(\r\n          {\r\n            pathname: SearchPage.path,\r\n            search: `?query=${inputValue}`,\r\n          },\r\n          {replace: true},\r\n        );\r\n      }}\r\n    >\r\n      <TextField\r\n        size=\"sm\"\r\n        background=\"bg\"\r\n        value={inputValue}\r\n        onChange={e => setInputValue(e.target.value)}\r\n        onFocus={() => {\r\n          if (activePage !== SearchPage) {\r\n            navigate(SearchPage.path);\r\n          }\r\n        }}\r\n        startAdornment={\r\n          <IconButton type=\"submit\">\r\n            <SearchIcon />\r\n          </IconButton>\r\n        }\r\n        className=\"max-w-620 flex-auto\"\r\n        placeholder={trans({message: 'Search'})}\r\n        aria-label={trans({message: 'Search files and folders'})}\r\n      />\r\n    </form>\r\n  );\r\n}\r\n","import {InteractableEvent} from '../interactable-event';\r\nimport {useEffect, useId, useRef} from 'react';\r\nimport {dragMonitors, DragSessionStatus} from './drag-state';\r\nimport {ConnectedDraggable} from './use-draggable';\r\n\r\nexport interface DragMonitor {\r\n  type: string;\r\n  onDragStart?: (e: InteractableEvent, dragTarget: ConnectedDraggable) => void;\r\n  onDragMove?: (e: InteractableEvent, dragTarget: ConnectedDraggable) => void;\r\n  onDragEnd?: (\r\n    e: InteractableEvent,\r\n    dragTarget: ConnectedDraggable,\r\n    status: DragSessionStatus\r\n  ) => void;\r\n}\r\n\r\nexport function useDragMonitor(monitor: DragMonitor) {\r\n  const monitorRef = useRef(monitor);\r\n  const id = useId();\r\n\r\n  useEffect(() => {\r\n    dragMonitors.set(id, monitorRef.current);\r\n    return () => {\r\n      dragMonitors.delete(id);\r\n    };\r\n  }, [id]);\r\n}\r\n","import {useDragMonitor} from '@common/ui/interactions/dnd/use-drag-monitor';\r\nimport React, {memo, useRef, useState} from 'react';\r\nimport {FileTypeIcon} from '@common/uploads/file-type-icon/file-type-icon';\r\nimport {FileEntry} from '@common/uploads/file-entry';\r\nimport {\r\n  DragSessionStatus,\r\n  droppables,\r\n} from '@common/ui/interactions/dnd/drag-state';\r\nimport {AnimatePresence, m} from 'framer-motion';\r\nimport clsx from 'clsx';\r\nimport {\r\n  isFolderTreeDragId,\r\n  makeFolderTreeDragId,\r\n} from '../layout/sidebar/folder-tree-drag-id';\r\nimport {InteractableEvent} from '@common/ui/interactions/interactable-event';\r\nimport {useDriveStore} from '../drive-store';\r\nimport {ConnectedDraggable} from '@common/ui/interactions/dnd/use-draggable';\r\n\r\ninterface Point {\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\ninterface DragPreviewState {\r\n  entries?: FileEntry[];\r\n  e?: InteractableEvent;\r\n  status?: DragSessionStatus;\r\n  draggingTreeItem?: boolean;\r\n}\r\n\r\nexport function EntryDragPreview() {\r\n  const ref = useRef<HTMLDivElement>(null);\r\n  const [points, setPoints] = useState<{start?: Point; end?: Point}>();\r\n  const [state, setState] = useState<DragPreviewState>({});\r\n\r\n  useDragMonitor({\r\n    type: 'fileEntry',\r\n    onDragStart: (e, dragTarget) => {\r\n      const target = dragTarget as ConnectedDraggable<FileEntry[]>;\r\n      if (target) {\r\n        setState({\r\n          entries: target.getData(),\r\n          e,\r\n          draggingTreeItem: isFolderTreeDragId(target.id as number),\r\n        });\r\n        setPoints({start: e});\r\n      }\r\n    },\r\n    onDragMove: e => {\r\n      setState(prev => {\r\n        return {...prev, e: e};\r\n      });\r\n      setPoints(prev => {\r\n        return {...prev, end: e};\r\n      });\r\n    },\r\n    onDragEnd: (e, dragTarget, status) => {\r\n      setState({status});\r\n    },\r\n  });\r\n\r\n  let preview = null;\r\n\r\n  if (state.entries && state.e) {\r\n    preview = (\r\n      <div\r\n        ref={ref}\r\n        style={\r\n          state.e\r\n            ? {\r\n                transform: `translate(${state.e.x}px, ${state.e.y}px)`,\r\n                width: `${state.e.rect.width}px`,\r\n              }\r\n            : undefined\r\n        }\r\n        className=\"fixed isolate left-0 top-0 pointer-events-none\"\r\n      >\r\n        {state.entries.map((item, index) => (\r\n          <EntryPreview\r\n            key={item.id}\r\n            index={index}\r\n            entry={item}\r\n            points={points}\r\n            state={state}\r\n          />\r\n        ))}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return <AnimatePresence custom={state.status}>{preview}</AnimatePresence>;\r\n}\r\n\r\ninterface EntryPreviewProps {\r\n  entry: FileEntry;\r\n  index: number;\r\n  points?: {start?: Point; end?: Point};\r\n  state: DragPreviewState;\r\n}\r\nconst EntryPreview = memo(\r\n  ({entry, points, index, state}: EntryPreviewProps) => {\r\n    const viewMode = useDriveStore(s => s.viewMode);\r\n    const droppableId = state.draggingTreeItem\r\n      ? makeFolderTreeDragId(entry)\r\n      : entry.id;\r\n    const target = droppables.get(droppableId);\r\n    if (!target?.rect || !points?.start) return null;\r\n    const rect = target.rect;\r\n    const itemCount = state.entries?.length || 0;\r\n\r\n    const exitVariant = (status: DragSessionStatus) => {\r\n      if (status === 'dropSuccess') {\r\n        return {\r\n          x: 0,\r\n          y: 0,\r\n          opacity: 0,\r\n          transition: {duration: 0.1, delay: 0},\r\n        };\r\n      }\r\n      return {\r\n        x: rect.left - (points.end?.x || 0),\r\n        y: rect.top - (points.end?.y || 0),\r\n        width: `${state.e?.rect.width}px`,\r\n      };\r\n    };\r\n\r\n    return (\r\n      <m.div\r\n        key={entry.id}\r\n        transition={{delay: 0.01 * index, bounce: 0, duration: 0.2}}\r\n        initial={{\r\n          x: rect.left - points.start.x,\r\n          y: rect.top - points.start.y,\r\n          width: `${state.e?.rect.width}px`,\r\n        }}\r\n        animate={{\r\n          x: 0,\r\n          y: 0,\r\n          // in list/table mode limit preview size to 288px, but start and end the animation\r\n          // at full width, so it returns to original position at original size smoothly\r\n          width: viewMode === 'list' ? 288 : undefined,\r\n        }}\r\n        exit={exitVariant as any}\r\n        style={{\r\n          // in grid mode simply use the width of the draggable item\r\n          width: viewMode === 'grid' ? `${state.e?.rect.width}px` : undefined,\r\n          height: `${state.e?.rect.height}px`,\r\n        }}\r\n        className={clsx(\r\n          'absolute bg-paper whitespace-nowrap rounded border border-primary-light max-h-48',\r\n          index < 2 && 'shadow',\r\n          index === 0 && 'z-10 top-0 left-0',\r\n          index > 0 && 'top-6 left-6'\r\n        )}\r\n      >\r\n        {itemCount > 1 && index === 0 && <EntryCount count={itemCount} />}\r\n        <div className=\"text-sm h-full flex justify-center items-center px-16 gap-10 bg-primary-light/20 overflow-hidden\">\r\n          <FileTypeIcon type={entry.type} />\r\n          <div className=\"flex-auto text-ellipsis overflow-hidden\">\r\n            {entry.name}\r\n          </div>\r\n        </div>\r\n      </m.div>\r\n    );\r\n  }\r\n);\r\n\r\ninterface EntryCountProps {\r\n  count: number;\r\n}\r\nconst EntryCount = memo(({count}: EntryCountProps) => {\r\n  return (\r\n    <m.div\r\n      key=\"entryCount\"\r\n      initial={{opacity: 0}}\r\n      animate={{opacity: 1, transition: {delay: 0.1}}}\r\n      exit={{opacity: 0}}\r\n      transition={{duration: 0.1}}\r\n      className=\"absolute -top-6 shadow-lg -right-6 z-30 rounded-full bg-danger text-white w-20 h-20 flex items-center justify-center text-sm font-bold z-10\"\r\n    >\r\n      {count}\r\n    </m.div>\r\n  );\r\n});\r\n","import {PageBreadcrumbs} from '../page-breadcrumbs';\r\nimport {DashboardContentHeader} from '@common/ui/layout/dashboard-content-header';\r\nimport React, {useContext} from 'react';\r\nimport {driveState, useDriveStore} from '../drive-store';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {Tooltip} from '@common/ui/tooltip/tooltip';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {ViewListIcon} from '@common/icons/material/ViewList';\r\nimport {ViewModuleIcon} from '@common/icons/material/ViewModule';\r\nimport {DashboardLayoutContext} from '@common/ui/layout/dashboard-layout-context';\r\nimport {InfoIcon} from '@common/icons/material/Info';\r\nimport {DriveSortButton} from './sorting/drive-sort-button';\r\n\r\nexport function DriveContentHeader() {\r\n  const {isMobileMode} = useContext(DashboardLayoutContext);\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  return (\r\n    <DashboardContentHeader className=\"px-8 md:px-26 py-4 flex items-center gap-20 border-b h-60\">\r\n      {isMobileMode ? (\r\n        <DriveSortButton isDisabled={activePage?.disableSort} />\r\n      ) : (\r\n        <PageBreadcrumbs />\r\n      )}\r\n      <div className=\"text-muted ml-auto flex-shrink-0\">\r\n        <ToggleViewModeButton />\r\n        <ToggleDetailsButton />\r\n      </div>\r\n    </DashboardContentHeader>\r\n  );\r\n}\r\n\r\nfunction ToggleViewModeButton() {\r\n  const viewMode = useDriveStore(s => s.viewMode);\r\n  const tooltip =\r\n    viewMode === 'grid' ? (\r\n      <Trans message=\"List view\" />\r\n    ) : (\r\n      <Trans message=\"Grid view\" />\r\n    );\r\n  return (\r\n    <Tooltip label={tooltip}>\r\n      <IconButton\r\n        size=\"md\"\r\n        onClick={() => {\r\n          driveState().setViewMode(\r\n            driveState().viewMode === 'list' ? 'grid' : 'list'\r\n          );\r\n        }}\r\n      >\r\n        {viewMode === 'list' ? <ViewListIcon /> : <ViewModuleIcon />}\r\n      </IconButton>\r\n    </Tooltip>\r\n  );\r\n}\r\n\r\nfunction ToggleDetailsButton() {\r\n  const {rightSidenavStatus: status, setRightSidenavStatus} = useContext(\r\n    DashboardLayoutContext\r\n  );\r\n  const tooltip = status ? (\r\n    <Trans message=\"Hide details\" />\r\n  ) : (\r\n    <Trans message=\"Show details\" />\r\n  );\r\n  return (\r\n    <Tooltip label={tooltip}>\r\n      <IconButton\r\n        size=\"md\"\r\n        color={status === 'open' ? 'primary' : null}\r\n        onClick={() => {\r\n          setRightSidenavStatus(status === 'open' ? 'closed' : 'open');\r\n        }}\r\n      >\r\n        <InfoIcon />\r\n      </IconButton>\r\n    </Tooltip>\r\n  );\r\n}\r\n","import React, {Fragment, useContext, useEffect, useMemo} from 'react';\r\nimport {Link, useLocation, useParams} from 'react-router-dom';\r\nimport {Sidebar} from './sidebar/sidebar';\r\nimport {FileView} from '../file-view/file-view';\r\nimport {UploadQueue} from '../uploading/upload-queue';\r\nimport {driveState, useDriveStore} from '../drive-store';\r\nimport {\r\n  DRIVE_PAGES,\r\n  makePartialFolderPage,\r\n  SearchPage,\r\n} from '../drive-page/drive-page';\r\nimport {DetailsSidebar} from '../details-sidebar/details-sidebar';\r\nimport {DriveDialogsContainer} from '../files/dialogs/drive-dialogs-container';\r\nimport {NavbarSearch} from '../search/navbar-search';\r\nimport {useActiveWorkspaceId} from '@common/workspace/active-workspace-id-context';\r\nimport {FileEntryUrlsContext} from '@common/uploads/hooks/file-entry-urls';\r\nimport {FileUploadProvider} from '@common/uploads/uploader/file-upload-provider';\r\nimport {EntryDragPreview} from '../file-view/entry-drag-preview';\r\nimport {DashboardLayout} from '@common/ui/layout/dashboard-layout';\r\nimport {DashboardContent} from '@common/ui/layout/dashboard-content';\r\nimport {DashboardNavbar} from '@common/ui/layout/dashboard-navbar';\r\nimport {DriveContentHeader} from './drive-content-header';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {SearchIcon} from '@common/icons/material/Search';\r\nimport {DashboardLayoutContext} from '@common/ui/layout/dashboard-layout-context';\r\nimport {CloseIcon} from '@common/icons/material/Close';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {EntryActionList} from '../entry-actions/entry-action-list';\r\nimport {CreateNewButton} from './create-new-button';\r\nimport {StaticPageTitle} from '@common/seo/static-page-title';\r\nimport {DashboardSidenav} from '@common/ui/layout/dashboard-sidenav';\r\n\r\nexport function DriveLayout() {\r\n  const {pathname} = useLocation();\r\n  const {hash} = useParams();\r\n  const {workspaceId} = useActiveWorkspaceId();\r\n  const activePage = useDriveStore(s => s.activePage);\r\n\r\n  useEffect(() => {\r\n    driveState().setActivePage(\r\n      DRIVE_PAGES.find(p => p.path === pathname) ||\r\n        makePartialFolderPage(hash!),\r\n    );\r\n  }, [pathname, hash]);\r\n\r\n  const urlsContextValue = useMemo(() => {\r\n    return {workspaceId};\r\n  }, [workspaceId]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      driveState().reset();\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <Fragment>\r\n      {activePage?.label && (\r\n        <StaticPageTitle>\r\n          <Trans\r\n            message={\r\n              typeof activePage.label === 'string'\r\n                ? activePage.label\r\n                : activePage.label.message\r\n            }\r\n          />\r\n        </StaticPageTitle>\r\n      )}\r\n      <FileUploadProvider>\r\n        <FileEntryUrlsContext.Provider value={urlsContextValue}>\r\n          <DashboardLayout\r\n            name=\"drive\"\r\n            onDragOver={e => {\r\n              e.preventDefault();\r\n              e.stopPropagation();\r\n              e.dataTransfer.dropEffect = 'none';\r\n            }}\r\n            onDrop={e => {\r\n              // prevent files from desktop from blowing away the document\r\n              e.preventDefault();\r\n            }}\r\n          >\r\n            <Navbar />\r\n            <DashboardSidenav position=\"left\" size=\"md\">\r\n              <Sidebar />\r\n            </DashboardSidenav>\r\n            <DriveContentHeader />\r\n            <DashboardContent>\r\n              <FileView />\r\n            </DashboardContent>\r\n            <UploadQueue />\r\n            <DriveDialogsContainer />\r\n            <DashboardSidenav position=\"right\" size=\"lg\">\r\n              <DetailsSidebar />\r\n            </DashboardSidenav>\r\n          </DashboardLayout>\r\n        </FileEntryUrlsContext.Provider>\r\n        <EntryDragPreview />\r\n      </FileUploadProvider>\r\n    </Fragment>\r\n  );\r\n}\r\n\r\nfunction Navbar() {\r\n  const {isMobileMode} = useContext(DashboardLayoutContext);\r\n  const activePage = useDriveStore(s => s.activePage);\r\n\r\n  const children = isMobileMode ? null : <NavbarSearch />;\r\n  const searchButton = (\r\n    <IconButton elementType={Link} to={SearchPage.path}>\r\n      <SearchIcon />\r\n    </IconButton>\r\n  );\r\n\r\n  const mobileRightChildren = (\r\n    <Fragment>\r\n      {activePage !== SearchPage && searchButton}\r\n      <CreateNewButton isCompact />\r\n    </Fragment>\r\n  );\r\n\r\n  return (\r\n    <Fragment>\r\n      <DashboardNavbar\r\n        rightChildren={isMobileMode && mobileRightChildren}\r\n        menuPosition=\"drive-navbar\"\r\n      >\r\n        {children}\r\n      </DashboardNavbar>\r\n      {isMobileMode && <FloatingActionList />}\r\n    </Fragment>\r\n  );\r\n}\r\n\r\nfunction FloatingActionList() {\r\n  const entriesSelected = useDriveStore(s => s.selectedEntries.size);\r\n  if (!entriesSelected) return null;\r\n  return (\r\n    <div className=\"fixed right-0 top-0 z-10 flex h-54 w-full items-center justify-center gap-10 rounded bg-primary px-6 text-on-primary shadow-xl\">\r\n      <IconButton\r\n        onClick={() => {\r\n          driveState().selectEntries([]);\r\n        }}\r\n      >\r\n        <CloseIcon />\r\n      </IconButton>\r\n      <Trans message=\":count selected\" values={{count: entriesSelected}} />\r\n      <EntryActionList className=\"ml-auto\" />\r\n    </div>\r\n  );\r\n}\r\n","import {RouteObject, redirect, useNavigate, useRoutes} from 'react-router-dom';\r\nimport React, { useEffect, useState } from 'react';\r\nimport {ShareableLinkPage} from './shareable-link/shareable-link-page/shareable-link-page';\r\nimport {DriveLayout} from './layout/drive-layout';\r\nimport {AuthRoute} from '@common/auth/guards/auth-route';\r\nimport {NotFoundPage} from '@common/ui/not-found-page/not-found-page';\r\n\r\nconst DriveRouteConfig: RouteObject[] = [\r\n  {\r\n    path: '/',\r\n    element: (\r\n      <AuthRoute>\r\n        <DriveLayout />\r\n      </AuthRoute>\r\n    ),\r\n  },\r\n  {\r\n    path: '/folders/:hash',\r\n    element: (\r\n      <AuthRoute>\r\n        <DriveLayout />\r\n      </AuthRoute>\r\n    ),\r\n  },\r\n  {\r\n    path: '/shares',\r\n    element: (\r\n      <AuthRoute>\r\n        <DriveLayout />\r\n      </AuthRoute>\r\n    ),\r\n  },\r\n  {\r\n    path: '/recent',\r\n    element: (\r\n      <AuthRoute>\r\n        <DriveLayout />\r\n      </AuthRoute>\r\n    ),\r\n  },\r\n  {\r\n    path: '/starred',\r\n    element: (\r\n      <AuthRoute>\r\n        <DriveLayout />\r\n      </AuthRoute>\r\n    ),\r\n  },\r\n  {\r\n    path: '/trash',\r\n    element: (\r\n      <AuthRoute>\r\n        <DriveLayout />\r\n      </AuthRoute>\r\n    ),\r\n  },\r\n  {\r\n    path: '/search',\r\n    element: (\r\n      <AuthRoute>\r\n        <DriveLayout />\r\n      </AuthRoute>\r\n    ),\r\n  },\r\n  {path: 's/:hash', element: <ShareableLinkPage />},\r\n  {path: '*', element: <NotFoundPage />},\r\n];\r\n\r\nexport default function DriveRoutes() {\r\n  return useRoutes(DriveRouteConfig);\r\n}\r\n"],"names":["_a","_b","importIntoOwnDrive","MenuItem","Navbar","Footer","restoreEntries","duplicateEntries","deleteEntries","unshareEntries","Fragment","MenuSection","createWorkspace","MemberListItem","removeMember","updateWorkspace","message","deleteWorkspace","MenuPositions","moveEntries","index","useNavigate","rootFolder","e","renameEntry","createFolder","shareEntry","ComboBox","_c"],"mappings":"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"}