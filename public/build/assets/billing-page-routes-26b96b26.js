import{bv as $,j as e,ax as E,O as R,aZ as D,r as o,L as K,T as t,bw as Q,az as W,cz as J,aE as y,u as I,B as u,a3 as p,N as Z,bM as V,m as b,b as T,A,b6 as C,o as S,H as _,a0 as Y,J as g,y as X,M as ee,Q as se,U as ne,aD as ae,a4 as v,a2 as G,a as te,cA as ie,cB as h}from"./main-9e2d4150.js";import{B as w,a as m,S as le,E as re}from"./Edit-3b0fa001.js";import{S as ce,l as oe,B as de}from"./billing-redirect-message-8801cdc6.js";import{F as N,a as me}from"./formatted-price-a3e40dbf.js";import{R as ue,c as U,u as xe,b as je}from"./use-resume-subscription-6774c851.js";import{C as he,O as ge}from"./OpenInNew-5584a95d.js";import"./TaskAlt-16348974.js";function pe({children:s}){const{isSubscribed:a}=$();return a?s||e.jsx(R,{}):e.jsx(E,{to:"/pricing",replace:!0})}function fe(){const{user:s}=$(),a=D(s.id,{with:["subscriptions.product","subscriptions.price"]});return e.jsxs(o.Fragment,{children:[e.jsx(K,{children:e.jsx(t,{message:"Billing"})}),e.jsx(Q,{menuPosition:"billing-page"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"container mx-auto my-24 px-24 flex-auto",children:a.isLoading?e.jsx(W,{className:"my-80","aria-label":"Loading user..",isIndeterminate:!0}):e.jsx(R,{})}),e.jsx(J,{className:"container mx-auto px-24"})]})]})}const ye="/billing";function be(){const s=y();return e.jsxs(o.Fragment,{children:[e.jsxs(w,{children:[e.jsx(m,{isLink:!0,onSelected:()=>s(ye),children:e.jsx(t,{message:"Billing"})}),e.jsx(m,{children:e.jsx(t,{message:"Payment method"})})]}),e.jsx("h1",{className:"text-3xl font-bold my-32 md:my-64",children:e.jsx(t,{message:"Change payment method"})}),e.jsx(R,{})]})}const ve="/billing";function Ne(){const{base_url:s}=I();return e.jsxs("div",{className:"max-w-[464px]",children:[e.jsx(ce,{type:"setupIntent",submitLabel:e.jsx(t,{message:"Change"}),returnUrl:`${s}/billing/change-payment-method/done`}),e.jsx(u,{variant:"outline",className:"w-full mt-16",size:"md",to:ve,elementType:p,type:"button",children:e.jsx(t,{message:"Go back"})})]})}function x(){var n,i,l;const s=D("me",{with:["subscriptions.product","subscriptions.price"]});return{subscription:(i=(n=s.data)==null?void 0:n.user.subscriptions)==null?void 0:i[0],isLoading:s.isLoading,user:(l=s.data)==null?void 0:l.user}}function k(){Z.invalidateQueries({queryKey:["users"]})}const O="/billing";function we(){const{billing:{stripe_public_key:s}}=I(),a=y(),[n]=V(),i=n.get("setup_intent_client_secret"),[l,r]=o.useState(),c=o.useRef();return o.useEffect(()=>{c.current||!i||(oe(s).then(d=>{if(!d){r(q());return}d.retrieveSetupIntent(i).then(({setupIntent:j})=>{(j==null?void 0:j.status)==="succeeded"&&Pe(j.payment_method).then(()=>{k()}),r(q(j==null?void 0:j.status))})}),c.current=!0)},[s,i]),i?e.jsx(de,{config:l}):(a(O),null)}function q(s){switch(s){case"succeeded":return{...P,message:b("Payment method changed successfully!"),status:"success"};case"processing":return{...P,message:b("Your request is processing. We'll update you when your payment method is confirmed."),status:"success"};case"requires_payment_method":return{...P,message:b("Payment method confirmation failed. Please try another payment method."),status:"error"};default:return{...P,message:b("Something went wrong"),status:"error"}}}const P={link:O,buttonLabel:b("Go back")};function Pe(s){return T.post("billing/stripe/change-default-payment-method",{payment_method_id:s})}function f({title:s,children:a}){return e.jsxs("div",{className:"mb-64",children:[e.jsx("div",{className:"text-sm font-medium uppercase pb-16 mb-16 border-b",children:s}),a]})}function F(s,a){if(s==="monthly"){const n=Se(a);if(n)return n}if(s==="yearly"){const n=Ce(a);if(n)return n}return a[0]}function Ce(s){return s.find(a=>{if(a.interval==="month"&&a.interval_count>=12||a.interval==="year"&&a.interval_count>=1)return a})}function Se(s){return s.find(a=>{if(a.interval==="day"&&a.interval_count>=30||a.interval==="month"&&a.interval_count>=1)return a})}const _e=o.memo(({products:s})=>{const a=ke(s);return a<=0?null:e.jsx(o.Fragment,{children:e.jsxs("span",{className:"font-medium text-positive-darker",children:[" ","(",e.jsx(t,{message:"Save up to :percentage%",values:{percentage:a}}),")"]})})});function ke(s){if(!(s!=null&&s.length))return 0;const a=s.map(n=>{if(n.hidden)return 0;const i=F("monthly",n.prices),l=F("yearly",n.prices);if(!i||!l)return 0;const r=i.amount*12,c=l.amount,d=Math.round((r-c)/r*100);return d>0&&d<=200?d:0});return Math.max(Math.max(...a),0)}function Be({selectedCycle:s,onChange:a,products:n,...i}){return e.jsxs(ue,{...i,children:[e.jsxs(U,{value:"yearly",checked:s==="yearly",onChange:l=>{a(l.target.value)},children:[e.jsx(t,{message:"Annual"}),e.jsx(_e,{products:n})]}),e.jsx(U,{value:"monthly",checked:s==="monthly",onChange:l=>{a(l.target.value)},children:e.jsx(t,{message:"Monthly"})})]})}function Le(){const s=y();return e.jsxs(o.Fragment,{children:[e.jsxs(w,{children:[e.jsx(m,{isLink:!0,onSelected:()=>s("/billing"),children:e.jsx(t,{message:"Billing"})}),e.jsx(m,{children:e.jsx(t,{message:"Plans"})})]}),e.jsx("h1",{className:"my-32 text-3xl font-bold md:my-64",children:e.jsx(t,{message:"Change your plan"})}),e.jsx(f,{title:e.jsx(t,{message:"Available plans"}),children:e.jsx(A,{initial:!1,mode:"wait",children:e.jsx(Me,{})})})]})}function Me(){var i,l;const s=C(),[a,n]=o.useState("monthly");return s.isLoading?e.jsx(Re,{},"plan-skeleton"):e.jsxs(o.Fragment,{children:[e.jsx(Be,{products:(i=s.data)==null?void 0:i.products,selectedCycle:a,onChange:n,className:"mb-20",size:"md"}),(l=s.data)==null?void 0:l.products.map(r=>{const c=F(a,r.prices);return!c||r.hidden?null:o.createElement(S.div,{..._,key:r.id,className:"justify-between gap-40 border-b py-32 md:flex"},e.jsxs("div",{className:"mb-40 md:mb-0",children:[e.jsx("div",{className:"text-xl font-bold",children:r.name}),e.jsx(N,{price:c,className:"text-lg"}),e.jsx("div",{className:"mt-12 text-base",children:r.description}),e.jsx(ze,{plan:r})]}),e.jsx(Fe,{product:r,price:c}))})]},"plan-list")}function ze({plan:s}){return s.feature_list.length?e.jsxs("div",{className:"mt-32",children:[e.jsx("div",{className:"mb-10 text-sm font-semibold",children:e.jsx(t,{message:"What's included"})}),s.feature_list.map(a=>e.jsxs("div",{className:"flex items-center gap-10 text-sm",children:[e.jsx(Y,{className:"text-positive",size:"sm"}),e.jsx(t,{message:a})]},a))]}):null}function Fe({product:s,price:a}){const{subscription:n}=x();return!(n!=null&&n.price)||!(n!=null&&n.product)?null:n.product_id===s.id&&n.price_id===a.id?e.jsxs("div",{className:"flex w-[168px] items-center justify-center gap-10 text-muted",children:[e.jsx(Y,{size:"md"}),e.jsx(t,{message:"Current plan"})]}):e.jsx(u,{variant:"flat",color:"primary",className:"w-[168px]",size:"md",elementType:p,to:`/billing/change-plan/${s.id}/${a.id}/confirm`,children:e.jsx(t,{message:"Continue"})})}function Re(){return e.jsxs(S.div,{..._,className:"border-b py-32 text-2xl",children:[e.jsx(g,{className:"mb-8"}),e.jsx(g,{className:"mb-14"}),e.jsx(g,{className:"mb-24"}),e.jsx(g,{className:"mb-12"})]},"plan-skeleton")}function Ie(){const{trans:s}=X(),a=y();return ee({mutationFn:n=>Te(n),onSuccess:()=>{se(s(b("Plan changed."))),k(),a("/billing")},onError:n=>ne(n)})}function Te({subscriptionId:s,...a}){return T.post(`billing/subscriptions/${s}/change-plan`,a).then(n=>n.data)}const L="/billing/change-plan";function Ue(){const{productId:s,priceId:a}=ae(),n=y(),i=C(),{subscription:l}=x(),r=Ie();if(!i.data||(l==null?void 0:l.price_id)==a)return e.jsx(E,{to:"/billing/change-plan",replace:!0});const c=i.data.products.find(B=>`${B.id}`===s),d=c==null?void 0:c.prices.find(B=>`${B.id}`===a);if(!c||!d||!l)return n(L),null;const j=e.jsxs("span",{className:"whitespace-nowrap",children:[e.jsx(v,{date:l.renews_at,preset:"long"}),";"]});return e.jsxs(o.Fragment,{children:[e.jsxs(w,{children:[e.jsx(m,{isLink:!0,onSelected:()=>n("/billing"),children:e.jsx(t,{message:"Billing"})}),e.jsx(m,{onSelected:()=>n(L),children:e.jsx(t,{message:"Plans"})}),e.jsx(m,{children:e.jsx(t,{message:"Confirm"})})]}),e.jsx("h1",{className:"text-3xl font-bold my-32 md:my-64",children:e.jsx(t,{message:"Confirm your new plan"})}),e.jsx(f,{title:e.jsx(t,{message:"Changing to"}),children:e.jsxs("div",{className:"max-w-[464px]",children:[e.jsx("div",{className:"text-xl font-bold",children:c.name}),e.jsx(N,{price:d,className:"text-lg"}),e.jsx("div",{className:"text-base mt-12 border-b pb-24 mb-48",children:e.jsx(t,{message:"You will be charged the new price starting :date",values:{date:j}})}),e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(u,{variant:"flat",color:"primary",size:"md",className:"w-full mb-16",onClick:()=>{r.mutate({subscriptionId:l.id,newProductId:c.id,newPriceId:d.id})},disabled:r.isPending,children:e.jsx(t,{message:"Confirm"})})}),e.jsx("div",{children:e.jsx(u,{variant:"outline",className:"w-full",to:L,elementType:p,children:e.jsx(t,{message:"Go back"})})}),e.jsx("div",{className:"text-xs text-muted mt-12",children:e.jsx(t,{message:"By confirming your new plan, you agree to our terms of Service and privacy policy."})})]})]})})]})}const M="/billing";function qe(){const s=y(),a=C(),{subscription:n}=x(),i=xe(),l=n==null?void 0:n.product,r=n==null?void 0:n.price;if(!a.data)return null;if(!n||!l||!r)return s(M),null;const c=e.jsx("span",{className:"whitespace-nowrap",children:e.jsx(v,{date:n.renews_at,preset:"long"})}),d=()=>{i.mutate({subscriptionId:n.id},{onSuccess:()=>{k(),s("/billing")}})};return e.jsxs(o.Fragment,{children:[e.jsxs(w,{children:[e.jsx(m,{isLink:!0,onSelected:()=>s(M),children:e.jsx(t,{message:"Billing"})}),e.jsx(m,{children:e.jsx(t,{message:"Cancel"})})]}),e.jsx("h1",{className:"text-3xl font-bold my-32 md:my-64",children:e.jsx(t,{message:"Cancel your plan"})}),e.jsx(f,{title:e.jsx(t,{message:"Current plan"}),children:e.jsxs("div",{className:"max-w-[464px]",children:[e.jsx("div",{className:"text-xl font-bold",children:l.name}),e.jsx(N,{price:r,className:"text-lg"}),e.jsxs("div",{className:"text-base mt-12 border-b pb-24 mb-48",children:[e.jsx(t,{message:"Your plan will be canceled, but is still available until the end of your billing period on :date",values:{date:c}}),e.jsx("div",{className:"mt-20",children:e.jsx(t,{message:"If you change your mind, you can renew your subscription."})})]}),e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(u,{variant:"flat",color:"primary",size:"md",className:"w-full mb-16",onClick:d,disabled:i.isPending,children:e.jsx(t,{message:"Cancel plan"})})}),e.jsx("div",{children:e.jsx(u,{variant:"outline",className:"w-full",to:M,elementType:p,children:e.jsx(t,{message:"Go back"})})}),e.jsx("div",{className:"text-xs text-muted mt-12",children:e.jsx(t,{message:"By cancelling your plan, you agree to our terms of service and privacy policy."})})]})]})})]})}const z="/billing";function $e(){const s=y(),a=C(),{subscription:n}=x(),i=je(),l=n==null?void 0:n.product,r=n==null?void 0:n.price;if(!a.data)return null;if(!n||!l||!r)return s(z),null;const c=e.jsxs("span",{className:"whitespace-nowrap",children:[e.jsx(v,{date:n.ends_at,preset:"long"}),";"]}),d=()=>{i.mutate({subscriptionId:n.id},{onSuccess:()=>{k(),s("/billing")}})};return e.jsxs(o.Fragment,{children:[e.jsxs(w,{children:[e.jsx(m,{isLink:!0,onSelected:()=>s(z),children:e.jsx(t,{message:"Billing"})}),e.jsx(m,{children:e.jsx(t,{message:"Renew"})})]}),e.jsx("h1",{className:"text-3xl font-bold my-32 md:my-64",children:e.jsx(t,{message:"Renew your plan"})}),e.jsx(f,{title:e.jsx(t,{message:"Current plan"}),children:e.jsxs("div",{className:"max-w-[464px]",children:[e.jsx("div",{className:"text-xl font-bold",children:l.name}),e.jsx(N,{price:r,className:"text-lg"}),e.jsx("div",{className:"text-base mt-12 border-b pb-24 mb-48",children:e.jsx(t,{message:"This plan will no longer be canceled. It will renew on :date",values:{date:c}})}),e.jsx(u,{variant:"flat",color:"primary",size:"md",className:"w-full mb-16",onClick:d,disabled:i.isPending,children:e.jsx(t,{message:"Renew plan"})}),e.jsx(u,{variant:"outline",className:"w-full",to:z,elementType:p,children:e.jsx(t,{message:"Go back"})}),e.jsx("div",{className:"text-xs text-muted mt-12",children:e.jsx(t,{message:"By renewing your plan, you agree to our terms of service and privacy policy."})})]})})]})}function Ee(){const{subscription:s}=x();if(!(s!=null&&s.price)||!(s!=null&&s.product))return null;const a=e.jsx("span",{className:"whitespace-nowrap",children:e.jsx(v,{preset:"long",date:s.ends_at})});return e.jsx(f,{title:e.jsx(t,{message:"Current plan"}),children:e.jsxs("div",{className:"mt-24 flex flex-col justify-between gap-20",children:[e.jsxs("div",{children:[e.jsx(G,{className:"mb-10 w-min",size:"xs",radius:"rounded",color:"danger",children:e.jsx(t,{message:"Canceled"})}),e.jsx("div",{className:"mb-2 text-xl font-bold",children:s.product.name}),e.jsx(N,{className:"mb-8 text-xl",price:s.price}),e.jsxs("div",{className:"flex items-center gap-8 text-base",children:[e.jsx(he,{size:"sm",className:"text-muted"}),e.jsx("div",{className:"flex-auto",children:e.jsx(t,{message:"Your plan will be canceled on :date",values:{date:a}})})]})]}),e.jsx("div",{className:"w-[233px]",children:e.jsx(u,{variant:"flat",color:"primary",size:"md",className:"mb-12 w-full",elementType:p,to:"/billing/renew",children:e.jsx(t,{message:"Renew plan"})})})]})})}function De(){const{subscription:s}=x();if(!(s!=null&&s.price)||!(s!=null&&s.product))return null;const a=e.jsx(v,{preset:"long",date:s.renews_at});return e.jsxs(o.Fragment,{children:[s.past_due?e.jsx(Ae,{}):null,e.jsx(f,{title:e.jsx(t,{message:"Current plan"}),children:e.jsxs("div",{className:"mt-24 flex justify-between gap-20",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xl font-bold",children:s.product.name}),e.jsx(N,{className:"mb-2 text-xl",price:s.price}),e.jsx("div",{className:"text-base",children:e.jsx(t,{message:"Your plan renews on :date",values:{date:a}})})]}),e.jsxs("div",{className:"w-[233px]",children:[e.jsx(u,{variant:"flat",color:"primary",size:"md",className:"mb-12 w-full",elementType:p,to:"/billing/change-plan",disabled:s.gateway_name==="none",children:e.jsx(t,{message:"Change plan"})}),e.jsx(u,{variant:"outline",color:"danger",size:"md",className:"w-full",elementType:p,to:"/billing/cancel",children:e.jsx(t,{message:"Cancel plan"})})]})]})})]})}function Ae(){return e.jsx(le,{className:"mb-24",color:"danger",title:"Payment is past due",description:"Your recent recurring payment has failed with the payment method we have on file. Please update your payment method to avoid any service interruptions."})}function Ye(){x();const s=Ge;return e.jsx(f,{title:e.jsx(t,{message:"Payment method"}),children:e.jsx(s,{methodClassName:"whitespace-nowrap text-base max-w-[464px] flex items-center gap-10",linkClassName:"flex items-center gap-4 text-muted mt-18 block hover:underline"})})}function Ge({methodClassName:s,linkClassName:a}){const{user:n}=x();return e.jsxs(o.Fragment,{children:[e.jsxs("div",{className:s,children:[e.jsx("span",{className:"capitalize",children:n==null?void 0:n.card_brand})," ••••",n==null?void 0:n.card_last_four,(n==null?void 0:n.card_expires)&&e.jsx("div",{className:"ml-auto",children:e.jsx(t,{message:"Expires :date",values:{date:n==null?void 0:n.card_expires}})})]}),e.jsxs(p,{className:a,to:"/billing/change-payment-method",children:[e.jsx(re,{size:"sm"}),e.jsx(t,{message:"Change payment method"})]})]})}const H="billing/invoices";function Oe(s){return te({queryKey:[H],queryFn:()=>He(s)})}function He(s){return T.get(H,{params:{userId:s}}).then(a=>a.data)}function Ke(){var i;const{user:s}=x(),a=Oe(s==null?void 0:s.id);if(!s)return null;const n=(i=a.data)==null?void 0:i.invoices;return e.jsx(f,{title:e.jsx(t,{message:"Payment history"}),children:e.jsx("div",{className:"max-w-[464px]",children:e.jsx(A,{initial:!1,mode:"wait",children:a.isLoading?e.jsx(We,{},"loading-skeleton"):e.jsx(Qe,{invoices:n},"invoices")})})})}function Qe({invoices:s}){const{base_url:a}=I();return e.jsxs(S.div,{..._,children:[s!=null&&s.length?void 0:e.jsx("div",{className:"text-muted italic",children:e.jsx(t,{message:"No invoices yet"})}),s==null?void 0:s.map(n=>{var i;return e.jsxs("div",{className:"whitespace-nowrap text-base flex items-center justify-between gap-10 mb-14",children:[e.jsxs("a",{href:`${a}/billing/invoices/${n.uuid}`,target:"_blank",className:"flex items-center gap-8 hover:underline",rel:"noreferrer",children:[e.jsx(v,{date:n.created_at}),e.jsx(ge,{size:"xs"})]}),n.subscription.price&&e.jsx("div",{children:e.jsx(me,{value:n.subscription.price.amount,currency:n.subscription.price.currency})}),e.jsx(G,{size:"xs",color:n.paid?"positive":"danger",radius:"rounded",children:n.paid?e.jsx(t,{message:"Paid"}):e.jsx(t,{message:"Unpaid"})}),e.jsx("div",{children:(i=n.subscription.product)==null?void 0:i.name})]},n.id)})]})}function We(){return e.jsxs(S.div,{..._,children:[e.jsx(g,{className:"mb-14"}),e.jsx(g,{className:"mb-14"}),e.jsx(g,{className:"mb-14"}),e.jsx(g,{className:"mb-14"}),e.jsx(g,{})]})}function Je(){const{subscription:s}=x();if(!(s!=null&&s.price)||!(s!=null&&s.product))return null;console.log("OKOK");const a=s.ends_at?e.jsx(Ee,{}):e.jsx(De,{});return e.jsxs("div",{children:[a,e.jsx(Ye,{}),e.jsx(Ke,{})]})}function ts(){return e.jsx(ie,{children:e.jsxs(h,{path:"/",element:e.jsx(pe,{children:e.jsx(fe,{})}),children:[e.jsx(h,{index:!0,element:e.jsx(Je,{})}),e.jsxs(h,{path:"change-payment-method",element:e.jsx(be,{}),children:[e.jsx(h,{index:!0,element:e.jsx(Ne,{})}),e.jsx(h,{path:"done",element:e.jsx(we,{})})]}),e.jsx(h,{path:"change-plan",element:e.jsx(Le,{})}),e.jsx(h,{path:"change-plan/:productId/:priceId/confirm",element:e.jsx(Ue,{})}),e.jsx(h,{path:"cancel",element:e.jsx(qe,{})}),e.jsx(h,{path:"renew",element:e.jsx($e,{})})]})})}export{ts as default};
//# sourceMappingURL=billing-page-routes-26b96b26.js.map
